<template>
  <DefaultLayout>
    <template v-slot:subheader>
      <div class="header-nav-wrap">
        
        <div class="row align-items-center">
          <div class="col-auto">
            <div class="header-back-link">
              <router-link class="text-primary" to="/settings"
                ><Icon icon="fa6-solid:chevron-left" />
                {{ $t("Settings") }}</router-link
              >
            </div>
          </div>
          <div class="col-auto">
            <h5 class="fw-bold">{{ $t("Printer Setting") }}</h5>
          </div>
        </div>
      </div>
    </template>

    <div class="content py-5">
      <div class="py-3" v-if="form.server_messages.messages != ''">
        <ServerMessage :server_messages="form.server_messages" />
      </div>

      <PrinterSettingSkeleton v-if="is_processing" />

      <div class="row gx-3" v-else>
        <div class="col-md-12 col-lg-6">
          <div class="cs-setting-card">
            <div class="icon">
              <svg
                width="34"
                height="38"
                viewBox="0 0 34 38"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M14.4098 12.7603C14.5568 12.5875 14.6644 12.3849 14.7251 12.1663C14.7858 11.9478 14.7981 11.7187 14.7613 11.4949C14.5745 10.4001 14.1334 9.3644 13.4734 8.47113C12.8135 7.57787 11.9531 6.85197 10.9614 6.35182C11.4092 5.76653 11.6844 5.06768 11.7558 4.33422C11.8273 3.60076 11.6922 2.86193 11.3659 2.20121C11.0395 1.54049 10.5348 0.984213 9.90892 0.595235C9.28301 0.206256 8.56078 7.9757e-05 7.82385 2.31351e-08C7.08692 -7.97107e-05 6.36465 0.205941 5.73865 0.594784C5.11266 0.983627 4.60788 1.53979 4.28137 2.20044C3.95485 2.86109 3.81961 3.59989 3.89092 4.33337C3.96223 5.06684 4.23725 5.76576 4.6849 6.35114C3.69304 6.85077 2.83259 7.57666 2.17305 8.4702C1.5135 9.36374 1.07336 10.3999 0.888154 11.4949C0.853129 11.7181 0.866605 11.9462 0.927667 12.1638C0.988729 12.3813 1.09594 12.5831 1.24201 12.7555C1.38807 12.9278 1.56956 13.0667 1.77412 13.1626C1.97868 13.2586 2.20151 13.3093 2.42743 13.3114H13.2181C13.4448 13.3115 13.6689 13.2623 13.8747 13.1671C14.0805 13.0719 14.2631 12.9331 14.4098 12.7603ZM7.82307 1.35816C8.50674 1.36567 9.15985 1.64252 9.64064 2.12863C10.1214 2.61473 10.3911 3.27085 10.3911 3.95456C10.3911 4.63827 10.1214 5.29438 9.64058 5.78047C9.15978 6.26656 8.50666 6.5434 7.82299 6.55088C4.39941 6.46126 4.40009 1.44728 7.82307 1.35816ZM2.27554 11.8822C2.30988 9.88174 3.97329 8.0638 5.80233 7.34764C6.4123 7.7149 7.11081 7.909 7.82281 7.90908C8.5348 7.90917 9.23336 7.71523 9.84342 7.34811C11.6712 8.06361 13.334 9.88075 13.3747 11.8809C13.3556 11.9038 13.3316 11.9221 13.3045 11.9346C13.2775 11.9471 13.2479 11.9535 13.2181 11.9532H2.4274C2.39843 11.9532 2.36981 11.9469 2.34357 11.9346C2.31733 11.9223 2.2941 11.9045 2.27554 11.8822Z"
                  fill="black"
                ></path>
                <path
                  d="M33.1126 11.4946C32.9258 10.3997 32.4847 9.36394 31.8246 8.47063C31.1646 7.57731 30.304 6.85139 29.3123 6.35127C29.8416 5.66427 30.1287 4.82146 30.1289 3.95421C29.9639 -1.26939 22.3858 -1.27303 22.2198 3.9543C22.2201 4.82127 22.507 5.66382 23.036 6.35071C22.0441 6.85022 21.1835 7.57611 20.524 8.46969C19.8645 9.36328 19.4244 10.3995 19.2395 11.4946C19.2027 11.718 19.215 11.9467 19.2753 12.1649C19.3357 12.3831 19.4427 12.5856 19.5891 12.7583C19.7354 12.9311 19.9175 13.07 20.1228 13.1654C20.3281 13.2608 20.5516 13.3105 20.778 13.3111H31.5687C31.795 13.3095 32.0183 13.2592 32.2233 13.1635C32.4284 13.0679 32.6104 12.9291 32.7569 12.7567C32.9035 12.5842 33.0111 12.3822 33.0725 12.1644C33.1339 11.9467 33.1476 11.7182 33.1126 11.4946ZM26.1744 1.35785C29.598 1.44749 29.5974 6.46146 26.1743 6.55058C22.7507 6.46096 22.7514 1.44697 26.1744 1.35785ZM31.7259 11.8806C31.7067 11.9035 31.6826 11.9219 31.6555 11.9345C31.6283 11.947 31.5986 11.9532 31.5687 11.9529H20.7781C20.6249 11.93 20.5789 11.8684 20.5804 11.7135C20.7459 10.7382 21.1624 9.82274 21.7889 9.05721C22.4154 8.29167 23.2305 7.7024 24.1538 7.34735C24.7637 7.71461 25.4621 7.90871 26.1741 7.90878C26.886 7.90884 27.5845 7.71487 28.1945 7.34773C30.0224 8.06313 31.6853 9.88036 31.7259 11.8806Z"
                  fill="black"
                ></path>
                <path
                  d="M24.7261 25.0745C24.4686 24.959 24.1892 24.9004 23.907 24.9028C23.9035 24.5175 23.7902 24.1412 23.5803 23.8181C23.3704 23.4951 23.0726 23.2386 22.722 23.0789C22.4117 22.941 22.0714 22.8847 21.7332 22.9152C21.6751 22.5088 21.4856 22.1326 21.1937 21.844C20.9018 21.5553 20.5234 21.3701 20.1164 21.3167L21.1608 19.0057C21.2744 18.7559 21.3373 18.4862 21.3459 18.2119C21.3546 17.9377 21.3088 17.6645 21.2112 17.4081C21.0604 17.0266 20.8012 16.6976 20.4657 16.4616C20.1302 16.2256 19.733 16.0929 19.323 16.0799C18.913 16.0669 18.5081 16.1741 18.1583 16.3883C17.8085 16.6025 17.5289 16.9144 17.3542 17.2855L13.3525 26.1395L12.0156 24.2813C11.7047 23.8608 11.2518 23.5675 10.7409 23.4559C10.23 23.3443 9.69599 23.4221 9.23815 23.6747C8.78032 23.9274 8.42982 24.3377 8.25185 24.8294C8.07387 25.3211 8.08054 25.8607 8.27061 26.3479L11.1872 33.548C13.0884 38.5323 20.0752 39.9118 22.5656 34.668L25.7163 27.696C25.9318 27.217 25.9486 26.672 25.763 26.1806C25.5774 25.6892 25.2046 25.2914 24.7261 25.0745ZM24.4788 27.137L21.328 34.1084C20.8481 35.1574 19.9733 35.9745 18.894 36.3818C17.8148 36.7892 16.6183 36.7539 15.5649 36.2835C14.1454 35.645 13.0278 34.4823 12.4459 33.0386L9.52928 25.8385C9.45638 25.658 9.45208 25.4571 9.51721 25.2737C9.58233 25.0903 9.71237 24.9371 9.88275 24.8431C10.0531 24.749 10.2521 24.7207 10.4419 24.7633C10.6318 24.8059 10.7995 24.9166 10.9134 25.0745L12.9367 27.8864C13.0071 27.9818 13.1011 28.0573 13.2095 28.1054C13.3178 28.1536 13.4369 28.1727 13.5549 28.1609C13.6729 28.1491 13.7858 28.1069 13.8825 28.0383C13.9792 27.9697 14.0564 27.8771 14.1066 27.7696L18.5917 17.8451C18.6528 17.7153 18.7506 17.6062 18.8729 17.5313C18.9953 17.4564 19.1369 17.4189 19.2803 17.4235C19.4237 17.4281 19.5626 17.4745 19.68 17.5571C19.7973 17.6397 19.8879 17.7548 19.9406 17.8882C19.9748 17.9777 19.9909 18.0731 19.9879 18.1688C19.985 18.2646 19.963 18.3587 19.9234 18.4459L16.5106 25.997C16.4739 26.0782 16.4535 26.1659 16.4506 26.255C16.4478 26.3442 16.4625 26.433 16.494 26.5164C16.5254 26.5999 16.573 26.6763 16.634 26.7414C16.695 26.8064 16.7682 26.8588 16.8495 26.8956C17.0136 26.9698 17.2005 26.9758 17.369 26.9122C17.4524 26.8808 17.5289 26.8332 17.5939 26.7722C17.659 26.7112 17.7114 26.6379 17.7481 26.5567C17.9797 26.0441 19.3434 22.7569 19.6713 22.6844C19.7708 22.6484 19.8786 22.6424 19.9814 22.667C20.0843 22.6917 20.1776 22.7459 20.25 22.823C20.3224 22.9001 20.3706 22.9967 20.3887 23.1009C20.4068 23.205 20.3939 23.3122 20.3518 23.4092C20.1071 23.9503 18.7555 26.9407 18.7555 26.9407C18.6816 27.1047 18.6759 27.2914 18.7395 27.4597C18.8031 27.628 18.9309 27.7642 19.0949 27.8383C19.2588 27.9125 19.4455 27.9185 19.6139 27.8552C19.7823 27.7918 19.9186 27.6642 19.993 27.5004L21.2816 24.6494C21.3176 24.5696 21.369 24.4978 21.4328 24.4379C21.4965 24.378 21.5715 24.3313 21.6533 24.3004C21.7352 24.2695 21.8223 24.255 21.9097 24.2577C21.9972 24.2605 22.0832 24.2804 22.163 24.3164C22.2427 24.3525 22.3146 24.4038 22.3744 24.4676C22.4343 24.5314 22.4811 24.6063 22.512 24.6882C22.5429 24.77 22.5574 24.8572 22.5546 24.9446C22.5519 25.032 22.5319 25.1181 22.4959 25.1978L20.9527 28.6132C20.8825 28.7767 20.8793 28.9611 20.9437 29.1269C21.008 29.2927 21.1349 29.4267 21.2969 29.5C21.459 29.5733 21.6433 29.5801 21.8104 29.5189C21.9774 29.4577 22.1138 29.3335 22.1902 29.1729C22.4659 28.577 23.0631 27.231 23.3421 26.6237C23.4125 26.4765 23.5376 26.3628 23.6908 26.3068C23.844 26.2508 24.013 26.2571 24.1616 26.3242C24.3103 26.3913 24.4267 26.514 24.486 26.6659C24.5452 26.8178 24.5427 26.9869 24.4788 27.137Z"
                  fill="black"
                ></path>
              </svg>
            </div>
            <div class="txt">
              <h5>{{ $t("Enable Silent Printing") }}</h5>
              <p class="text-dark py-1 mb-0">You must follow these steps before enabling silent printing.</p>
              <ul class="text-primary mb-3">
                <li class="py-1">1. Please use Mozilla firefox as your default browser.</li>
                <li class="py-1">2. Please enter <code>about:config</code> in your browser's address bar and search for <code>print.always_print_silent</code> and enable it.</li>
                <li class="py-1">3. Please log out and log back in after applying the changes to ensure <br> they take effect.</li>
              </ul>
              <div class="form-feild">
                <label for="enable_silent_printing">
                  <div class="form-check form-switch form-switch-2">
                    <label for="enable_silent_printing">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        id="enable_silent_printing"
                        style="margin-left: 0px"
                        v-model="form.enable_silent_printing"
                        :checked="form.enable_silent_printing"
                      />
                    </label>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="text-end">
            <button class="btn btn-primary" @click="update()">Save</button>
        </div>
      </div>
    </div>
  </DefaultLayout>
</template>


<script setup>

import { useAuthStore } from "@/stores/auth";

const authStore = useAuthStore();

onMounted(() => {
    get();
});

const initialState = {
    server_messages: {
        type: "",
        messages: "",
    },
    enable_silent_printing : true,
};

const form = reactive({ ...initialState });

const is_processing = ref(true);

async function get(){

    await axios.get('/api/printer_settings').then( (response) => {
        if(response.data != '' && response.data.settings){
            form.enable_silent_printing = response.data.settings.enable_silent_printing;
        }
        is_processing.value = false;

    }).catch((error) => {
        form.server_messages.type = "error";
        form.server_messages.messages = error;
        console.log(error)
        if (401 === error.response.status) {
          router.push('/'); 
        } 
    });

}

async function update(){

    var form_data = new FormData();
    form_data.append('enable_silent_printing',form.enable_silent_printing);
    await axios.post('/api/printer_settings/update', form_data).then( (response) => {

        toast.success(response.data.msg);
        is_processing.value = false;

    }).catch((error) => {
        form.server_messages.type = "error";
        form.server_messages.messages = error;
        console.log(error);
        if (401 === error.response.status) {
          router.push('/'); 
        } 
    });

}
</script>