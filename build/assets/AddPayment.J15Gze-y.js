import D from"./ServerMessage.Re9KOdbP.js";import{_ as I}from"./VSelect.xfZK6hek.js";import{_ as U}from"./VTextInput.pcaNaUkX.js";import{u as B,r as p,e as O,b as T,v as F,g as r,h as u,i as s,t as d,l as m,w as R,m as v,j as f,N as j,K as L,p as z}from"./index.li3fCRRM.js";import{F as J}from"./vee-validate.esm.reM-LHjC.js";import{c as K,a as b,b as Z,e as G}from"./index.esm.e6McCFlz.js";/* empty css                                                   */import{C as H}from"./ClipLoader.gDBpDd3b.js";/* empty css                                                                */import"./VTooltip.pHzwBjkF.js";/* empty css                                                   */const Q="/assets/mada-visa-master.-CChZA1a.png",W={class:"modal hide",id:"addPaymentModal",tabindex:"-1","aria-labelledby":"Add Payment","aria-modal":"true",role:"dialog","data-bs-backdrop":"static","data-bs-keyboard":"false"},X={class:"modal-dialog modal-dialog-centered modal-lg"},Y={class:"modal-content"},ee={class:"modal-header"},te={class:"modal-title fs-5"},ae={class:"modal-body"},se={class:"row"},ne={class:"col-md-4"},oe={class:"makepayment-counter"},le={class:"col-md-4"},ie={class:"makepayment-counter"},de={class:"text-success"},me={class:"col-md-4"},ce={class:"makepayment-counter"},re={class:"text-warning"},ue={class:"row"},_e={class:"col-6"},pe={class:"col-6"},he={class:"col-6"},ye={class:"col-6"},ve={key:0,class:"col-6"},be={class:"col-6"},ge={class:"pt-3"},fe=["src"],ke={class:"form-field"},Ve=s("label",null," Notes: ",-1),Ae={class:"col-12"},qe=["placeholder"],we={key:0,class:"py-3"},Pe={class:"mt-2 text-end"},Se=["disabled"],$e={key:1,class:"pt-0"},xe={key:2,class:"pt-0"},Re={__name:"AddPayment",props:["show_add_payment_modal","invoice","total_paid_amount","total_pending_amount"],emits:["closeAddPaymentModal"],setup(A,{emit:q}){const{t:n}=B(),c=p({transaction_date:n("Transactoin Date"),account:n("Account"),select_account:n("Select Account"),amount:n("Amount"),payment_method:n("Payment Method"),contact_number:n("Contact Number"),select_payment_method:n("Select Payment Method"),enter_notes:n("enter notes...")});p(!1);const o=A,k={server_messages:{type:"",messages:""},is_submitting:!1,is_listing:!1,transaction_date:new Date().toISOString().split("T")[0],account:"",amount:"",payment_method:"",is_payment_disable:!1,is_online:!1,contact_number:o.invoice.customer_phone!=null?o.invoice.customer_phone:"",notes:""},e=O({...k});T();const w=K({transaction_date:b().required(n("name is required",{name:n("Transaction Date")})),account:b().required(n("name is required",{name:n("Account")})),amount:Z().typeError(n("must be a number",{name:n("Amount")})).required(n("name is required",{name:n("Amount")})).min(1,n("Amount must be more than 1")).test({name:"max",exclusive:!1,params:{},test:function(t,a){var l=$('[name="'+a.path+'"]').attr("max");return t<=parseFloat(l)?!0:a.createError({path:`${a.path}`,message:n("must be less than or equal to n",{name:n("Amount"),number:l})})}}),payment_method:b().required(n("name is required",{name:n("Payment Method")})),is_online:G().required(n("name is required",{name:n("Is Online")})),contact_number:b().nullable().when("is_online",{is:t=>t===!0,then:t=>t.required(n("name is required",{name:n("Contact Number")})),otherwise:t=>t.nullable()})}),P=q;function V(){document.getElementById("add_payment_form").reset(),N(),P("closeAddPaymentModal"),document.getElementById("close_btn").click()}F(()=>o.show_add_payment_modal,t=>{t&&(S(),x()),e.amount=o.total_pending_amount>0?o.total_pending_amount:"",e.payment_method=o.invoice.payment_method!=null?o.invoice.payment_method.slack:"",e.is_payment_disable=o.invoice.payment_method!=null});const g=p([]);async function S(){g.value=[];var t=new FormData;t.append("account_type","INCOME");let a=await axios.post("api/accounts/all",t);a=a.data.data,_.forEach(a,l=>{let y={key:l.slack,value:l.name};l.is_default==1&&(e.account=l.slack),g.value.push(y)})}const h=p([]);async function x(){h.value=[];let t=await axios.get("api/payment_methods/all");t=t.data.data,_.forEach(t,a=>{let l={key:a.slack,value:a.name,constant:a.constant};h.value.push(l)})}async function C(){_.forEach(h.value,t=>{t.constant=="ONLINE"&&t.key==e.payment_method?e.is_online=!0:e.is_online=!1})}p(null);async function M(){e.is_submitting=!0;var t=new FormData;t.append("invoice_slack",o.invoice.slack),t.append("transaction_date",e.transaction_date),t.append("account",e.account),t.append("amount",e.amount),t.append("payment_method",e.payment_method),t.append("notes",e.notes),t.append("is_online",e.is_online),t.append("contact_number",e.contact_number),await axios.post("/api/invoice/add_payment",t).then(a=>{if(a.data.status_code==200)toast.success(a.data.msg),e.is_submitting=!1,V();else{try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(a.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=a.data.msg}e.is_submitting=!1}}).catch(a=>{e.server_messages.type="error",e.server_messages.messages=a,e.is_submitting=!1,console.log(a)})}function N(){Object.assign(e,k)}return(t,a)=>{const l=U,y=I,E=D;return r(),u("div",W,[s("div",X,[s("div",Y,[s("div",ee,[s("h5",te,d(t.$t("Make Payment")),1),s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:V,id:"close_btn"})]),s("div",ae,[m(f(J),{"validation-schema":f(w),onSubmit:M,enctype:"multipart/form-data",id:"add_payment_form"},{default:R(()=>[s("div",se,[s("div",ne,[s("div",oe,[s("h3",null,d(o.invoice!=null?o.invoice.grand_product_amount:0),1),s("h6",null,d(t.$t("Total Amount"))+" (SAR)",1)])]),s("div",le,[s("div",ie,[s("h3",null,d(o.total_paid_amount),1),s("h6",de,d(t.$t("Paid Amount"))+" (SAR)",1)])]),s("div",me,[s("div",ce,[s("h3",null,d(o.total_pending_amount),1),s("h6",re,d(t.$t("Pending Amount"))+" (SAR)",1)])])]),s("div",ue,[s("div",_e,[m(l,{type:"date",name:"transaction_date",modelValue:e.transaction_date,"onUpdate:modelValue":a[0]||(a[0]=i=>e.transaction_date=i),label:c.value.transaction_date,required:!0},null,8,["modelValue","label"])]),s("div",pe,[m(y,{name:"account",label:"Account",modelValue:e.account,"onUpdate:modelValue":a[1]||(a[1]=i=>e.account=i),placeholder:c.value.select_account,options:g.value,required:""},null,8,["modelValue","placeholder","options"])]),s("div",he,[m(l,{type:"number",name:"amount",modelValue:e.amount,"onUpdate:modelValue":a[2]||(a[2]=i=>e.amount=i),label:c.value.amount+"(SAR)",required:!0,min:1,max:o.total_pending_amount!=null?o.total_pending_amount:0},null,8,["modelValue","label","max"])]),s("div",ye,[m(y,{name:"payment_method",label:c.value.payment_method,modelValue:e.payment_method,"onUpdate:modelValue":a[3]||(a[3]=i=>e.payment_method=i),placeholder:c.value.select_payment_method,options:h.value,required:"",onChange:a[4]||(a[4]=i=>C()),disabled:e.is_payment_disable},null,8,["label","modelValue","placeholder","options","disabled"])]),e.is_online==!0?(r(),u("div",ve,[m(l,{type:"number",name:"contact_number",modelValue:e.contact_number,"onUpdate:modelValue":a[5]||(a[5]=i=>e.contact_number=i),label:c.value.contact_number,required:!0},null,8,["modelValue","label"])])):v("",!0),s("div",be,[s("div",ge,[m(l,{type:"hidden",name:"is_online",modelValue:e.is_online,"onUpdate:modelValue":a[6]||(a[6]=i=>e.is_online=i),required:!0,islabel:!1},null,8,["modelValue"]),e.is_online==!0?(r(),u("img",{key:0,src:f(Q)},null,8,fe)):v("",!0)])])]),s("div",ke,[Ve,s("div",Ae,[L(s("textarea",{class:"form-control form-control-solid text-area",name:"notes","onUpdate:modelValue":a[7]||(a[7]=i=>e.notes=i),rows:"1",placeholder:c.value.enter_notes},null,8,qe),[[j,e.notes]])])]),e.server_messages.messages!=""?(r(),u("div",we,[m(E,{server_messages:e.server_messages},null,8,["server_messages"])])):v("",!0),s("div",Pe,[s("button",{type:"submit",class:"btn btn-primary",disabled:e.is_submitting},[e.is_submitting?(r(),z(H,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):v("",!0),e.is_submitting?(r(),u("span",$e,d(t.$t("Paying...")),1)):(r(),u("span",xe,d(t.$t("Pay")),1))],8,Se)])]),_:1},8,["validation-schema"])])])])])}}};export{Re as default};
