import D from"./ServerMessage.Wf7puwQc.js";import{_ as L}from"./VSelectInput.BEJPoRrx.js";import{u as F,r as f,e as I,b as O,P as q,o as E,v as z,d as J,g as n,h as m,i as t,t as c,k as p,w as P,j as y,Q as T,K as k,N as K,l as C,p as Q}from"./index.GdMxdeuf.js";import{F as R}from"./vee-validate.esm.9aElOHQY.js";import{c as G,a as H,e as W}from"./index.esm.0vhAmrVd.js";import{_ as X}from"./VTextInput.ZgtOiOMJ.js";/* empty css                                                   */import{C as Y}from"./ClipLoader.UcGuNCxH.js";import"./VTooltip.Ewb958d6.js";/* empty css                                                   */const Z={class:"modal hide",id:"addCategoryModal",tabindex:"-1","aria-labelledby":"Add Category","aria-modal":"true",role:"dialog","data-bs-backdrop":"static","data-bs-keyboard":"false"},ee={class:"modal-dialog modal-lg modal-dialog-centered"},ae={class:"modal-content"},te={class:"modal-header"},se={key:0,class:"modal-title"},oe={key:1,class:"modal-title"},re={class:"modal-body"},ie={class:""},le={class:"row"},ne={class:"col-md-6"},ce={class:"col-md-6"},de={class:"col-md-6"},me={class:"form-field"},_e={class:"input-group input-file-group"},ge={class:"btn btn-light-primary min-width-0 mb-0",for:"category_image"},ue={class:"col-4 pt-4"},pe={class:"form-field"},ye={class:"form-check form-switch"},fe={class:"form-check-label",for:"status"},ve={key:0,class:"py-3"},he={class:"mt-2 text-end"},be=["disabled"],ke={key:1,class:"pt-0"},Ce={key:2,class:"pt-0"},je={__name:"AddCategory",props:{edit_data:{type:[Array,Object]}},emits:["closeAddCategoryModal"],setup(w,{emit:N}){const{t:r}=F(),u=f(!1),v={server_messages:{type:"",messages:""},is_submitting:!1,is_listing:!1,category_slack:"",search_category:"",category_name:"",parent_category:"",category_name_ar:"",status:!0,image:""},e=I({...v});O();const V=G({category_name:H().required(r("name is required",{name:r("Category Name")})).min(3,r("name must be at least n characters",{name:r("Category Name"),number:3})).max(20,r("Must be less than 20 characters",{name:r("Category Name"),number:20})),status:W().label("status")}),S=N,g=w,d=q(g,"edit_data"),M=r("Select Parent"),A=r("Category Name");function h(){document.getElementById("add_category_form").reset(),j(),S("closeAddCategoryModal"),document.getElementById("close_btn").click()}E(()=>{U()}),z(()=>g.edit_data,a=>{a&&(e.category_name=a.name,e.category_name_ar=a.name_ar!=null?a.name_ar:"",e.status=a.status==1,e.is_favorite=a.is_favorite==1,e.parent_category=a.parent_id!=null?a.parent_id:"",e.category_slack=a.slack)});const o=f([]);async function U(){await axios.post("/api/category/add").then(a=>{if(u.value=!1,a.data.status_code==200)o.value=a.data.data.categories,o.value=[{id:"",name:"None",name_ar:r("None")}].concat(o.value),g.edit_data&&g.edit_data.parent_id==null&&(o.value=o.value.filter(s=>g.edit_data.id!=s.id)),u.value=!0;else{try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(a.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=a.data.msg}u.value=!1}}).catch(a=>{e.server_messages.type="error",e.server_messages.messages=a,u.value=!1,console.log(a)})}J(()=>e.search_category!=""?d.value?_.filter(o.value,function(a){return a.name.toLowerCase().includes(e.search_category.toLowerCase())&&a.id!=d.value.id}):_.filter(o.value,function(a){return a.name.toLowerCase().includes(e.search_category.toLowerCase())}):d.value?($("input[name='category']").value==d.value.id&&$("input[name='category']").attr("checked",!0),o.value.filter(a=>a.id!=d.value.id),_.filter(o.value,function(a){return a.id!=d.value.id})):o.value);async function x(a){e.image=a.target.files[0]}f(null);async function B(){e.is_submitting=!0;var a=new FormData;a.append("parent_category",e.parent_category),a.append("category_name",e.category_name),a.append("category_name_ar",e.category_name_ar),a.append("is_favorite",e.is_favorite),a.append("status",e.status),a.append("image",e.image),a.append("category_slack",e.category_slack);var s=e.category_slack!=""?"/api/category/update":"/api/category/save";await axios.post(s,a,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>{if(i.data.status_code==200)toast.success(i.data.msg),e.is_submitting=!1,h();else{try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(i.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=i.data.msg}e.is_submitting=!1}}).catch(i=>{e.server_messages.type="error",e.server_messages.messages=i,e.is_submitting=!1,console.log(i)})}function j(){Object.assign(e,v)}return(a,s)=>{const i=L,b=D;return n(),m("div",Z,[t("div",ee,[t("div",ae,[t("div",te,[e.category_slack==""?(n(),m("h5",se,c(a.$t("Add Category")),1)):(n(),m("h5",oe,c(a.$t("Update Category")),1)),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:h,id:"close_btn"})]),t("div",re,[p(y(R),{"validation-schema":y(V),onSubmit:B,enctype:"multipart/form-data","initial-values":e,id:"add_category_form"},{default:P(()=>[t("div",ie,[t("div",le,[t("div",ne,[p(i,{name:"parent_category",label:y(M),options:o.value,modelValue:e.parent_category,"onUpdate:modelValue":s[0]||(s[0]=l=>e.parent_category=l),size:"normal"},null,8,["label","options","modelValue"])]),t("div",ce,[p(X,{type:"text",name:"category_name",modelValue:e.category_name,"onUpdate:modelValue":s[1]||(s[1]=l=>e.category_name=l),label:y(A),required:!0},null,8,["modelValue","label"])]),t("div",de,[t("div",me,[t("label",null,c(a.$t("Upload")),1),t("div",_e,[t("input",{class:"form-control form-control-solid",name:"category_image",type:"file",id:"category_image",accept:"image/jpg, image/jpeg, image/png",onChange:x},null,32),t("label",ge,c(a.$t("Upload")),1)])])]),t("div",ue,[t("div",pe,[t("div",ye,[k(t("input",{class:"form-check-input me-2",type:"checkbox",role:"switch",id:"status",checked:"","onUpdate:modelValue":s[2]||(s[2]=l=>e.status=l)},null,512),[[T,e.status]]),t("label",fe,c(a.$t("Active")),1)])])])]),k(t("input",{type:"hidden","onUpdate:modelValue":s[3]||(s[3]=l=>e.category_slack=l)},null,512),[[K,e.category_slack]])]),e.server_messages.messages!=""?(n(),m("div",ve,[p(b,{server_messages:e.server_messages},null,8,["server_messages"])])):C("",!0),t("div",he,[t("button",{type:"submit",class:"btn btn-primary",disabled:e.is_submitting},[e.is_submitting?(n(),Q(Y,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):C("",!0),e.is_submitting?(n(),m("span",ke,c(a.$t("Saving...")),1)):(n(),m("span",Ce,c(a.$t("Save")),1))],8,be)])]),_:1},8,["validation-schema","initial-values"])])])])])}}};export{je as default};
