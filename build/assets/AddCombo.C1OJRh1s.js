import{u as ae,b as oe,d as ne,e as C,r as v,o as le,v as I,g as c,p as S,w as ie,j as o,l as x,t as i,i as s,F as M,h as m,x as D,L as O,K as V,k as y,Q as re,N as j,q as B,_ as L}from"./index.GdMxdeuf.js";import{_ as ce}from"./VSelect.c4Loo_XL.js";import{_ as de}from"./VTextInput.ZgtOiOMJ.js";import{F as ue}from"./vee-validate.esm.9aElOHQY.js";import{c as me,a as _e,e as pe,d as he}from"./index.esm.0vhAmrVd.js";import{C as ve}from"./ClipLoader.UcGuNCxH.js";/* empty css                                                                */import"./VTooltip.Ewb958d6.js";/* empty css                                                   */const ge={class:"row card-strash"},fe={class:"col-md-12"},ye={class:"row"},be={class:"col-md-3 col-12 mb-4"},ke={class:"card"},xe={class:"row"},Ve={class:"col-12"},we={class:"form-field"},Fe={for:""},$e=["value"],Ue={class:"col-12"},Pe={class:"col-12"},Ce={class:"form-field"},Se={for:""},Ae={value:"1"},Ne={value:"2"},qe={key:0,class:"col-12"},Te={key:1,class:"col-12"},Ee={class:"col-12"},Ie={class:"input-group input-file-group"},Me={class:"btn btn-light-primary min-width-0 mb-0",for:"formFile"},De={class:"col-12 mt-5"},Oe={class:"form-field"},je={class:"form-check form-switch"},Be={class:"form-check-label",for:"status"},Le={class:"col-md-9 col-12 mb-4"},ze={class:"card"},Qe={class:"row"},Re={class:"section-title pb-3 text-muted"},He={class:"col-6 col-md-4 mb-3"},Je={class:"table-responsive"},Ke={class:"table table-hover table-bordered mb-3"},Ge={class:"bg-light"},We={class:"text-center"},Xe={class:"text-center"},Ye={class:"text-center"},Ze={class:"text-center"},et={class:"text-center"},tt=["onUpdate:modelValue"],st=["onUpdate:modelValue"],at={key:0,"data-title":"Search Product",width:"20%"},ot={key:1,"data-title":"Search Product",width:"20%"},nt={key:2,"data-title":"Quantity",width:"15%"},lt={key:3,class:"text-end"},it=s("span",null,"1.00",-1),rt=[it],ct={"data-title":"Measurement Unit",width:"15%",class:"text-end"},dt={"data-title":"Unit Price",width:"15%",class:"text-end"},ut={"data-title":"Amount",width:"10%",class:"text-end"},mt={"data-title":"Action",width:"5%",class:"text-center"},_t=["onClick"],pt=s("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[s("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),ht=[pt],vt={class:"row justify-content-between mt-1"},gt={class:"row"},ft={class:"col-10 mt-5 text-end m-auto"},yt={class:"col-2 mt-5 text-end text-primary fw-bold"},bt={key:0},kt={key:1},xt={class:"text-end"},Vt=["disabled"],wt={key:1,class:"pt-0"},Ft={key:2,class:"pt-0"},Et={__name:"AddCombo",props:["combo","combo_products"],setup(z){const{t:h}=ae(),Q=B(()=>L(()=>import("./ServerMessage.Wf7puwQc.js"),__vite__mapDeps([0,1,2]))),R=B(()=>L(()=>import("./ProductSearch.7we3JR7U.js"),__vite__mapDeps([3,1,2,4,5,6,7,8]))),A=oe(),w=ne(()=>A.user.currency.symbol),N={server_messages:{type:"",messages:""},is_submitting:!1,name:"",type:1,is_stockable:!0,status:!0,image:"",description:"",purchase_price:"",alert_quantity:"",pricing_method:1,price:0,tax_id:"",tax_amount:0,amount:0,price_readonly:!0,tax_readonly:!0,image:"",combo_slack:""},t=C({...N}),H=me({name:_e().required(h("name is required",{name:h("Combo Name")})).min(3,h("name must be at least n characters",{name:h("Combo Name"),number:3})),status:pe().label("status"),price:he().min(0,h("must be greater than or equal to 0",{name:h("Price")}))});let J=[{key:1,value:"Plain"}],F=v(0),b=v(0),q=v(0);v(!0);const T=h("Select Tax"),K=h("Price"),E=h("Combo Name"),G=h("Search and Add Product"),W=h("Add Service"),$=v([]);le(()=>{X()});async function X(){_.forEach(A.user.country.taxes,e=>{let n={key:e.id,value:e.name,percentage:e.total_percentage};$.value.push(n)})}async function Y(e){t.image=e.target.files[0]}const u=v([]),k=v([]),U=z;I(()=>U.combo,e=>{e&&(t.name=e.name,t.is_stockable=e.is_stockable,t.status=e.status==1,t.price=e.price,t.tax_id=e.tax_id,t.tax_amount=e.tax_amount,t.amount=e.amount,t.pricing_method=e.tax_id!=null?1:2,t.combo_slack=e.slack,g())}),I(()=>U.combo_products,e=>{if(e){let n,r=v([]);U.combo_products.forEach((l,a)=>{let p=new FormData;k.value.push(l.product.slack),p.append("product_slack",l.product.slack),axios.post("/api/product/measurements",p).then(d=>{_.forEach(d.data.data,f=>{let P={key:f.id,value:f.unit_name,id:f.slack};r.value.push(P)}),n=C({type:1,product_slack:l.product.slack,product_name:l.product.name,quantity:l.quantity,stock_measurement_unit_id:l.measurement_unit_id,stock_measurement_unit_value:l.stock_measurement_unit&&l.stock_measurement_unit.unit_name?l.stock_measurement_unit.unit_name:"",price:l.product.sale_price,total_amount:l.product.sale_price,measurement_units:r}),u.value.push(n)})}),g()}});async function Z(e){k.value.push(e.slack);let n=v([]),r,l=new FormData;l.append("product_slack",e.slack),await axios.post("/api/product/measurements",l).then(a=>{_.forEach(a.data.data,p=>{let d={key:p.id,value:p.unit_name,id:p.slack};n.value.push(d)}),r=C({type:1,product_slack:e.slack,product_name:e.name,quantity:1,stock_measurement_unit_id:e.stock_measurement_unit_id,stock_measurement_unit_value:e.stock_measurement_unit&&e.stock_measurement_unit.unit_name?e.stock_measurement_unit.unit_name:"",price:e.sale_price,total_amount:e.sale_price,measurement_units:n})}).catch(a=>{t.server_messages.type="error",t.server_messages.messages=a}),u.value.push(r),g()}function g(){var e=0;b=0,F=0;for(var n in u.value){var r=0,l=0,a=u.value[n].quantity,p=u.value[n].price;if(!isNaN(a)&&a!=null&&a!=""&&!isNaN(p)&&p!=null&&p!="")l=parseFloat(a)*parseFloat(p),l=l.toFixed(2),u.value[n].total_amount=l,l=parseFloat(l)+parseFloat(r),l=l.toFixed(2),u.value[n].total_amount=l,b=parseFloat(b)+parseFloat(r),e=parseFloat(e)+parseFloat(l);else{u.value[n].price=0,u.value[n].total_amount=0;continue}}if(F=e.toFixed(2),t.pricing_method==2&&(t.price=F),t.tax_id!=""){let f=$.value.find(P=>P.key==t.tax_id);if(f&&parseFloat(f.percentage)>0){var d=parseFloat(f.percentage)/100*parseFloat(t.price);b=d.toFixed(2)}}t.tax_amount=b,q=parseFloat(t.price)+parseFloat(t.tax_amount),t.amount=q.toFixed(2)}function ee(e){u.value.splice(u.value.indexOf(e),1),k.value.splice(k.value.indexOf(e.product_slack),1),g()}async function te(){t.is_submitting=!0;var e=new FormData;e.append("name",t.name),e.append("pricing_method",t.pricing_method),e.append("price",t.price),e.append("type",t.type),u.value.length>0&&e.append("selected_products",JSON.stringify(u.value)),e.append("amount",t.amount),t.pricing_method!=1?e.append("tax_id",""):e.append("tax_id",t.tax_id),e.append("tax_amount",t.tax_amount),e.append("image",t.image),e.append("description",t.description),e.append("status",t.status),e.append("combo_slack",t.combo_slack);var n=t.combo_slack!=""&&t.combo_slack!=null?"/api/combo/update":"/api/combo/save";await axios.post(n,e).then(r=>{if(r.data.status_code==200)toast.success(r.data.msg),t.is_submitting=!1,se(),router.push("/combos");else{try{t.server_messages.type="error",t.server_messages.messages=JSON.parse(r.data.msg)}catch{t.server_messages.type="error",t.server_messages.messages=r.data.msg}t.is_submitting=!1}}).catch(r=>{t.server_messages.type="error",t.server_messages.messages=r,t.is_submitting=!1})}function se(){Object.assign(t,N)}return(e,n)=>{const r=de,l=ce;return c(),S(o(ue),{"validation-schema":o(H),enctype:"multipart/form-data",onSubmit:te},{default:ie(()=>[s("div",ge,[s("div",fe,[o(t).server_messages.messages!=""?(c(),S(o(Q),{key:0,class:"py-3",server_messages:o(t).server_messages},null,8,["server_messages"])):x("",!0),s("div",ye,[s("div",be,[s("div",ke,[s("div",xe,[s("div",Ve,[s("div",we,[s("label",Fe,i(e.$t("Type")),1),V(s("select",{name:"pricing_method",class:"form-control form-control-solid","onUpdate:modelValue":n[0]||(n[0]=a=>o(t).type=a)},[(c(!0),m(M,null,D(o(J),a=>(c(),m("option",{value:a.key},i(a.value),9,$e))),256))],512),[[O,o(t).type]])])]),s("div",Ue,[y(r,{type:"text",name:"name",modelValue:o(t).name,"onUpdate:modelValue":n[1]||(n[1]=a=>o(t).name=a),label:o(E),placeholder:o(E),required:!0},null,8,["modelValue","label","placeholder"])]),s("div",Pe,[s("div",Ce,[s("label",Se,i(e.$t("Pricing Method")),1),V(s("select",{name:"pricing_method",class:"form-control form-control-solid","onUpdate:modelValue":n[2]||(n[2]=a=>o(t).pricing_method=a)},[s("option",Ae,i(e.$t("Custom Pricing")),1),s("option",Ne,i(e.$t("Based On Total Cost of Items Added")),1)],512),[[O,o(t).pricing_method]])])]),o(t).pricing_method==1?(c(),m("div",qe,[y(r,{type:"number",name:"price",input_group_text:o(w),modelValue:o(t).price,"onUpdate:modelValue":n[3]||(n[3]=a=>o(t).price=a),min:"0.01",step:"0.01",label:o(K),onInput:g},null,8,["input_group_text","modelValue","label"])])):x("",!0),o(t).pricing_method==1?(c(),m("div",Te,[y(l,{modelValue:o(t).tax_id,"onUpdate:modelValue":n[4]||(n[4]=a=>o(t).tax_id=a),name:"tax_id",label:o(T),placeholder:o(T),options:o($),onInput:g},null,8,["modelValue","label","placeholder","options"])])):x("",!0),s("div",Ee,[s("label",null,i(e.$t("Image")),1),s("div",Ie,[s("input",{class:"form-control form-control-solid",name:"image",type:"file",id:"formFile",accept:"image/jpg, image/jpeg, image/png",onChange:Y},null,32),s("label",Me,i(e.$t("Upload")),1)])]),s("div",De,[s("div",Oe,[s("div",je,[V(s("input",{class:"form-check-input me-2",type:"checkbox",role:"switch",id:"status",checked:"","onUpdate:modelValue":n[5]||(n[5]=a=>o(t).status=a)},null,512),[[re,o(t).status]]),s("label",Be,i(e.$t("Active")),1)])])])])])]),s("div",Le,[s("div",ze,[s("div",Qe,[s("h5",Re,i(e.$t("Products"))+":",1),s("div",He,[y(o(R),{onSelectProduct:Z,placeholder:o(G),selected_products:o(k),button_placeholder:o(W)},null,8,["placeholder","selected_products","button_placeholder"])]),s("div",Je,[s("table",Ke,[s("thead",Ge,[s("tr",null,[s("th",null,i(e.$t("Product/Service")),1),s("th",We,i(e.$t("Quantity")),1),s("th",Xe,i(e.$t("Measurement Unit")),1),s("th",Ye,i(e.$t("Price")),1),s("th",Ze,i(e.$t("Total")),1),s("th",et,i(e.$t("Remove")),1)])]),s("tbody",null,[o(u).length>0?(c(!0),m(M,{key:0},D(o(u),(a,p)=>(c(),m("tr",{key:p},[V(s("input",{type:"hidden",name:"product_name","onUpdate:modelValue":d=>a.product_name=d},null,8,tt),[[j,a.product_name]]),V(s("input",{type:"hidden",name:"product.sku","onUpdate:modelValue":d=>a.product_slack=d},null,8,st),[[j,a.product_slack]]),a.type==1?(c(),m("td",at,i(a.product_name),1)):(c(),m("td",ot,[y(r,{type:"text",name:"product_name",label:"",modelValue:a.product_name,"onUpdate:modelValue":d=>a.product_name=d},null,8,["modelValue","onUpdate:modelValue"])])),a.type==1?(c(),m("td",nt,[y(r,{type:"number",name:"quantity",label:"",modelValue:a.quantity,"onUpdate:modelValue":d=>a.quantity=d,min:"0.01",step:"0.01",onInput:g},null,8,["modelValue","onUpdate:modelValue"])])):(c(),m("td",lt,rt)),s("td",ct,[y(l,{name:"measurement_unit_id",placeholder:a.quantity>1?"Units":"Unit",options:a.measurement_units,modelValue:a.stock_measurement_unit_id,"onUpdate:modelValue":d=>a.stock_measurement_unit_id=d,label:""},null,8,["placeholder","options","modelValue","onUpdate:modelValue"])]),s("td",dt,i(a.price)+" "+i(o(w)),1),s("td",ut,i(a.total_amount),1),s("td",mt,[s("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:d=>ee(a)},ht,8,_t)])]))),128)):x("",!0)])])]),s("div",vt,[s("div",gt,[s("div",ft,[s("h5",null,i(e.$t("Combo Price")),1)]),s("div",yt,[o(t).pricing_method==1?(c(),m("h5",bt,i(o(t).amount)+" "+i(o(w)),1)):(c(),m("h5",kt,i(o(F))+" "+i(o(w)),1))])])])])])])])])]),s("div",xt,[s("button",{type:"submit",class:"btn btn-primary",disabled:o(t).is_submitting},[o(t).is_submitting?(c(),S(ve,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):x("",!0),o(t).is_submitting?(c(),m("span",wt,i(e.$t("Saving...")),1)):(c(),m("span",Ft,i(e.$t("Save")),1))],8,Vt)])]),_:1},8,["validation-schema"])}}};export{Et as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ServerMessage.Wf7puwQc.js","assets/index.GdMxdeuf.js","assets/index.1t-AB2n6.css","assets/ProductSearch.7we3JR7U.js","assets/vee-validate.esm.9aElOHQY.js","assets/index.esm.0vhAmrVd.js","assets/BeatLoader.czpWuXPY.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
