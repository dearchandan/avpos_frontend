import{u as Z,r as v,e as q,s as tt,o as et,v as st,g as i,h as d,i as e,t as l,l as u,j as g,m as b,w as R,k as V,F as at,y as w,T as ot,x as nt,p as P,q as lt,_ as it}from"./index.sP6fhsqN.js";import ct from"./ServerMessage.EFQMOwoZ.js";import{_ as rt}from"./VSelectInput.rvOuFTIX.js";import{_ as dt}from"./VTextInput.EPCajChY.js";import{_ as ut}from"./VSelect.twStq9pE.js";import{a as mt,E as _t,F as pt}from"./vee-validate.esm.2kXgdFia.js";import{c as D,h as ht,a as E,b as vt}from"./index.esm.DHYHwGJ4.js";/* empty css                                                   */import{C as I}from"./ClipLoader._89zL49D.js";import"./VTooltip.kcvohVRA.js";/* empty css                                                                *//* empty css                                                   */const bt={class:"row"},yt={class:"col-md-12"},kt={class:"card"},gt={class:"section-title text-muted"},ft={key:0,class:"row"},wt={key:0,class:"col-12"},Vt={class:"row"},$t={class:"col-md-3"},jt={class:"col-md-3"},Ct={class:"label"},St={key:1,class:"col-12"},qt={class:"row"},Pt={class:"col-md-3"},It={class:"row"},Ut={class:"col-12 py-3"},Nt={class:"table-responsive"},Ot={class:"table table-condensed"},Ft={width:"25%"},At={width:"10%"},Rt={width:"10%"},Dt={width:"10%"},Et=e("span",{class:"text-danger"},"*",-1),xt={width:"10%"},Bt={width:"10%"},Gt=e("span",{class:"text-danger"},"*",-1),Mt={width:"15%"},Qt=e("span",{class:"text-danger"},"*",-1),zt={width:"15%"},Lt={key:0,width:"5%",class:"text-center"},Tt=["onChange"],Jt={value:"Stock On Fire"},Wt={value:"Stolen Goods"},Ht={value:"Damaged Goods"},Kt={value:"Stock Written Off"},Xt={value:"Inventory Revaluation"},Yt={value:"Custom"},Zt={key:0,class:"text-center"},te=["onClick"],ee=e("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[e("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),se=[ee],ae={key:1},oe={colspan:"10",class:"text-center"},ne={key:0,class:"col-12 py-3"},le={key:1,class:"row mt-2 justify-content-end"},ie={class:"col-auto"},ce=["disabled"],re={key:1,class:"pt-0"},de={key:2,class:"pt-0"},ue={class:"col-auto"},me=["disabled"],_e={key:1,class:"pt-0"},pe={key:2,class:"pt-0"},he=e("svg",{width:"14",height:"10",viewBox:"0 0 14 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12.6364 1L4.63636 9L1 5.36364",stroke:"white","stroke-width":"1.6","stroke-linecap":"round","stroke-linejoin":"round",strock:"currentColor"})],-1),ve={class:"col-auto"},be=["disabled"],ye={key:1,class:"pt-0"},ke={key:2,class:"pt-0"},ge=e("svg",{width:"10",height:"10",viewBox:"0 0 10 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 1L1 9",stroke:"currentColor","stroke-width":"1.6","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M1 1L9 9",stroke:"currentColor","stroke-width":"1.6","stroke-linecap":"round","stroke-linejoin":"round"})],-1),fe=["disabled"],Ee={__name:"StockAdjustmentProducts",props:["stock_adjustment","sel_branch_id"],setup(x){const{t:o}=Z(),U=v({search_placeholder:o("Search and Add Product"),add_service:o("Add Service")}),B=lt(()=>it(()=>import("./ProductSearchByBranch.ysKuqg-s.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),s=q({...{server_messages:{type:"",messages:""},search_type:2,stock_adjustment_products:[],adjustment_status:1}}),G=D().shape({stock_adjustment_products:ht(D({action:E().required(o("name is required",{name:o("Action")})),reason:E().required(o("name is required",{name:o("Reason")})),quantity:vt().typeError(o("must be a number",{name:o("Quantity")})).when("action",{is:t=>t==2,then:t=>t.positive(o("must be a positive number",{name:o("Quantity")})).required(o("name is required",{name:o("Quantity")})).test({name:"max",exclusive:!1,params:{},test:function(a,c){var h=$('[name="'+c.path+'"]').attr("max");return a<=parseFloat(h)?!0:c.createError({path:`${c.path}`,message:o("must be less than or equal to n",{name:o("Quantity"),number:h})})}}),otherwise:t=>t.positive(o("must be a positive number",{name:o("Quantity")})).required(o("name is required",{name:o("Quantity")}))})})).required()}),M=v([{id:1,name:"Increment"},{id:2,name:"Decrement"}]);v([{id:"Stock On Fire",name:o("Stock On Fire")},{id:"Stolen Goods",name:o("Stolen Goods")},{id:"Damaged Goods",name:o("Damaged Goods")},{id:"Stock Written Off",name:o("Stock Written Off")},{id:"Inventory Revaluation",name:o("Inventory Revaluation")},{id:"Custom",name:o("Custom")}]);const p=x;v(!1);const Q=tt(Multiselect),j=v(""),f=v([]);et(()=>{z(),N()});function z(){_.forEach(p.stock_adjustment.stock_adjustment_products,t=>{f.value.push(t.product.slack);let a={product_slack:t.product.slack,product_name:t.product.name,purchase_price:t.purchase_price,action:t.action,reason:t.reason,custom_reason:t.custom_reason,max_quantity:t.selected_branch_stock,quantity:t.quantity,item_total:t.quantity*t.purchase_price};s.stock_adjustment_products.push(a)})}const C=v([]);async function N(){C.value=[];let t=await axios.get("api/categories/all");t=t.data.data,_.forEach(t,a=>{let c={key:a.slack,value:a.code+" - "+a.name};C.value.push(c)})}const y=v([]),O=v([]);async function F(){y.value=[];let t=await axios.get("api/products/all",{params:{category:s.category,only_available:1,is_stocable_products:1,not_recipe:1,branch_id:p.sel_branch_id}});y.value=t.data.data,L(),O.value=JSON.parse(JSON.stringify(t.data.data))}function L(){s.stock_adjustment_products.map(function(t,a){let c=y.value.findIndex(h=>h.slack===t.product_slack);c>-1&&y.value.splice(c,1)})}const k=v();st(j,t=>{J(t)});function T(t){s.stock_adjustment_products[t].reason!="Custom"&&(s.stock_adjustment_products[t].custom_reason="")}function A(t){let a=parseFloat(s.stock_adjustment_products[t].quantity);isNaN(a)&&(a=0);let c=parseFloat(s.stock_adjustment_products[t].purchase_price)*a;return s.stock_adjustment_products[t].item_total=c,c}function J(t){if(y.value.findIndex(function(a,c){a.slack==t&&(k.value=a)}),k.value!=null){isNaN(k.value.purchase_price)&&(k.value.purchase_price=0),f.value.push(k.value.slack);let a=q({product_slack:k.value.slack,product_name:k.value.name,purchase_price:k.value.purchase_price,action:"",reason:"",custom_reason:"",max_quantity:k.value.quantity,quantity:"",item_total:""});s.stock_adjustment_products.push(a),y.value.splice(y.value.findIndex(c=>c.slack===j.value),1)}}function W(t){isNaN(t.purchase_price)&&(t.purchase_price=0),f.value.push(t.slack);let a=q({product_slack:t.slack,product_name:t.name,purchase_price:t.purchase_price,action:"",reason:"",custom_reason:"",max_quantity:t.quantity,quantity:"",item_total:""});s.stock_adjustment_products.push(a)}function H(t){s.stock_adjustment_products.splice(s.stock_adjustment_products.indexOf(t),1),f.value.splice(f.value.indexOf(t.product_slack),1);let a=_.find(O.value,c=>c.slack==t.product_slack);a!=="undefined"&&y.value.push(a),N(),F()}function S(t){s.adjustment_status=t,document.getElementById("submit_btn").click()}async function K(){s.is_submitting=!0;var t=new FormData;t.append("stock_adjustment_slack",p.stock_adjustment.slack),t.append("status",s.adjustment_status),t.append("products",JSON.stringify(s.stock_adjustment_products)),await axios.post("/api/stock_adjustment/product/update",t).then(a=>{if(a.data.status_code==200)toast.success(a.data.msg),setInterval(()=>{window.location.href="/stock_adjustments"},2e3);else{try{s.server_messages.type="error",s.server_messages.messages=JSON.parse(a.data.msg)}catch{s.server_messages.type="error",s.server_messages.messages=a.data.msg}s.is_submitting=!1}}).catch(a=>{s.server_messages.type="error",s.server_messages.messages=a,s.is_submitting=!1,console.log(a)})}return(t,a)=>{const c=ut,h=dt,X=rt,Y=ct;return i(),d("div",bt,[e("div",yt,[e("div",kt,[e("h5",gt,l(t.$t("Products Details"))+":",1),p.stock_adjustment.status<2?(i(),d("div",ft,[s.search_type==1?(i(),d("div",wt,[e("div",Vt,[e("div",$t,[u(c,{name:"categories",label:g(o)("Category"),modelValue:s.category,"onUpdate:modelValue":a[0]||(a[0]=n=>s.category=n),placeholder:"--"+g(o)("Select Category")+"--",options:C.value,onChange:F},null,8,["label","modelValue","placeholder","options"])]),e("div",jt,[e("label",Ct,l(t.$t("Products")),1),u(g(Q),{modelValue:j.value,"onUpdate:modelValue":a[1]||(a[1]=n=>j.value=n),options:y.value,label:"name",valueProp:"slack",mode:"single",searchable:!0,class:"form-control form-control-solid p-0"},null,8,["modelValue","options"])])])])):b("",!0),s.search_type==2?(i(),d("div",St,[e("div",qt,[e("div",Pt,[u(g(B),{onSelectProduct:W,placeholder:U.value.search_placeholder,selected_products:f.value,button_placeholder:U.value.add_service,is_stocable_products:1,not_recipe:1,only_available:1,is_stock_adjustment:1,selected_branch_id:p.sel_branch_id},null,8,["placeholder","selected_products","button_placeholder","selected_branch_id"])])])])):b("",!0)])):b("",!0),e("div",It,[u(g(pt),{onSubmit:K,"validation-schema":g(G),"initial-values":s,id:"products_submit"},{default:R(()=>[e("div",Ut,[e("div",Nt,[e("table",Ot,[e("thead",null,[e("tr",null,[e("th",Ft,l(t.$t("Product")),1),e("th",At,l(t.$t("Current Quantity")),1),e("th",Rt,l(t.$t("Stock Action")),1),e("th",Dt,[V(l(t.$t("Quantity")),1),Et]),e("th",xt,l(t.$t("Purch. Price")),1),e("th",Bt,[V(l(t.$t("Purch. Total Amt")),1),Gt]),e("th",Mt,[V(l(t.$t("Reason")),1),Qt]),e("th",zt,l(t.$t("Custom Reason")),1),p.stock_adjustment.status<2?(i(),d("th",Lt,l(t.$t("Remove")),1)):b("",!0)])]),e("tbody",null,[s.stock_adjustment_products.length>0?(i(!0),d(at,{key:0},nt(s.stock_adjustment_products,(n,m)=>(i(),d("tr",{key:m},[e("td",null,[e("strong",null,l(n.product_name),1)]),e("td",null,[u(h,{type:"number",name:"stock_adjustment_products["+m+"].max_quantity",modelValue:n.max_quantity,"onUpdate:modelValue":r=>n.max_quantity=r,disabled:"",islabel:!1,class:w("mt-3")},null,8,["name","modelValue","onUpdate:modelValue"])]),e("td",null,[u(X,{modelValue:n.action,"onUpdate:modelValue":r=>n.action=r,class:w(t.mt3),name:"stock_adjustment_products["+m+"].action",options:M.value,islabel:!1},null,8,["modelValue","onUpdate:modelValue","class","name","options"])]),e("td",null,[u(h,{type:"number",name:"stock_adjustment_products["+m+"].quantity",onInput:r=>A(m),modelValue:n.quantity,"onUpdate:modelValue":r=>n.quantity=r,max:n.max_quantity,min:"1",disabled:p.stock_adjustment.status>1,islabel:!1,class:w("mt-3")},null,8,["name","onInput","modelValue","onUpdate:modelValue","max","disabled"])]),e("td",null,[u(h,{type:"number",name:"stock_adjustment_products["+m+"].purchase_price",onInput:r=>A(m),modelValue:n.purchase_price,"onUpdate:modelValue":r=>n.purchase_price=r,disabled:p.stock_adjustment.status>1,islabel:!1,class:w("mt-3")},null,8,["name","onInput","modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[u(h,{type:"number",name:"stock_adjustment_products["+m+"].item_total",modelValue:n.item_total,"onUpdate:modelValue":r=>n.item_total=r,disabled:p.stock_adjustment.status>1,islabel:!1,class:w("mt-3"),readonly:""},null,8,["name","modelValue","onUpdate:modelValue","disabled"])]),e("td",null,[u(g(mt),{name:"stock_adjustment_products["+m+"].reason",modelValue:n.reason,"onUpdate:modelValue":r=>n.reason=r},{default:R(({field:r,meta:Ve,errors:$e})=>[e("select",ot(r,{class:"form-control form-control-solid",onChange:je=>T(m)}),[e("option",Jt,l(t.$t("Stock On Fire")),1),e("option",Wt,l(t.$t("Stolen Goods")),1),e("option",Ht,l(t.$t("Damaged Goods")),1),e("option",Kt,l(t.$t("Stock Written Off")),1),e("option",Xt,l(t.$t("Inventory Revaluation")),1),e("option",Yt,l(t.$t("Custom")),1)],16,Tt)]),_:2},1032,["name","modelValue","onUpdate:modelValue"]),u(g(_t),{name:"stock_adjustment_products["+m+"].reason",as:"div",class:"error"},null,8,["name"])]),e("td",null,[u(h,{type:"text",name:"stock_adjustment_products["+m+"].custom_reason",modelValue:n.custom_reason,"onUpdate:modelValue":r=>n.custom_reason=r,disabled:n.reason!="Custom",class:w("mt-3"),islabel:!1},null,8,["name","modelValue","onUpdate:modelValue","disabled"])]),p.stock_adjustment.status<2?(i(),d("td",Zt,[e("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:r=>H(n)},se,8,te)])):b("",!0)]))),128)):(i(),d("tr",ae,[e("td",oe,l(t.$t("No Product Available")),1)]))])])])]),s.server_messages.messages!=""?(i(),d("div",ne,[u(Y,{server_messages:s.server_messages},null,8,["server_messages"])])):b("",!0),p.stock_adjustment.status==1?(i(),d("div",le,[e("div",ie,[e("button",{type:"button",class:"btn btn-primary dev_product_submit",disabled:s.is_submitting||s.stock_adjustment_products.length==0,onClick:a[2]||(a[2]=n=>S(1))},[s.is_submitting?(i(),P(I,{key:0,color:"white",size:"20px",class:"pt-2"})):b("",!0),s.is_submitting?(i(),d("span",re,l(t.$t("Saving...")),1)):(i(),d("span",de,l(t.$t("Save")),1))],8,ce)]),e("div",ue,[e("button",{type:"button",class:"btn btn-success dev_product_submit",disabled:s.is_submitting||s.stock_adjustment_products.length==0,onClick:a[3]||(a[3]=n=>S(2))},[s.is_submitting?(i(),P(I,{key:0,color:"white",size:"20px",class:"pt-2"})):b("",!0),s.is_submitting?(i(),d("span",_e,l(t.$t("Approving...")),1)):(i(),d("span",pe,[he,V(" "+l(t.$t("Approve")),1)]))],8,me)]),e("div",ve,[e("button",{type:"button",class:"btn btn-danger dev_product_submit",disabled:s.is_submitting||s.stock_adjustment_products.length==0,onClick:a[4]||(a[4]=n=>S(3))},[s.is_submitting?(i(),P(I,{key:0,color:"white",size:"20px",class:"pt-2"})):b("",!0),s.is_submitting?(i(),d("span",ye,l(t.$t("Rejecting...")),1)):(i(),d("span",ke,[ge,V(" "+l(t.$t("Reject")),1)]))],8,be)])])):b("",!0),e("button",{type:"submit",class:"d-none",disabled:s.is_submitting,id:"submit_btn"},null,8,fe)]),_:1},8,["validation-schema","initial-values"])])])])])}}};export{Ee as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ProductSearchByBranch.ysKuqg-s.js","assets/index.sP6fhsqN.js","assets/index.KTHCd6a8.css","assets/vee-validate.esm.2kXgdFia.js","assets/index.esm.DHYHwGJ4.js","assets/BeatLoader.GLQikMEo.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
