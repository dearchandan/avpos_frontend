import{_ as J}from"./AddSupplier.uYdH-vfC.js";import R from"./ServerMessage.EFQMOwoZ.js";import{r as g,b as T,d as Q,e as $,o as W,g as i,h as r,j as o,i as e,t as d,K as v,L as D,n as G,F as y,x as w,l as S,w as X,k as Y,m as f,N as A,p as Z}from"./index.sP6fhsqN.js";import"./index.esm.DHYHwGJ4.js";import{C as ee}from"./ClipLoader._89zL49D.js";import{F as te}from"./vee-validate.esm.2kXgdFia.js";import"./EditFormSkeleton.Ez20ofO9.js";import"./VTextInput.EPCajChY.js";import"./VTooltip.kcvohVRA.js";import"./VSelect.twStq9pE.js";/* empty css                                                                *//* empty css                                                   */const se={key:0,class:"card"},ae={class:"row align-items-center justify-content-between mb-2"},oe={class:"col-md-auto"},ne={class:"col-md-3"},ie={class:"d-flex flex-column align-items-end"},le=e("a",{href:"javascript:;","data-bs-toggle":"modal","data-bs-target":"#addSupplierModal",class:"label_add_btn"}," + Add",-1),re=["selected"],de=["value"],ue={class:"row"},ce={class:"col-12 py-3"},_e={class:"table-responsive"},pe={class:"table table-condensed"},me={width:"15%"},he=e("em",{class:"text-danger"},"*",-1),fe={key:0,width:"15%"},ge={width:"20%"},ve={width:"5%"},ye={width:"5%"},be={key:0},ke=["onUpdate:modelValue"],we={class:"input-group mb-1"},Se=["onUpdate:modelValue","input_group_text"],xe={class:"input-group-append"},Ve={class:"input-group-text h-100 form-control-solid"},Ce=["onUpdate:modelValue"],Me={key:0},$e=["value"],De={class:"text-center"},Ae=["onClick"],Ue=e("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[e("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),Ne=[Ue],Be={key:1},qe={colspan:"9"},Fe={key:0,class:"col-12 py-3"},Oe={class:"col-12 mt-2 text-end"},je=["disabled"],Ie={key:1,class:"pt-0"},ze={key:2,class:"pt-0"},Ee={class:"modal hide",id:"addSupplierModal",tabindex:"-1","aria-labelledby":"Add Customer","aria-modal":"true",role:"dialog","data-bs-backdrop":"static","data-bs-keyboard":"false"},Le={class:"modal-dialog modal-dialog-centered modal-xl"},Pe={class:"modal-content"},Ke={class:"modal-header"},He={class:"modal-title fs-5"},Je={class:"modal-body"},nt={__name:"AddIngredientSupplier",props:{ingredient:{type:Object},all_suppliers:{type:Object}},setup(U){const b=U,p=b.ingredient,x=b.all_suppliers,k=b.ingredient.product_suppliers,u=g(""),N=T(),V=Q(()=>N.user.currency.symbol),a=$({...{server_messages:{type:"",messages:""},is_submitting:!1}});W(()=>{B()});function B(){q(),F(),O()}const C=g([]);async function q(){let t=new FormData;t.append("ingredient_slack",p.slack),await axios.post("/api/v2/ingredient/measurements",t).then(s=>{C.value=s.data.data}).catch(s=>{a.server_messages.type="error",a.server_messages.messages=s})}const c=g([]);function F(){c.value=x.filter(function(t){return!k.find(function(s){return t.slack==s.supplier.slack})})}const h=g([]);function O(){_.forEach(k,t=>{let s={product_supplier_slack:t.slack,supplier_id:t.supplier.id,supplier_name:t.supplier.name,default_purchase_quantity:t.default_purchase_quantity,default_purchase_price:t.default_purchase_price,default_measurement_unit_id:t.default_measurement_unit_id};h.value.push(s)})}function j(){if(u.value!=""){let t=$({product_supplier_slack:"",supplier_id:u.value.id,supplier_name:u.value.name,default_purchase_quantity:"",default_purchase_price:p.sale_price,default_measurement_unit_id:p.stock_measurement_unit_id});h.value.push(t),c.value.splice(c.value.indexOf(u.value),1),u.value=""}}function I(t){h.value.splice(h.value.indexOf(t),1);let s=_.find(x,m=>m.id==t.supplier_id);c.value.push(s),c.value=_.sortBy(c.value,m=>m.name)}async function z(){a.is_submitting=!0;var t=new FormData;t.append("ingredient_slack",p.slack),t.append("suppliers",JSON.stringify(h.value)),await axios.post("/api/ingredient/supplier/update",t).then(s=>{if(a.is_submitting=!1,s.data.status_code==200)toast.success(s.data.msg),E();else{try{a.server_messages.type="error",a.server_messages.messages=JSON.parse(s.data.msg)}catch{a.server_messages.type="error",a.server_messages.messages=s.data.msg}a.is_submitting=!1}}).catch(s=>{a.server_messages.type="error",a.server_messages.messages=s,a.is_submitting=!1,console.log(s)})}function E(){u.value=""}async function L(){document.getElementById("close_btn").click(),P()}async function P(){await axios.get("/api/suppliers/all").then(t=>{c.value=t.data.data,c.value=c.value.filter(function(s){return!k.find(function(m){return s.slack==m.supplier.slack})})}).catch(t=>{a.server_messages.type="error",a.server_messages.messages=t})}return(t,s)=>{const m=R,K=J;return i(),r(y,null,[o(p)!=""?(i(),r("div",se,[e("div",ae,[e("div",oe,[e("h4",null,d(t.$t("Add Supplier")),1)]),e("div",ne,[e("div",ie,[le,v(e("select",{class:"form-control form-control-solid form-control-sm w-100","onUpdate:modelValue":s[0]||(s[0]=n=>G(u)?u.value=n:null),onChange:s[1]||(s[1]=n=>j())},[e("option",{value:"",selected:o(u)==""},"--"+d(t.$t("Select Supplier"))+"--",9,re),(i(!0),r(y,null,w(o(c),(n,M)=>(i(),r("option",{value:n},d(n.name),9,de))),256))],544),[[D,o(u)]])])])]),e("div",ue,[S(o(te),{onSubmit:z},{default:X(()=>[e("div",ce,[e("div",_e,[e("table",pe,[e("thead",null,[e("tr",null,[e("th",me,[Y(d(t.$t("Supplier"))+" ",1),he]),o(p).is_stockable?(i(),r("th",fe,d(t.$t("Default Purchase Qty")),1)):f("",!0),e("th",ge,d(t.$t("Default Purchase Price")),1),e("th",ve,d(t.$t("Default Measurement")),1),e("th",ye,d(t.$t("Remove")),1)])]),e("tbody",null,[o(h)!=""?(i(!0),r(y,{key:0},w(o(h),(n,M)=>(i(),r("tr",{key:M},[e("td",null,[e("strong",null,d(n.supplier_name),1)]),o(p).is_stockable?(i(),r("td",be,[v(e("input",{type:"number",name:"quantity","onUpdate:modelValue":l=>n.default_purchase_quantity=l,class:"form-control form-control-solid",onKeydown:s[2]||(s[2]=l=>l.key==="-"?l.preventDefault():null)},null,40,ke),[[A,n.default_purchase_quantity]])])):f("",!0),e("td",null,[e("div",we,[v(e("input",{type:"number",name:"sale_price",class:"form-control form-control-solid","onUpdate:modelValue":l=>n.default_purchase_price=l,input_group_text:o(V),onKeydown:s[3]||(s[3]=l=>l.key==="-"?l.preventDefault():null)},null,40,Se),[[A,n.default_purchase_price]]),e("div",xe,[e("span",Ve,d(o(V)),1)])])]),e("td",null,[v(e("select",{name:"stock_measurement_unit_id","onUpdate:modelValue":l=>n.default_measurement_unit_id=l,class:"form-control form-control-solid"},[n.stock_measurement_unit_id==""||o(p).stock_measurement_unit_id==null?(i(),r("option",Me,"Per Unit")):(i(!0),r(y,{key:1},w(o(C),(l,H)=>(i(),r("option",{key:H,value:l.id},d(l.unit_name),9,$e))),128))],8,Ce),[[D,n.default_measurement_unit_id]])]),e("td",De,[e("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:l=>I(n)},Ne,8,Ae)])]))),128)):(i(),r("tr",Be,[e("td",qe,d(t.$t("No Suppliers Linked")),1)]))])])])]),o(a).server_messages.messages!=""?(i(),r("div",Fe,[S(m,{server_messages:o(a).server_messages},null,8,["server_messages"])])):f("",!0),e("div",Oe,[e("button",{type:"submit",class:"btn btn-primary",disabled:o(a).is_submitting},[o(a).is_submitting?(i(),Z(ee,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):f("",!0),o(a).is_submitting?(i(),r("span",Ie,d(t.$t("Saving...")),1)):(i(),r("span",ze,d(t.$t("Save")),1))],8,je)])]),_:1})])])):f("",!0),e("div",Ee,[e("div",Le,[e("div",Pe,[e("div",Ke,[e("h5",He,d(t.$t("Add Supplier")),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[4]||(s[4]=(...n)=>t.closeModal&&t.closeModal(...n)),id:"close_btn"})]),e("div",Je,[S(K,{onCloseAddSupplierModal:L,popupWindow:!0})])])])])],64)}}};export{nt as default};
