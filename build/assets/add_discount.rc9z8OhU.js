import{z as K,g as d,h as m,i as t,u as G,a as W,e as V,r as D,o as X,v as $,d as S,p as b,w as y,f as M,l as o,k as p,t as u,j as c,m as w,F as U,x as N}from"./index.sP6fhsqN.js";import{_ as Z}from"./VTooltip.kcvohVRA.js";import{_ as tt}from"./VSelectInput.rvOuFTIX.js";import at from"./ServerMessage.EFQMOwoZ.js";import{D as et}from"./DefaultLayout.K5Bh9Jz_.js";import{a as k,F as st}from"./vee-validate.esm.2kXgdFia.js";import{c as it,a as lt,b as nt}from"./index.esm.DHYHwGJ4.js";import{_ as g}from"./VTextInput.EPCajChY.js";import{C as ot}from"./ClipLoader._89zL49D.js";import{j as dt}from"./vue-datepicker.S8gODTVm.js";/* empty css                                                   */const ut={},ct=t("form",{novalidate:"",enctype:"multipart/form-data",product:"[object Object]"},[t("div",{class:"row card-strash"},[t("div",{class:"col-md-12"},[t("div",{class:"row"},[t("div",{class:"col-md-12 mb-4"},[t("div",{class:"card"},[t("div",{class:"row mb-4"},[t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])])]),t("div",{class:"row"},[t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])]),t("div",{class:"col-3"},[t("div",{class:"form-field"},[t("div",{class:"skl-w",style:{height:"12px",width:"25%","flex-grow":"unset","margin-bottom":"4px"}}),t("div",{class:"skl-w",style:{height:"38px"}})])])])])])])])]),t("div",{class:"text-end"},[t("div",{class:"skl-w",style:{height:"38px",width:"90px","margin-left":"auto"}})])],-1),mt=[ct];function rt(A,l){return d(),m("div",null,mt)}const _t=K(ut,[["render",rt]]),pt={class:"header-nav-wrap"},vt={class:"row align-items-center"},ft={class:"col-auto"},yt={class:"header-back-link"},gt={class:"col-auto"},ht={key:0,class:"fw-bold"},bt={key:1,class:"fw-bold"},wt={key:0,class:"content"},kt={class:"row card-strash"},xt={key:0,class:"py-3"},qt={class:"col-md-12"},Vt={class:"row"},Dt={class:"col-md-12 mb-4"},$t={class:"card"},St={class:"row"},Mt={class:"col-6 col-md-4 col-lg-3"},Ut={class:"col-6 col-md-4 col-lg-3"},Nt={class:"col-12 col-md-4 col-lg-3"},At={class:"form-field"},Ct={for:"",class:"pb-2"},Yt=t("em",null,"*",-1),Ft=t("br",null,null,-1),jt={class:"col-12 col-md-4 col-lg-3"},It={class:"col-12 col-md-4 col-lg-3"},Ot={class:"form-field"},Bt={for:"",class:"pb-2"},Ht=t("br",null,null,-1),Lt={class:"col-6 col-md-4 col-lg-3"},Tt={key:0,class:"col-6 col-md-4 col-lg-3"},zt={class:"col-6 col-md-4 col-lg-3"},Et={class:"form-field"},Pt={for:"",class:"form-label"},Qt={class:"col-6 col-md-4 col-lg-3"},Rt={class:"form-field"},Jt={class:"form-check form-switch pt-md-4"},Kt={class:"text-end"},Gt=["disabled"],Wt={key:1,class:"pt-0"},Xt={key:2,class:"pt-0"},ra={__name:"add_discount",setup(A){const{t:l}=G(),n=W().params.slack,_=V({type:"",messages:""}),v=D({name:l("Discount Name"),name_ar:l("Discount Name (Arabic)"),discount_percentage:l("Discount Percentage"),discount_amount:l("Discount Amount"),minimum_order_amount:l("Minimum Order Amount"),maximum_discount_amount:l("Maximum Discount Amount"),discount_quantity:l("Discount Quantity")}),a=V({...{is_submitting:!1,name:"",name_ar:"",type:1,value:"",applies_to:1,minimum_order_amount:"",maximum_discount_amount:"",available_discount_quantity:"",date_range:"",is_taxable:1,status:!0,slack:"",is_unlimited_quantity:1}}),C=it({name:lt().required(l("name is required",{name:l("Discount Name")})).min(2,l("name must be at least n characters",{name:l("Name"),number:2})),value:nt().typeError(l("must be a number",{name:l("Value")})).required(l("name is required",{name:l("Value")})).min(1,l("must be greater than or equal to n",{name:l("Value"),number:1}))});X(()=>{n!=""&&n!=null&&T()}),$(()=>a.value,e=>{console.log(a.type,"type"),a.type==1&&a.value>100?a.value=100:a.value=e}),$(()=>a.type,e=>{a.type==1&&a.value>100&&(a.value=100)});const Y=[{name:"Percentage",value:1},{name:"Flat",value:2}],F=[{name:"Inventory",value:1},{name:"Order",value:2}],j=[{name:"Unlimited",id:1},{name:"Limited",id:0}],I=S(()=>a.date_range!=null&&a.date_range[0]!=null?moment(a.date_range[0]).format("YYYY-MM-DD HH:mm"):""),O=S(()=>a.date_range!=null&&a.date_range[1]!=null?moment(a.date_range[1]).format("YYYY-MM-DD HH:mm"):"");async function B(){n==""||n==null?a.is_unlimited_quantity==1?a.available_discount_quantity="":(a.available_discount_quantity==null||a.available_discount_quantity=="")&&(a.available_discount_quantity=0):(n!=""||n!=null)&&a.is_unlimited_quantity!=1&&(a.available_discount_quantity==""||a.available_discount_quantity==null)&&(a.available_discount_quantity=0)}async function H(e){a.is_submitting=!0;var s=new FormData;s.append("name",e.name),s.append("name_ar",e.name_ar),s.append("type",e.type),s.append("value",e.value),s.append("applies_to",e.applies_to),s.append("minimum_order_amount",e.minimum_order_amount!=null?e.minimum_order_amount:0),s.append("maximum_discount_amount",e.maximum_discount_amount!=null?e.maximum_discount_amount:0),a.is_unlimited_quantity==1?s.append("available_discount_quantity",""):s.append("available_discount_quantity",e.available_discount_quantity),s.append("is_unlimited_quantity",a.is_unlimited_quantity),s.append("start_datetime",I.value),s.append("end_datetime",O.value),s.append("is_taxable",e.is_taxable),s.append("status",e.status),s.append("slack",n);var h=n!=""&&n!=null?"/api/discount/update":"/api/discount/save";await axios.post(h,s).then(r=>{if(r.data.status_code==200)toast.success(r.data.msg),a.is_submitting=!1,router.push("/discounts"),L();else{try{_.type="error",_.messages=JSON.parse(r.data.msg)}catch{_.type="error",_.messages=r.data.msg}a.is_submitting=!1}}).catch(r=>{_.type="error",_.messages=r,a.is_submitting=!1,console.log(r)})}function L(){Object.assign(a,a)}const x=D(!1);async function T(){let e=await axios.get("/api/discount",{params:{slack:n}});a.name=e.data.data.discount.name,a.name_ar=e.data.data.discount.name_ar,a.type=e.data.data.discount.type,a.value=e.data.data.discount.value,a.applies_to=e.data.data.discount.applies_to,a.minimum_order_amount=e.data.data.discount.minimum_order_amount,a.maximum_discount_amount=e.data.data.discount.maximum_discount_amount,a.available_discount_quantity=e.data.data.discount.available_discount_quantity,a.date_range=e.data.data.discount.date_range,a.is_taxable=e.data.data.discount.is_taxable,a.status=e.data.data.discount.status==1,a.slack=e.data.data.discount.slack,a.is_unlimited_quantity=e.data.data.discount.available_discount_quantity!=null&&e.data.data.discount.available_discount_quantity.toString()!=""&&e.data.data.discount.available_discount_quantity.toString()!=null?0:1,a.date_range="",a.date_range=[new Date(String(e.data.data.discount.start_datetime)),new Date(String(e.data.data.discount.end_datetime))],x.value=!0}return(e,s)=>{const h=M("Icon"),r=M("router-link"),q=at,z=tt,E=Z,P=_t;return d(),b(et,null,{subheader:y(()=>[t("div",pt,[t("div",vt,[t("div",ft,[t("div",yt,[o(r,{class:"text-primary",to:"/discounts"},{default:y(()=>[o(h,{icon:"fa6-solid:chevron-left"}),p(" "+u(e.$t("Discounts")),1)]),_:1})])]),t("div",gt,[c(n)==""||c(n)==null?(d(),m("h5",ht,u(e.$t("Add Discount")),1)):(d(),m("h5",bt,u(e.$t("Edit Discount")),1))])])])]),default:y(()=>[c(n)==""||c(n)==null||c(n)!=""&&x.value?(d(),m("div",wt,[o(c(st),{"validation-schema":c(C),onSubmit:H,enctype:"multipart/form-data","initial-values":a},{default:y(({setFieldValue:Q,values:R})=>[t("div",kt,[_.messages!=""?(d(),m("div",xt,[o(q,{server_messages:_},null,8,["server_messages"])])):w("",!0),t("div",qt,[t("div",Vt,[t("div",Dt,[t("div",$t,[t("div",St,[t("div",Mt,[o(g,{type:"text",name:"name",label:v.value.name,required:!0,modelValue:a.name,"onUpdate:modelValue":s[0]||(s[0]=i=>a.name=i)},null,8,["label","modelValue"])]),t("div",Ut,[o(g,{type:"text",name:"name_ar",label:v.value.name_ar,modelValue:a.name_ar,"onUpdate:modelValue":s[1]||(s[1]=i=>a.name_ar=i)},null,8,["label","modelValue"])]),t("div",Nt,[t("div",At,[t("label",Ct,[p(u(e.$t("Discount Type")),1),Yt]),Ft,(d(),m(U,null,N(Y,(i,f)=>t("label",{class:"label me-3",key:f},[o(c(k),{class:"form-check-input me-1",name:"type",type:"radio",id:f,modelValue:a.type,"onUpdate:modelValue":s[2]||(s[2]=J=>a.type=J),value:i.value},null,8,["id","modelValue","value"]),p(" "+u(i.name),1)])),64))])]),t("div",jt,[o(g,{type:"text",name:"value",label:R.type==1?v.value.discount_percentage:v.value.discount_amount,required:!0,modelValue:a.value,"onUpdate:modelValue":s[3]||(s[3]=i=>a.value=i)},null,8,["label","modelValue"])]),t("div",It,[t("div",Ot,[t("label",Bt,u(e.$t("Applies To")),1),Ht,(d(),m(U,null,N(F,(i,f)=>t("label",{class:"label me-3",key:f},[o(c(k),{class:"form-check-input me-1",name:"applies_to",type:"radio",id:f,value:i.value},null,8,["id","value"]),p(" "+u(i.name),1)])),64))])]),t("div",Lt,[o(z,{name:"type",label:"Is Unlimited?",required:"",options:j,modelValue:a.is_unlimited_quantity,"onUpdate:modelValue":s[4]||(s[4]=i=>a.is_unlimited_quantity=i),size:"normal",onChange:B},null,8,["modelValue"])]),a.is_unlimited_quantity==0?(d(),m("div",Tt,[o(g,{type:"number",name:"available_discount_quantity",label:v.value.discount_quantity,modelValue:a.available_discount_quantity,"onUpdate:modelValue":s[5]||(s[5]=i=>a.available_discount_quantity=i)},null,8,["label","modelValue"])])):w("",!0),t("div",zt,[t("div",Et,[t("label",Pt,[p(u(e.$t("Date Range"))+" ",1),o(E,{message:"Keeping dates unselected will make it applicable always"})]),o(c(dt),{range:"",modelValue:a.date_range,"onUpdate:modelValue":s[6]||(s[6]=i=>a.date_range=i),format:"dd-MM-yyyy","enable-time-picker":!1,"input-class-name":"form-control form-control-solid"},null,8,["modelValue"])])]),t("div",Qt,[t("div",Rt,[t("div",Jt,[o(c(k),{class:"form-check-input me-2",type:"checkbox",role:"switch",name:"status",id:"status","unchecked-value":!1,value:!0,modelValue:a.status,"onUpdate:modelValue":s[7]||(s[7]=i=>a.status=i),onChange:i=>Q("status",i.target.checked)},null,8,["modelValue","onChange"]),p(" "+u(e.$t("Active")),1)])])])])])])])])]),t("div",Kt,[t("button",{type:"submit",class:"btn btn-primary",disabled:a.is_submitting},[a.is_submitting?(d(),b(ot,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):w("",!0),a.is_submitting?(d(),m("span",Wt,u(e.$t("Saving...")),1)):(d(),m("span",Xt,u(e.$t("Save")),1))],8,Gt)])]),_:1},8,["validation-schema","initial-values"])])):(d(),b(P,{key:1}))]),_:1})}}};export{ra as default};
