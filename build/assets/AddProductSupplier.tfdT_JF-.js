import{r as f,b as W,d as G,e as D,o as X,g as i,h as r,j as o,i as t,t as n,l as k,w as Y,k as Z,m as g,F as w,N as M,K as S,x as $,L as ee,p as N,q as te,_ as se}from"./index.sP6fhsqN.js";import{_ as ae}from"./AddSupplier.uYdH-vfC.js";import{_ as oe}from"./ListingSkeleton.0g9v9IYA.js";import"./index.esm.DHYHwGJ4.js";import{C as le}from"./ClipLoader._89zL49D.js";import{F as ie}from"./vee-validate.esm.2kXgdFia.js";import"./EditFormSkeleton.Ez20ofO9.js";import"./ServerMessage.EFQMOwoZ.js";import"./VTextInput.EPCajChY.js";import"./VTooltip.kcvohVRA.js";import"./VSelect.twStq9pE.js";/* empty css                                                                *//* empty css                                                   */const ne={key:0},re={class:""},de={class:"tab-content-head"},ue={class:"row align-items-center justify-content-between"},ce={class:"col-auto"},pe={class:"col-auto"},_e={class:"form-field mb-0 d-flex flex-column align-items-end"},me=t("a",{href:"javascript:;","data-bs-toggle":"modal","data-bs-target":"#addSupplierModal",class:"label_add_btn"}," + Add",-1),he={class:"col-12 py-3"},fe={key:0,class:"table-responsive"},ve={class:"table table-condensed"},ge={width:"15%"},ye=t("em",{class:"text-danger"},"*",-1),be={key:0,width:"15%"},ke={width:"20%"},we={width:"5%"},Se={width:"5%",class:"text-end"},xe={key:0},Ve=["onUpdate:modelValue"],Ae={class:"form-field mb-0 field-end-label"},Ce=["onUpdate:modelValue","input_group_text"],De=["onUpdate:modelValue"],Me={key:0,value:""},$e=["value"],Ne={class:"text-end"},Pe=["onClick"],Ue=t("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[t("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),qe=[Ue],Be={key:1},Oe={colspan:"9",class:"text-center"},Ee={class:"col-12 mt-2 text-end"},Fe=["disabled"],Le={key:1,class:"pt-0"},je={key:2,class:"pt-0"},ze={class:"modal hide",id:"addSupplierModal",tabindex:"-1","aria-labelledby":"Add Customer","aria-modal":"true",role:"dialog","data-bs-backdrop":"static","data-bs-keyboard":"false"},Ie={class:"modal-dialog modal-dialog-centered modal-xl"},Ke={class:"modal-content"},Te={class:"modal-header"},He={class:"modal-title fs-5"},Je={class:"modal-body"},nt={__name:"AddProductSupplier",props:{product:{type:Object}},setup(P){const U=te(()=>se(()=>import("./SupplierSearch.u7CCcU0e.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),x=P,v=f([]),c=x.product,y=f(""),b=x.product.product_suppliers,p=f(""),q=W(),V=G(()=>q.user.currency.symbol),a=D({...{server_messages:{type:"",messages:""},is_submitting:!1}});X(()=>{B()});function B(){O(),E(),L()}const A=f([]);async function O(){let e=new FormData;e.append("product_slack",c.slack),await axios.post("/api/v2/product/measurements",e).then(s=>{A.value=s.data.data}).catch(s=>{a.server_messages.type="error",a.server_messages.messages=s})}async function E(){await axios.get("/api/v2/suppliers/all").then(e=>{y.value=e.data.data,F()}).catch(e=>{a.server_messages.type="error",a.server_messages.messages=e})}const u=f([]);function F(){u.value=y.filter(function(e){return!b.find(function(s){return e.slack==s.supplier.slack})})}const h=f([]),C=f(!1);function L(){_.forEach(b,e=>{let s={product_supplier_slack:e.slack,supplier_id:e.supplier.id,supplier_name:e.supplier.name,default_purchase_quantity:e.default_purchase_quantity,default_purchase_price:e.default_purchase_price,default_measurement_unit_id:e.default_measurement_unit_id};h.value.push(s),v.value.push(e.supplier.id)}),C.value=!0}function j(e){if(p.value=e,p.value!=""){let s=D({product_supplier_slack:"",supplier_id:p.value.id,supplier_name:p.value.name,default_purchase_quantity:"",default_purchase_price:c.sale_price,default_measurement_unit_id:c.stock_measurement_unit_id});v.value.push(p.value.id),h.value.push(s),u.value.splice(u.value.indexOf(p.value),1),p.value=""}}function z(e){h.value.splice(h.value.indexOf(e),1);let s=_.find(y,m=>m.id==e.supplier_id);v.value.splice(v.value.indexOf(s.id),1),u.value.push(s),u.value=_.sortBy(u.value,m=>m.name)}async function I(){a.is_submitting=!0;var e=new FormData;e.append("product_slack",c.slack),e.append("suppliers",JSON.stringify(h.value)),await axios.post("/api/product/supplier/update",e).then(s=>{if(a.is_submitting=!1,s.data.status_code==200)toast.success(s.data.msg),K();else{try{a.server_messages.type="error",a.server_messages.messages=JSON.parse(s.data.msg)}catch{a.server_messages.type="error",a.server_messages.messages=s.data.msg}a.is_submitting=!1}}).catch(s=>{a.server_messages.type="error",a.server_messages.messages=s,a.is_submitting=!1,console.log(s)})}function K(){p.value=""}async function T(){document.getElementById("close_btn").click(),H()}async function H(){await axios.get("/api/v2/suppliers/all").then(e=>{u.value=e.data.data,u.value=u.value.filter(function(s){return!b.find(function(m){return s.slack==m.supplier.slack})})}).catch(e=>{a.server_messages.type="error",a.server_messages.messages=e})}return(e,s)=>{const m=oe,J=ae;return i(),r(w,null,[o(c)!=""?(i(),r("div",ne,[t("div",re,[t("div",de,[t("div",ue,[t("div",ce,[t("h3",null,n(e.$t("Add Supplier")),1)]),t("div",pe,[t("div",_e,[me,k(o(U),{onSelectSupplier:j,selected_suppliers:o(v)},null,8,["selected_suppliers"])])])])]),k(o(ie),{onSubmit:I},{default:Y(()=>[t("div",he,[o(C)?(i(),r("div",fe,[t("table",ve,[t("thead",null,[t("tr",null,[t("th",ge,[Z(n(e.$t("Supplier"))+" ",1),ye]),o(c).is_stockable?(i(),r("th",be,n(e.$t("Default Purchase Qty")),1)):g("",!0),t("th",ke,n(e.$t("Default Purchase Price")),1),t("th",we,n(e.$t("Default Measurement")),1),t("th",Se,n(e.$t("Remove")),1)])]),t("tbody",null,[o(h)!=""?(i(!0),r(w,{key:0},$(o(h),(d,R)=>(i(),r("tr",{key:R},[t("td",null,[t("strong",null,n(d.supplier_name),1)]),o(c).is_stockable?(i(),r("td",xe,[S(t("input",{type:"number",name:"quantity","onUpdate:modelValue":l=>d.default_purchase_quantity=l,class:"form-control form-control-sm form-control-solid",onKeydown:s[0]||(s[0]=l=>l.key==="-"?l.preventDefault():null)},null,40,Ve),[[M,d.default_purchase_quantity]])])):g("",!0),t("td",null,[t("div",Ae,[S(t("input",{type:"number",name:"sale_price",class:"form-control form-control-sm form-control-solid","onUpdate:modelValue":l=>d.default_purchase_price=l,input_group_text:o(V),onKeydown:s[1]||(s[1]=l=>l.key==="-"?l.preventDefault():null)},null,40,Ce),[[M,d.default_purchase_price]]),t("small",null,n(o(V)),1)])]),t("td",null,[S(t("select",{name:"stock_measurement_unit_id","onUpdate:modelValue":l=>d.default_measurement_unit_id=l,class:"form-control form-control-sm form-control-solid"},[d.stock_measurement_unit_id==""||o(c).stock_measurement_unit_id==null?(i(),r("option",Me,n(e.$t("Per Unit")),1)):(i(!0),r(w,{key:1},$(o(A),(l,Q)=>(i(),r("option",{key:Q,value:l.id},n(l.unit_name),9,$e))),128))],8,De),[[ee,d.default_measurement_unit_id]])]),t("td",Ne,[t("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:l=>z(d)},qe,8,Pe)])]))),128)):(i(),r("tr",Be,[t("td",Oe,n(e.$t("No Suppliers Linked")),1)]))])])])):(i(),N(m,{key:1}))]),t("div",Ee,[t("button",{type:"submit",class:"btn btn-primary",disabled:o(a).is_submitting},[o(a).is_submitting?(i(),N(le,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):g("",!0),o(a).is_submitting?(i(),r("span",Le,n(e.$t("Saving...")),1)):(i(),r("span",je,n(e.$t("Save")),1))],8,Fe)])]),_:1})])])):g("",!0),t("div",ze,[t("div",Ie,[t("div",Ke,[t("div",Te,[t("h5",He,n(e.$t("Add Supplier")),1),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:s[2]||(s[2]=(...d)=>e.closeModal&&e.closeModal(...d)),id:"close_btn"})]),t("div",Je,[k(J,{onCloseAddSupplierModal:T,popupWindow:!0})])])])])],64)}}};export{nt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/SupplierSearch.u7CCcU0e.js","assets/index.sP6fhsqN.js","assets/index.KTHCd6a8.css","assets/vee-validate.esm.2kXgdFia.js","assets/index.esm.DHYHwGJ4.js","assets/BeatLoader.GLQikMEo.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
