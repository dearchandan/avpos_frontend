import{D as S}from"./DefaultLayout.K5Bh9Jz_.js";import{_ as x}from"./ListingSkeleton.0g9v9IYA.js";import M from"./ServerMessage.EFQMOwoZ.js";import{u as N,b as T,r as p,e as L,o as z,g as n,p as w,w as f,f as k,i as e,l as g,k as b,t as o,h as l,m as I,F as V,x as W}from"./index.sP6fhsqN.js";import{B}from"./BeatLoader.GLQikMEo.js";import"./ClipLoader._89zL49D.js";/* empty css                                                   *//* empty css                                                   */const j={class:"header-nav-wrap"},A={class:"row align-items-center"},F={class:"col-auto"},Y={class:"header-back-link"},E={class:"col-auto"},J={class:"fw-bold"},O={class:"content"},q={class:"page-heading"},G={class:"row align-items-center justify-content-between"},H={key:0,class:"col-12 py-3"},K={class:"col-auto"},P={class:"text-center mb-2 mb-md-0"},Q={class:"col-auto"},R={class:"row g-2 g-md-3 justify-content-center"},U={class:"col-auto"},X={key:0,type:"button",class:"btn btn-sm btn-light-primary","data-bs-toggle":"modal",disabled:""},Z={class:"col-auto"},ee={key:0,type:"button",class:"btn btn-sm btn-primary",disabled:""},se={key:1,class:"table-responsive"},te={class:"table table-list-data table-hover"},ae={class:"bg-light"},oe={scope:"col"},ne={scope:"col"},ie={scope:"col",width:"10%"},le={scope:"col",class:"text-end",width:"10%"},re={class:"text-end"},ce={class:"dropdown"},de={class:"btn btn-icon btn-sm btn-light dropdown-toggle arrow-none",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},_e={class:"dropdown-menu"},me=["onClick"],ue=["href"],ge={key:1},pe={colspan:"5",class:"text-center"},he=e("div",{class:"data-footer"},null,-1),Se={__name:"backups",setup(ve){const{t:_}=N();T(),p(!1),p([]),p();const $={server_messages:{type:"",messages:""},is_listing:!1,is_downloading:!1,search_query:p("")},s=L({...$});z(()=>{v()});async function y(t){var i=!1,r=_("Do you want to backup the database to the server?");if(t=="on_local")var r=_("Do you want to backup the database to the local device?");s.server_messages.type="",s.server_messages.messages="",await Swal.fire({title:"Warning!",icon:"warning",text:r,showCancelButton:!0,confirmButtonText:_("Yes, Backup"),confirmButtonColor:"#198754",cancelButtonText:_("Cancel")}).then(a=>{a.isConfirmed&&(i=!0)}),i?(s.is_downloading=!0,await axios.post("/api/backup/save",{export_location:t}).then(a=>{if(console.log(a.data),a.data.status_code==200){s.is_downloading=!1;var m=a.data.data,u="";if(m.sql_dump_staus==0){if(u="Success",t=="on_local"){const c=document.createElement("a");c.target="_blank",c.href=m.download_url,document.body.appendChild(c),c.click(),console.log("link",c)}}else m.sql_dump_staus==1?(u="Warning",s.server_messages.type="error",s.server_messages.messages=u):m.sql_dump_staus==2&&(u="Wrong Command",s.server_messages.type="error",s.server_messages.messages=u);Swal.fire(a.data.msg),v()}else{s.is_downloading=!1;try{s.server_messages.type="error",s.server_messages.messages=JSON.parse(a.data.msg)}catch{s.server_messages.type="error",s.server_messages.messages=a.data.msg}}}).catch(a=>{s.is_downloading=!1,s.server_messages.type="error",s.server_messages.messages=a,console.log(a)})):s.is_downloading=!1}const h=p([]);async function v(){s.is_listing=!0,await axios.get("/api/backups").then(t=>{h.value=t.data.data,s.is_listing=!1}).catch(t=>{s.server_messages.type="error",s.server_messages.messages=t,s.is_listing=!1,console.log(t)})}async function C(t,i){var r=!1;await Swal.fire({title:"Warning!",icon:"warning",text:_("Do you want to delete this Backup with the file name :")+" "+i+" ?",showCancelButton:!0,confirmButtonText:_("Yes, Delete"),confirmButtonColor:"#d33",cancelButtonText:_("Cancel")}).then(a=>{a.isConfirmed&&(r=!0)}),r&&await axios.post("/api/backup/delete",{backup_id:t}).then(a=>{if(a.data.status_code==200)Swal.fire(a.data.msg),v();else try{s.server_messages.type="error",s.server_messages.messages=JSON.parse(a.data.msg)}catch{s.server_messages.type="error",s.server_messages.messages=a.data.msg}}).catch(a=>{s.server_messages.type="error",s.server_messages.messages=a,console.log(a)})}return(t,i)=>{const r=k("Icon"),a=k("router-link"),m=M,u=x,c=S;return n(),w(c,null,{subheader:f(()=>[e("div",j,[e("div",A,[e("div",F,[e("div",Y,[g(a,{class:"text-primary",to:"/settings"},{default:f(()=>[g(r,{icon:"fa6-solid:chevron-left"}),b(" "+o(t.$t("Settings")),1)]),_:1})])]),e("div",E,[e("h5",J,o(t.$t("Backups")),1)])])])]),default:f(()=>[e("div",O,[e("div",q,[e("div",G,[s.server_messages.messages!=""?(n(),l("div",H,[g(m,{server_messages:s.server_messages},null,8,["server_messages"])])):I("",!0),e("div",K,[e("p",P,o(t.$t("You can keep a maximum of 5 database backups")),1)]),e("div",Q,[e("div",R,[e("div",U,[s.is_downloading?(n(),l("button",X,[b(o(t.$t("Take Backup on Server"))+" ",1),g(B,{color:"gray",size:"15px",class:"pt-2 pe-2"})])):(n(),l("button",{key:1,type:"button",class:"btn btn-sm btn-light-primary","data-bs-toggle":"modal",onClick:i[0]||(i[0]=d=>y("on_server")),"data-bs-target":"#addBackupModal"},o(t.$t("Take Backup on Server")),1))]),e("div",Z,[s.is_downloading?(n(),l("button",ee,[b(o(t.$t("Download on My Device"))+" ",1),g(B,{color:"gray",size:"15px",class:"pt-2 pe-2"})])):(n(),l("button",{key:1,type:"button",class:"btn btn-sm btn-primary",onClick:i[1]||(i[1]=d=>y("on_local"))},o(t.$t("Download on My Device")),1))])])])])]),s.is_listing?(n(),w(u,{key:0})):(n(),l("div",se,[e("table",te,[e("thead",ae,[e("tr",null,[e("th",oe,o(t.$t("Date & Time")),1),e("th",ne,o(t.$t("Backup Name")),1),e("th",ie,o(t.$t("Size In MB")),1),e("th",le,o(t.$t("Action")),1)])]),e("tbody",null,[h.value!=""?(n(!0),l(V,{key:0},W(h.value,(d,D)=>(n(),l("tr",{key:D},[e("td",null,o(d.created_at_label),1),e("td",null,o(d.file_name),1),e("td",null,o(d.file_size)+" "+o(t.$t("MB")),1),e("td",re,[e("div",ce,[e("button",de,[g(r,{icon:"fa6-solid:ellipsis-vertical"})]),e("ul",_e,[e("li",null,[e("a",{class:"dropdown-item",href:"javascript:void(0)",onClick:fe=>C(d.id,d.file_name)},o(t.$t("Delete")),9,me)]),e("li",null,[e("a",{class:"dropdown-item",href:d.download_url,download:""},o(t.$t("Download")),9,ue)])])])])]))),128)):(n(),l("tr",ge,[e("td",pe,[e("b",null,o(t.$t("No Data Found")),1)])]))])])])),he])]),_:1})}}};export{Se as default};
