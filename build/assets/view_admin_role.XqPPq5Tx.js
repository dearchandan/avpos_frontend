import{_ as J}from"./RoleSkeleton._LL4x3W0.js";import K from"./ServerMessage.I5ol-gtz.js";import{b as P,a as Q,r as w,e as q,g as l,p as x,w as C,f as F,i as s,k as S,n as O,t as o,h as r,l as m,F as $,x as A,K as B,Q as M,j as G}from"./index.7OFNPsHl.js";import{_ as H}from"./DefaultLayout.nvkZ4UhM.js";import{F as W}from"./vee-validate.esm.N3uz7Rsk.js";import"./index.esm.cd1bITNA.js";/* empty css                                                   */import{C as X}from"./ClipLoader.1qNfpKDH.js";/* empty css                                                   */const Y={class:"header-nav-wrap"},Z={class:"row align-items-center"},ee={class:"col-auto"},se={class:"header-back-link"},te={class:"col-auto"},ne={class:"fw-bold"},ae={key:0,class:"content"},le={class:"page-heading"},re={key:0,class:"py-3"},ie={class:"row"},ce={key:0,class:"col-lg-3 col-md-3"},oe={class:"card","data-select2-id":"select2-data-14-jv1y"},ue={class:"row"},_e={class:"col-12 pb-3"},de={key:0,class:"badge badge-success"},ve={key:1,class:"badge badge-danger"},he={class:"col-md-12 clearfix"},me={class:"data-view-box mb-3"},ge={class:"item"},fe={class:"item"},ke={key:0,class:"col-md-12 clearfix"},be={class:"data-view-box mb-3"},pe={key:0,class:"item"},we={key:1,class:"item"},Ce={class:"col-lg-9 col-md-9"},Se={class:"row"},ye={class:"form-check mt-2 mb-2"},Ne={class:"form-check-label mb-0"},Ue=["value","id","onClick"],xe={class:"text-primary text-uppercase"},$e={class:"table-responsive"},Ae={class:"table"},Be={class:"td-head-data pt-0 pb-0 mb-0",width:"40%"},Me={class:"form-check mb-0"},Ie={class:"form-check-label mb-0"},Ve=["value","id","onClick"],Ee={class:"fw-bold text-dark"},Fe={width:"60%",class:""},Oe={key:0,class:"userrole_sub_table"},Re={class:"row g-3"},je={class:"form-check mb-0"},De={class:"form-check-label mb-0"},Te=["value","id","onClick"],Le={key:0,class:"col-6 col-md-4"},ze={class:"text-end"},Je=["disabled"],Ke={key:1,class:"pt-0"},Pe={key:2,class:"pt-0"},as={__name:"view_admin_role",setup(Qe){const R=P(),I=Q().params.slack,y=w(!1),u=w([]),f=w([]),t=w([]),i=q({...{server_messages:{type:"",messages:""}}});j();async function j(){await axios.get("/api/admin/role",{params:{slack:I}}).then(e=>{u.value=e.data.data.role,f.value=e.data.data.access_menus,t.value=e.data.data.role.role_menus,y.value=!0}).catch(e=>{i.server_messages.type="error",i.server_messages.messages=e,y.value=!0,console.log(e)})}function h(e,a){return e.filter(function(n){return n!=a})}function N(e){if(e.event.target.checked==!0)e.type=="ACTIONS"&&(t.value.push(e.current),t.value.push(e.parent),t.value.push(e.grand_parent)),e.type=="SUB_MENU"&&(t.value.push(e.current),t.value.push(e.parent),t.value=t.value.concat(e.children)),e.type=="MAIN_MENU"&&(t.value.push(e.current),t.value=t.value.concat(e.children));else{if(e.type=="ACTIONS"){t.value=h(t.value,e.current);var a=0;if(!_.isUndefined(e.siblings))for(var n=0;n<e.siblings.length;n++)t.value.includes(e.siblings[n])&&a++;a==0&&(t.value=h(t.value,e==null?void 0:e.parent));var k="_"+e.grand_parent;if(typeof f.value[k]<"u"){for(var b=0,p=f.value[k].childs,n=0;n<p.length;n++)t.value.includes(p[n])&&b++;b==0&&(t.value=h(t.value,e==null?void 0:e.grand_parent))}}if(e.type=="SUB_MENU"){t.value=h(t.value,e==null?void 0:e.current);for(var n=0;n<e.children.length;n++)t.value=h(t.value,e.children[n]);var a=0;if(!_.isUndefined(e.siblings))for(var n=0;n<e.siblings.length;n++)t.value.includes(e.siblings[n])&&a++;a==0&&(t.value=h(t.value,e==null?void 0:e.parent))}if(e.type=="MAIN_MENU"){t.value=h(t.value,e==null?void 0:e.current);for(var n=0;n<e.children.length;n++)t.value=h(t.value,e==null?void 0:e.children[n])}}}async function D(){i.is_submitting=!0;var e=new FormData;e.append("role_slack",I),e.append("role_menus",t.value),await axios.post("/api/admin/role/update_permission",e).then(a=>{if(a.data.status_code==200)toast.success(a.data.msg),i.is_submitting=!1,R.refresh(),router.push("/admin/roles");else{try{i.server_messages.type="error",i.server_messages.messages=JSON.parse(a.data.msg)}catch{i.server_messages.type="error",i.server_messages.messages=a.data.msg}i.is_submitting=!1}}).catch(a=>{i.server_messages.type="error",i.server_messages.messages=a,i.is_submitting=!1,console.log(a)})}return(e,a)=>{const n=F("Icon"),k=F("router-link"),b=K,p=J;return l(),x(H,null,{subheader:C(()=>{var g;return[s("div",Y,[s("div",Z,[s("div",ee,[s("div",se,[S(k,{class:"text-primary",to:"/admin/roles"},{default:C(()=>[S(n,{icon:"fa6-solid:chevron-left"}),O(" "+o(e.$t("Roles")),1)]),_:1})])]),s("div",te,[s("h5",ne,o((g=u.value)==null?void 0:g.name),1)])])])]}),default:C(()=>[y.value?(l(),r("div",ae,[s("div",le,[i.server_messages.messages!=""?(l(),r("div",re,[S(b,{server_messages:i.server_messages},null,8,["server_messages"])])):m("",!0)]),S(G(W),{onSubmit:D},{default:C(()=>{var g,V,E;return[s("div",ie,[((g=u.value)==null?void 0:g.name)!=null?(l(),r("div",ce,[s("div",oe,[s("div",ue,[s("div",_e,[u.value.status==1?(l(),r("span",de,o(e.$t("Active")),1)):(l(),r("span",ve,o(e.$t("Inactive")),1))]),s("div",he,[s("div",me,[s("div",ge,[s("span",null,o(e.$t("Created At")),1),s("strong",null,o(u.value.created_at_label),1)]),s("div",fe,[s("span",null,o(e.$t("Updated At")),1),s("strong",null,o(u.value.updated_at_label),1)])])]),u.value.created_by!=null||u.value.updated_by!=null?(l(),r("div",ke,[s("div",be,[u.value.created_by?(l(),r("div",pe,[s("span",null,o(e.$t("Created By")),1),s("strong",null,o((V=u.value.created_by)==null?void 0:V.name),1)])):m("",!0),u.value.updated_by?(l(),r("div",we,[s("span",null,o(e.$t("Updated By")),1),s("strong",null,o((E=u.value.updated_by)==null?void 0:E.name),1)])):m("",!0)])])):m("",!0)])])])):m("",!0),s("div",Ce,[s("div",Se,[(l(!0),r($,null,A(f.value,(d,T)=>(l(),r("div",{key:T,class:"card"},[s("div",ye,[s("label",Ne,[B(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=c=>t.value=c),value:d.menu_key,id:d.menu_key,onClick:c=>N({type:d.type,current:d.menu_key,parent:"",grand_parent:"",children:d.childs,siblings:d.siblings,event:c})},null,8,Ue),[[M,t.value]]),s("h5",xe,o(d==null?void 0:d.name),1)])]),s("div",$e,[s("table",Ae,[s("tbody",null,[(l(!0),r($,null,A(d.sub_menu,(c,L)=>(l(),r("tr",{key:L},[s("td",Be,[s("div",Me,[s("label",Ie,[B(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=v=>t.value=v),value:c.menu_key,id:c.menu_key,onClick:v=>N({type:c.type,current:c.menu_key,parent:d.menu_key,grand_parent:"",children:c.childs,siblings:c.siblings,event:v})},null,8,Ve),[[M,t.value]]),s("span",Ee,o(c==null?void 0:c.name),1)])])]),s("td",Fe,[c.actions?(l(),r("div",Oe,[s("div",Re,[(l(!0),r($,null,A(c.actions,(v,z)=>(l(),r("div",{class:"col-6 col-md-4",key:z},[s("div",je,[s("label",De,[B(s("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":a[2]||(a[2]=U=>t.value=U),value:v.menu_key,id:v.menu_key,onClick:U=>N({type:v.type,current:v.menu_key,parent:c.menu_key,grand_parent:d.menu_key,children:"",siblings:v.siblings,event:U})},null,8,Te),[[M,t.value]]),O(" "+o(v==null?void 0:v.name),1)])])]))),128)),Object(c.actions).length==2?(l(),r("div",Le)):m("",!0)])])):m("",!0)])]))),128))])])])]))),128))])])]),s("div",ze,[s("button",{type:"submit",class:"btn btn-primary",disabled:i.is_submitting},[i.is_submitting?(l(),x(X,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):m("",!0),i.is_submitting?(l(),r("span",Ke,o(e.$t("Saving...")),1)):(l(),r("span",Pe,o(e.$t("Save")),1))],8,Je)])]}),_:1})])):(l(),x(p,{key:1}))]),_:1})}}};export{as as default};
