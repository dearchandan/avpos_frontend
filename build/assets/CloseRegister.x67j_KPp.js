import{_ as E}from"./VTextInput.pcaNaUkX.js";import{F as j}from"./vee-validate.esm.reM-LHjC.js";import{c as z,b as A}from"./index.esm.e6McCFlz.js";import{u as G,b as L,bS as U,d as h,r as w,v as K,g,p as P,i as a,t as l,h as p,m as b,l as x,w as Q,j as d,n as W,ae as X,I as Z}from"./index.li3fCRRM.js";import"./VTooltip.pHzwBjkF.js";const D={class:"modal hide cashier-layout-modal",id:"closeRegisterModal",tabindex:"-1","aria-hidden":"true","data-bs-backdrop":"static","data-bs-keyboard":"false"},ee={class:"modal-dialog modal-dialog-centered"},se={class:"modal-content"},te={class:"modal-header modal-title"},ae={class:"mb-0"},ne={key:0,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},re={class:"modal-body"},ie={key:0,class:"text-center my-2"},oe={class:"text-danger"},le={key:1,class:"col text-center"},de={key:2,class:"text-center my-4"},ce={class:"text-black fw-bold"},me={class:"form-feild py-3"},ge={for:"",class:""},_e={class:"pt-2"},ue={class:"modal-btns"},he={type:"submit",class:"btn btn-lg btn-primary"},Ie={__name:"CloseRegister",props:["terminal_closing_time","force_closing","cash_in_hand_remain","is_shift_available"],emits:["openTerminal","closeRegister"],setup(c,{emit:M}){const R=c,{t:i}=G(),o=L(),y=U(),{getRoundedValue:k}=Z(),F=h(()=>o.user.currency.symbol),m=w(0),T=i("Cash In Hand"),N=z({cash_in_hand:A().typeError(i("must be a number",{name:i("Cash In Hand")})).required(i("name is required",{name:i("Cash In Hand")})).min(0,i("must be greater than or equal to 0",{name:i("Cash In Hand")}))}),I=M,V=h(()=>o.loggedInTerminal),O=h(()=>o.loggedInTerminal?o.loggedInTerminal.active_business_register.slack:""),S=h(()=>y.system_closing_cash);K(()=>R.cash_in_hand_remain,t=>{m.value=k(t)});async function J(){var t=new FormData;t.append("cash_in_system",S.value),t.append("cash_in_hand",m.value),t.append("terminal_id",V.value),t.append("business_register_slack",O.value),await axios.post("/api/business_register/close",t).then(e=>{if(e.data.status_code==200)$("#closeRegisterModal").modal("hide"),toast.success(e.data.msg),o.refresh(),y.refreshTerminals(),I("closeRegister"),router.push("/orders");else{try{server_messages.type="error",server_messages.messages=JSON.parse(e.data.msg)}catch{server_messages.type="error",server_messages.messages=e.data.msg}form.is_processing=!1}}).catch(e=>{server_messages.type="error",server_messages.messages=e,form.is_processing=!1,console.log(e)})}async function H(t){var e=new FormData;e.append("duration",t),e.append("terminal_id",o.user.logged_in_terminal.id),await axios.post("/api/business_register/add/log",e).then(n=>{if(n.data.status_code==200)$("#closeRegisterModal").modal("hide"),I("closeRegister");else{try{server_messages.type="error",server_messages.messages=JSON.parse(n.data.msg)}catch{server_messages.type="error",server_messages.messages=n.data.msg}form.is_processing=!1}}).catch(n=>{server_messages.type="error",server_messages.messages=n,form.is_processing=!1,console.log(n)})}function _(t){if(o.user.logged_in_terminal!=null&&localStorage.getItem("timings")){var e=JSON.parse(localStorage.getItem("timings"));let u=new Date().getDay(),v="";if(e.find(r=>r.weekday===u)&&e[e.findIndex(r=>r.weekday===u)].is_allday_running==!1&&(v=e[e.findIndex(r=>r.weekday===u)]),v!=""){var n=JSON.parse(v.shifts),s=new Date,f=n[n.findIndex(r=>s<=new Date(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+r.closing_time+":00")&&s>=new Date(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+r.opening_time+":00"))];if(f!=null){var Y=new Date(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+f.closing_time+":00"),C=new Date(Y.getTime()+t*6e4),q=C.getHours()+":"+C.getMinutes();n[n.findIndex(r=>s<=new Date(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+r.closing_time+":00")&&s>=new Date(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+r.opening_time+":00"))]={opening_time:f.opening_time,closing_time:q};var B=JSON.stringify(n);e[u-1].shifts=B,localStorage.setItem("timings",JSON.stringify(e)),H(t)}}}}return(t,e)=>{const n=E;return g(),P(X,{to:"body"},[a("div",D,[a("div",ee,[a("div",se,[a("div",te,[a("h2",ae,l(t.$t("Closing Register")),1),c.is_shift_available?(g(),p("button",ne)):b("",!0)]),a("div",re,[c.force_closing?(g(),p("div",ie,[a("span",oe,l(t.$t("Sorry! The shift time has expired, either increase the shift time or close the register")),1)])):b("",!0),c.force_closing?(g(),p("div",le,[a("span",{class:"btn btn-success btn-sm me-2",style:{cursor:"pointer"},onClick:e[0]||(e[0]=s=>_(15))},"+15 Mins"),a("span",{class:"btn btn-success btn-sm me-2",style:{cursor:"pointer"},onClick:e[1]||(e[1]=s=>_(30))},"+30 Mins"),a("span",{class:"btn btn-success btn-sm me-2",style:{cursor:"pointer"},onClick:e[2]||(e[2]=s=>_(45))},"+45 Mins"),a("span",{class:"btn btn-success btn-sm me-2",style:{cursor:"pointer"},onClick:e[3]||(e[3]=s=>_(60))},"+60 Mins")])):b("",!0),c.force_closing?(g(),p("div",de,[a("h5",ce,l(t.$t("OR")),1)])):b("",!0),x(d(j),{"validation-schema":d(N),onSubmit:e[5]||(e[5]=s=>J())},{default:Q(()=>[a("div",me,[a("label",ge,l(t.$t("Cash In System")),1),a("h6",_e,l(d(k)(d(S)))+" "+l(d(F)),1)]),x(n,{type:"text",name:"cash_in_hand",modelValue:d(m),"onUpdate:modelValue":e[4]||(e[4]=s=>W(m)?m.value=s:null),label:d(T),placeholder:"",size:"large",required:""},null,8,["modelValue","label"]),a("div",ue,[a("button",he,l(t.$t("Close Register")),1)])]),_:1},8,["validation-schema"])])])])])])}}};export{Ie as default};
