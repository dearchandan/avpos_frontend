import{u as G,b as W,d as x,r as f,P as X,e as C,o as Y,j as a,g as c,h as u,i as t,t as i,k as b,w as Z,n as ee,F as q,y as te,x as P,L as se,K as ne,p as ie,l as E,q as ae,_ as re}from"./index.ri7Y_V5F.js";import{_ as oe}from"./VTextInput.o2P1IcEE.js";import{c as N,h as de,d as le}from"./index.esm.wERziE-M.js";import{C as _e}from"./ClipLoader.4-rIzqtH.js";import{u as ce,a as ue,F as me}from"./vee-validate.esm.0La7AMjT.js";import"./VTooltip.a7qKl6DY.js";/* empty css                                                   */const pe={key:0,class:""},ge={class:""},he={class:"tab-content-head"},ve={class:"row align-items-center justify-content-between"},fe={class:"col-auto"},ye={class:"col-auto"},be={class:"form-field mb-0"},ke={class:"col-12 py-3"},we={class:"table table-condensed"},Ve={width:"15%"},$e={width:"15%"},Ie={width:"20%"},Se=t("em",{class:"text-danger"},"*",-1),Fe={width:"20%"},xe={width:"15%",class:"text-end"},Ce={width:"5%",class:"text-end"},qe=["onUpdate:modelValue","onChange"],Pe={key:0,value:""},Ee=["value"],Ne={class:"text-end"},Oe={class:"text-end"},Ae=["onClick"],De=t("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[t("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),Ue=[De],ze={key:1},Be={colspan:"9",class:"text-center"},Le={colspan:"4",class:"text-end"},Me={class:"text-end fw-bold"},je=t("td",null,null,-1),Re={class:"row justify-content-end"},Te={class:"col-auto"},Qe={class:"form-field pt-3"},He={class:"form-check form-switch"},Je={class:"form-check-label",for:"is_ingredients_total_price"},Ke={class:"col-auto"},Ge=["disabled"],We={key:1,class:"pt-0"},Xe={key:2,class:"pt-0"},rt={__name:"AddProductIngredient",props:{product:{type:Object}},setup(O){ce();const A=ae(()=>re(()=>import("./IngredientSearch.vlTksYs0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),{t:y}=G(),D=O,U=W(),k=x(()=>U.user.currency.symbol),h=f([]),p=X(D,"product"),w=f(""),I=p.value.ingredients,d=f("");localStorage.getItem("language");const s=C({...{server_messages:{type:"",messages:""},is_submitting:!1,is_ingredients_total_price:!1,ingredient_list:[]}}),z=N().shape({ingredient_list:de(N({quantity:le().typeError(y("must be a number",{name:y("Quantity")})).nullable().when({is:p.value.is_stockable,then:e=>e.required(y("name is required",{name:y("Quantity")})),otherwise:e=>e.nullable()})}))});Y(()=>{L(),M(),R()});const B=f([]);async function L(){let e=new FormData;e.append("product_slack",p.value.slack),await axios.post("/api/product/measurements",e).then(n=>{B.value=n.data.data}).catch(n=>{s.server_messages.type="error",s.server_messages.messages=n})}async function M(){await axios.get("/api/v2/ingredients/all").then(e=>{w.value=e.data.data,j()}).catch(e=>{s.server_messages.type="error",s.server_messages.messages=e})}const g=f([]);function j(){g.value=w.filter(function(e){return!I.find(function(n){return e.slack==n.ingredient.slack})})}const S=x(()=>{let e=[];return Object.entries(s.ingredient_list).forEach(([n,o])=>{e.push(o.product_ingredient_price)}),e.reduce(function(n,o){return parseFloat(n)+parseFloat(o)},0)});function R(){_.forEach(I,(e,n)=>{let o={product_ingredient_slack:e.slack,ingredient_price:e.ingredient.this_branch_inventory.sale_price,ingredient_id:e.ingredient.id,ingredient_name:e.ingredient.name,quantity:e.quantity,ingredient_measurement_unit_id:e.ingredient.stock_measurement_unit_id,ingredient_measurement_unit:e.ingredient.stock_measurement_unit,product_ingredient_measurement_unit_id:e.measurement_unit_id,measurement_groups:e.measurement_groups,product_ingredient_price:e.price};h.value.push(e.ingredient.id),s.ingredient_list.push(o)}),s.is_ingredients_total_price=p.value.this_branch_inventory.is_ingredients_total_price==1}function T(e){if(d.value=e,d.value!=""){let n=C({product_ingredient_slack:"",ingredient_price:d.value.sale_price,ingredient_id:d.value.id,ingredient_name:d.value.name,quantity:"",product_ingredient_price:0,ingredient_measurement_unit_id:d.value.stock_measurement_unit_id,ingredient_measurement_unit:d.value.stock_measurement_unit,product_ingredient_measurement_unit_id:d.value.stock_measurement_unit_id,measurement_groups:d.value.measurement_groups});s.ingredient_list.push(n),h.value.push(d.value.id),g.value.splice(g.value.indexOf(d.value),1),d.value=""}}function Q(e){s.ingredient_list.splice(s.ingredient_list.indexOf(e),1);let n=_.find(w.value,o=>o.id==e.ingredient_id);h.value.splice(h.value.indexOf(n.id),1),g.value.push(n),g.value=_.sortBy(g.value,o=>o.name)}async function H(){s.is_submitting=!0;var e=new FormData;e.append("product_slack",p.value.slack),e.append("ingredients",JSON.stringify(s.ingredient_list)),e.append("total_ingredient_amount",S.value),e.append("is_ingredients_total_price",s.is_ingredients_total_price==!0?1:0),await axios.post("/api/product/ingredient/update",e).then(n=>{if(s.is_submitting=!1,n.data.status_code==200)toast.success(n.data.msg),J();else{try{s.server_messages.type="error",s.server_messages.messages=JSON.parse(n.data.msg)}catch{s.server_messages.type="error",s.server_messages.messages=n.data.msg}s.is_submitting=!1}}).catch(n=>{s.server_messages.type="error",s.server_messages.messages=n,s.is_submitting=!1,console.log(n)})}function J(){d.value=""}function F(e,n){var o=e.ingredient_measurement_unit_id,r=e.product_ingredient_measurement_unit_id,m=e.ingredient_price,l=e.quantity,v="";_.forEach(e.measurement_groups,K=>{_.forEach(K.conversions,$=>{$.from_measurement_unit_id==o&&$.to_measurement_unit_id==r&&(v=$.conversion_value)})});var V=0;v==""?V=parseFloat(m)*parseFloat(l):V=parseFloat(m)*(parseFloat(l)/parseFloat(v)),s.ingredient_list[n].product_ingredient_price=Math.round((V+Number.EPSILON)*100)/100}return(e,n)=>{const o=oe;return a(p)!=""?(c(),u("div",pe,[t("div",ge,[t("div",he,[t("div",ve,[t("div",fe,[t("h3",null,i(e.$t("Add Ingredient")),1)]),t("div",ye,[t("div",be,[b(a(A),{onSelectProduct:T,selected_ingredients:a(h)},null,8,["selected_ingredients"])])])])]),b(a(me),{onSubmit:H,"validation-schema":a(z),"initial-values":a(s)},{default:Z(()=>[t("div",ke,[t("table",we,[t("thead",null,[t("tr",null,[t("th",Ve,i(e.$t("Ingredient")),1),t("th",$e,i(e.$t("Rate")),1),t("th",Ie,[ee(i(e.$t("Quantity"))+" ",1),Se]),t("th",Fe,i(e.$t("Measurement")),1),t("th",xe,i(e.$t("Amount")),1),t("th",Ce,i(e.$t("Remove")),1)])]),t("tbody",null,[a(s).ingredient_list!=""?(c(!0),u(q,{key:0},P(a(s).ingredient_list,(r,m)=>(c(),u("tr",{key:m},[t("td",null,[t("strong",null,i(r.ingredient_name),1)]),t("td",null,[t("span",null,i(r.ingredient_price)+" "+i(a(k)),1)]),t("td",null,[b(o,{type:"number",name:"ingredient_list["+m+"].quantity",modelValue:r.quantity,"onUpdate:modelValue":l=>r.quantity=l,onInput:l=>F(r,m),step:"1",size:"small",class:te("mt-3"),islabel:!1},null,8,["name","modelValue","onUpdate:modelValue","onInput"])]),t("td",null,[ne(t("select",{name:"stock_measurement_unit_id","onUpdate:modelValue":l=>r.product_ingredient_measurement_unit_id=l,class:"form-control form-control-sm form-control-solid",onChange:l=>F(r,m)},[r.product_ingredient_measurement_unit_id==""||r.product_ingredient_measurement_unit_id==null?(c(),u("option",Pe,i(e.$t("Per Unit")),1)):(c(!0),u(q,{key:1},P(r.measurement_groups,(l,v)=>(c(),u("option",{key:v,value:l.id},i(l.unit_name+" "+l.unit_name_ar),9,Ee))),128))],40,qe),[[se,r.product_ingredient_measurement_unit_id]])]),t("td",Ne,[t("span",null,i(r.product_ingredient_price)+" "+i(a(k)),1)]),t("td",Oe,[t("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:l=>Q(r)},Ue,8,Ae)])]))),128)):(c(),u("tr",ze,[t("td",Be,i(e.$t("No Ingredients Linked")),1)]))]),t("tfoot",null,[t("tr",null,[t("td",Le,i(e.$t("Total")),1),t("td",Me,i(a(S))+" "+i(a(k)),1),je])])])]),t("div",Re,[t("div",Te,[t("div",Qe,[t("div",He,[b(a(ue),{class:"form-check-input me-2",type:"checkbox",role:"switch",name:"is_ingredients_total_price",id:"is_ingredients_total_price","unchecked-value":!1,value:!0,modelValue:a(s).is_ingredients_total_price,"onUpdate:modelValue":n[0]||(n[0]=r=>a(s).is_ingredients_total_price=r)},null,8,["modelValue"]),t("label",Je,i(e.$t("Set Product Price as Ingredient Cost?")),1)])])]),t("div",Ke,[t("button",{type:"submit",class:"btn btn-primary",disabled:a(s).is_submitting},[a(s).is_submitting?(c(),ie(_e,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):E("",!0),a(s).is_submitting?(c(),u("span",We,i(e.$t("Saving...")),1)):(c(),u("span",Xe,i(e.$t("Save")),1))],8,Ge)])])]),_:1},8,["validation-schema","initial-values"])])])):E("",!0)}}};export{rt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/IngredientSearch.vlTksYs0.js","assets/index.ri7Y_V5F.js","assets/index.1t-AB2n6.css","assets/vee-validate.esm.0La7AMjT.js","assets/index.esm.wERziE-M.js","assets/BeatLoader.8E6aB4W4.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
