import{r as v,u as B,a as M,b as L,e as w,o as H,d as J,j as u,g as r,p as y,w as j,l as b,k as _,i as t,t as c,F as K,N as V,K as q,n as x,h as m,x as G,q as $,_ as P}from"./index.GdMxdeuf.js";import{_ as W}from"./EditFormSkeleton.Pn2vxq9j.js";import{_ as X}from"./VTextInput.ZgtOiOMJ.js";import{a as Y,E as Z,F as ee}from"./vee-validate.esm.9aElOHQY.js";import{c as U,d as N,h as te,a as se}from"./index.esm.0vhAmrVd.js";/* empty css                                                   */import{C as A}from"./ClipLoader.UcGuNCxH.js";import"./VTooltip.Ewb958d6.js";/* empty css                                                   */const ae={class:"row"},ne={class:"col-md-12"},oe={class:"row"},re={class:"col-md-12"},le={class:"card"},ce={class:"row"},ie={class:"col-4 col-md-3 col-lg-2"},de={class:"col-md-12"},ue={class:"card"},me={class:"row"},_e={class:"section-title pb-2 text-muted"},pe={class:"col-md-4 mb-4"},he={class:"table-responsive"},ve={class:"table table-hover table-bordered mb-3 table-responsive-data"},ye={class:"bg-light"},ge={class:"text-center"},be={class:"text-center"},fe={class:"text-center"},ke=["onUpdate:modelValue"],we=["onUpdate:modelValue"],Ve={key:0,"data-title":"Search Product",width:"20%"},qe={key:1,"data-title":"Search Product",width:"20%"},Se={"data-title":"System Quantity",width:"15%"},Ce={"data-title":"Counted Quantity",width:"15%"},xe={"data-title":"Action",width:"5%",class:"text-center"},$e=["onClick"],Pe=t("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[t("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),Ue=[Pe],Ne={class:"col-md-12"},Ae={class:"card"},Ee={class:"row"},Oe={class:"section-title text-muted"},Fe={for:"",class:"text-warning h6"},Ie={class:"col-12"},Qe={class:"text-end"},Re=["disabled"],Te={key:1,class:"pt-0"},De={key:2,class:"pt-0"},ze=["disabled"],Be={key:1,class:"pt-0"},Me={key:2,class:"pt-0"},st={__name:"AddInventoryCount",setup(Le){const f=v(0),{t:l}=B(),k=v({search_placeholder:l("Search and Add Product"),reference_no:l("Reference No.")}),E=$(()=>P(()=>import("./ServerMessage.Wf7puwQc.js"),__vite__mapDeps([0,1,2]))),O=$(()=>P(()=>import("./ProductSearch.7we3JR7U.js"),__vite__mapDeps([3,1,2,4,5,6,7,8]))),h=M().params.slack,i=v([]);L();const e=w({...{server_messages:{type:"",messages:""},is_submitting:!1,slack:"",reference_no:"",terms:"",inventory_count_items:[]}}),F=U().shape({reference_no:N().typeError(l("must be a number",{name:l("PO Reference")})).nullable().moreThan(0,"PO Reference cannot be negative").transform((s,a)=>a!==""?Number(a):null),inventory_count_items:te(U({product_name:se().required(l("name is required",{name:l("Product Name")})),counted_quantity:N().typeError(l("must be a number",{name:l("Quantity")})).required(l("name is required",{name:l("Quantity")})).positive(l("must be a positive number",{name:l("Quantity")}))})).required()});H(()=>{I(),h!=null&&Q()});async function I(){let s=await axios.get("api/v2/inventory_count/add");e.reference_no=s.data.data.reference_no}const S=v(!1);async function Q(){await axios.get("/api/v2/inventory_count",{params:{slack:h}}).then(s=>{if(S.value=!0,i.value=s.data.data,e.slack=i.value.slack,e.reference_no=i.value.reference_no,e.status=i.value.status,e.terms=i.value.terms,i.value.items.length>0){e.inventory_count_items=[];for(var a=0;a<i.value.items.length;a++){let o=w({product_slack:i.value.items[a].product_slack,product_name:i.value.items[a].product_name,system_quantity:i.value.items[a].system_quantity,counted_quantity:i.value.items[a].counted_quantity});e.inventory_count_items.push(o)}}}).catch(s=>{e.server_messages.type="error",e.server_messages.messages=s,console.log(s)})}const g=v([]);function R(s){g.value.push(s.slack);let a=w({type:1,product_slack:s.slack,product_name:s.name,system_quantity:s.quantity,counted_quantity:0});e.inventory_count_items.push(a)}function T(s){e.inventory_count_items.splice(e.inventory_count_items.indexOf(s),1),g.value.splice(g.value.indexOf(s.product_slack),1)}async function D(){e.is_submitting=!0;var s=new FormData;s.append("ic_slack",e.slack),s.append("reference_no",e.reference_no),s.append("terms",e.terms),s.append("products",JSON.stringify(e.inventory_count_items)),s.append("status",f.value);var a=e.slack!=""&&e.slack!=null?"/api/v2/inventory_count/update":"/api/v2/inventory_count/save";await axios.post(a,s).then(o=>{if(o.data.status_code==200)toast.success(o.data.msg),e.is_submitting=!1,router.push("/inventory_counts");else{try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(o.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=o.data.msg}e.is_submitting=!1}}).catch(o=>{e.server_messages.type="error",e.server_messages.messages=o,e.is_submitting=!1})}const z=J(()=>e.terms==""||e.terms==null?"0 / 500 Characters":e.terms.length+" / 500 Characters");return(s,a)=>{const o=X,C=W;return u(h)==""||u(h)==null||u(h)!=""&&S.value?(r(),y(u(ee),{key:0,"validation-schema":u(F),onSubmit:D,enctype:"multipart/form-data","initial-values":e},{default:j(()=>[t("div",ae,[e.server_messages.messages!=""?(r(),y(u(E),{key:0,class:"py-3",server_messages:e.server_messages},null,8,["server_messages"])):b("",!0),t("div",ne,[t("div",oe,[t("div",re,[t("div",le,[t("div",ce,[t("div",ie,[_(o,{type:"text",name:"reference_no",modelValue:e.reference_no,"onUpdate:modelValue":a[0]||(a[0]=n=>e.reference_no=n),label:k.value.reference_no},null,8,["modelValue","label"])])])])]),t("div",de,[t("div",ue,[t("div",me,[t("h5",_e,c(s.$t("Products"))+":",1),t("div",pe,[_(u(O),{onSelectProduct:R,placeholder:k.value.search_placeholder,selected_products:g.value,button_placeholder:k.value.add_service},null,8,["placeholder","selected_products","button_placeholder"])]),t("div",he,[t("table",ve,[t("thead",ye,[t("tr",null,[t("th",null,c(s.$t("Product")),1),t("th",ge,c(s.$t("System Quantity")),1),t("th",be,c(s.$t("Counted Quantity")),1),t("th",fe,c(s.$t("Remove")),1)])]),t("tbody",null,[e.inventory_count_items.length>0?(r(!0),m(K,{key:0},G(e.inventory_count_items,(n,p)=>(r(),m("tr",{key:p},[q(t("input",{type:"hidden",name:"product_name","onUpdate:modelValue":d=>n.product_name=d},null,8,ke),[[V,n.product_name]]),q(t("input",{type:"hidden",name:"product.slack","onUpdate:modelValue":d=>n.product_slack=d},null,8,we),[[V,n.product_slack]]),n.type==1?(r(),m("td",Ve,[x(c(n.product_name)+" ",1),_(u(Y),{type:"hidden",name:"inventory_count_items["+p+"].product_name",value:n.product_name},null,8,["name","value"]),_(u(Z),{name:"inventory_count_items["+p+"].product_name",as:"div",class:"error"},null,8,["name"])])):(r(),m("td",qe,[_(o,{type:"text",name:"inventory_count_items["+p+"].product_name",label:"",modelValue:n.product_name,"onUpdate:modelValue":d=>n.product_name=d},null,8,["name","modelValue","onUpdate:modelValue"])])),t("td",Se,[_(o,{type:"number",name:"inventory_count_items["+p+"].system_quantity",label:"",readonly:"",modelValue:n.system_quantity,"onUpdate:modelValue":d=>n.system_quantity=d},null,8,["name","modelValue","onUpdate:modelValue"])]),t("td",Ce,[_(o,{type:"number",name:"inventory_count_items["+p+"].counted_quantity",label:"",modelValue:n.counted_quantity,"onUpdate:modelValue":d=>n.counted_quantity=d},null,8,["name","modelValue","onUpdate:modelValue"])]),t("td",xe,[t("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:d=>T(n)},Ue,8,$e)])]))),128)):b("",!0)])])])])])]),t("div",Ne,[t("div",Ae,[t("div",Ee,[t("h5",Oe,[x(c(s.$t("Note/Terms and Conditions"))+": ",1),t("label",Fe,c(u(z)),1)]),t("div",Ie,[q(t("textarea",{maxlength:"500",class:"form-control form-control-solid text-area",name:"terms","onUpdate:modelValue":a[1]||(a[1]=n=>e.terms=n),rows:"1"},null,512),[[V,e.terms]])])])])])])])]),t("div",Qe,[t("button",{type:"submit",class:"btn btn-warning",disabled:e.is_submitting,onClick:a[2]||(a[2]=n=>f.value=0)},[e.is_submitting?(r(),y(A,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):b("",!0),e.is_submitting?(r(),m("span",Te,c(s.$t("Saving...")),1)):(r(),m("span",De,c(s.$t("Save as draft")),1))],8,Re),t("button",{type:"submit",class:"btn btn-primary ms-2",disabled:e.is_submitting,onClick:a[3]||(a[3]=n=>f.value=1)},[e.is_submitting?(r(),y(A,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):b("",!0),e.is_submitting?(r(),m("span",Be,c(s.$t("Saving...")),1)):(r(),m("span",Me,c(s.$t("Submit")),1))],8,ze)])]),_:1},8,["validation-schema","initial-values"])):(r(),y(C,{key:1}))}}};export{st as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ServerMessage.Wf7puwQc.js","assets/index.GdMxdeuf.js","assets/index.1t-AB2n6.css","assets/ProductSearch.7we3JR7U.js","assets/vee-validate.esm.9aElOHQY.js","assets/index.esm.0vhAmrVd.js","assets/BeatLoader.czpWuXPY.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
