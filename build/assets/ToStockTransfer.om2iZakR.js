import D from"./ServerMessage.I5ol-gtz.js";import{_ as P}from"./VSelect.UFegTIpk.js";import{_ as I}from"./VTextInput.VtSvZjuc.js";import{u as O,e as B,r as y,o as J,v as z,g as i,h as l,i as a,t as n,k as h,w as M,l as c,F as K,y as b,N as L,K as W,x as G,p as V,j as S}from"./index.7OFNPsHl.js";import{F as H}from"./vee-validate.esm.N3uz7Rsk.js";import{c as N,h as X,a as U}from"./index.esm.cd1bITNA.js";/* empty css                                                   */import{C as F}from"./ClipLoader.1qNfpKDH.js";/* empty css                                                                */import"./VTooltip.n3SV8A0p.js";/* empty css                                                   */const Y={class:"row"},Z={class:"col-md-12"},x={class:"card"},ee={class:"row"},te={class:"section-title pb-3 text-muted"},se={class:"col-12 py-3"},ae={class:"table table-condensed"},ne={width:"20%"},oe={width:"5%"},ie={width:"5%"},le={width:"7%"},re={width:"5%"},ce={key:0,width:"7%"},de={key:1,width:"7%"},ue={key:2,width:"7%"},_e={key:3,width:"7%"},me={width:"10%"},pe={width:"7%"},ye={width:"7%"},he={key:0},ge={key:1,class:"text-center"},be={key:2},fe={key:3,class:"text-center"},ke={class:"text-center"},qe=["name","onUpdate:modelValue","title"],ve={key:0,class:"badge badge-primary"},je={key:1,class:"badge badge-success"},$e={key:1},we={colspan:"10",class:"text-center"},Ve={key:0,class:"col-12 py-3"},Se={key:1,class:"col-12 mt-2 text-end"},Ne=["disabled"],Ue={key:1,class:"pt-0"},Fe={key:2,class:"pt-0"},Ae=["disabled"],Ce={key:1,class:"pt-0"},Qe={key:2,class:"pt-0"},Le={__name:"ToStockTransfer",props:["stock_transfer"],setup(A){const{t:d}=O(),t=B({...{server_messages:{type:"",messages:""},is_disabled:!0,stock_transfer_products:[]}}),C=N({stock_transfer_products:X(N().shape({accept_quantity:U().typeError(d("must be a number",{name:d("Quantity")})).required(d("name is required",{name:d("Quantity")})).min(0,d("must be greater than or equal to n",{name:d("Value"),number:0})).test({test:function(e,o){var u=$('[name="'+o.path+'"]').attr("max");return e<=parseFloat(u)?!0:o.createError({path:`${o.path}`,message:d("must be less than or equal to n",{name:d("Quantity"),number:u})})}}),rejected_reason:U().nullable().when("reject_quantity",{is:e=>e>0,then:e=>e.required(d("name is required",{name:d("Reject Reason")})),otherwise:e=>e.nullable()})},["reject_quantity","rejected_reason"]))}),Q=y([{key:1,value:"Wastage/Damaged"},{key:2,value:"Undelivered"},{key:3,value:"No Reason"},{key:4,value:"Other"}]),r=A;y(!1);const q=y([]),g=y([]),E=y(!1),v=y("all");J(()=>{R()});function j(){t.is_disabled=!0;var e=0;_.forEach(t.stock_transfer_products,o=>{(o.accept_quantity>0||o.reject_quantity>0)&&(e=e+1)}),e>0?t.is_disabled=!1:t.is_disabled=!0}function w(e){e=="Selected"&&(v.value="selected")}function R(){_.forEach(r.stock_transfer.stock_transfer_products,e=>{let o=parseFloat(e.accepted_quantity)+parseFloat(e.rejected_quantity)==e.quantity?1:0,u=isNaN(e.accepted_quantity)?0:e.accepted_quantity,f=isNaN(e.rejected_quantity)?0:e.rejected_quantity,k=parseFloat(e.quantity)-(parseFloat(u)+parseFloat(f)),s={st_product_slack:e.slack,product_name:e.product.name,sku:e.sku,upc:e.product.upc,sale_price:e.sale_price,quantity:e.quantity,accept_quantity:0,reject_quantity:0,rejected_reason:e.rejected_reason,other_reason:e.other_reason,pending_quantity:k,status:o,accepted_at:e.accepted_at_label,rejected_quantity:e.rejected_quantity,accepted_quantity:e.accepted_quantity};t.stock_transfer_products.push(s),q.value.push(e.slack)})}z(()=>g.value,()=>{let e=0;for(let o=0;o<t.stock_transfer_products.length;o++)t.stock_transfer_products[o].pending_quantity>0&&(e=parseInt(e)+1);E.value=g.value.length===e});async function T(){t.is_disabled=!0,t.is_submitting=!0;var e=new FormData;e.append("stock_transfer_slack",r.stock_transfer.slack),e.append("all_products",JSON.stringify(q.value)),e.append("all_selected_products",JSON.stringify(g.value)),e.append("products",JSON.stringify(t.stock_transfer_products)),e.append("mode",v.value),await axios.post("/api/stock_transfer/product/accept",e).then(o=>{if(o.data.status_code==200)toast.success(o.data.msg),setTimeout(()=>{router.push("/stock_transfers")},2e3);else{try{t.server_messages.type="error",t.server_messages.messages=JSON.parse(o.data.msg)}catch{t.server_messages.type="error",t.server_messages.messages=o.data.msg}t.is_submitting=!1,t.is_disabled=!1}}).catch(o=>{t.server_messages.type="error",t.server_messages.messages=o,t.is_submitting=!1,t.is_disabled=!1,console.log(o)})}return(e,o)=>{const u=I,f=P,k=D;return i(),l("div",Y,[a("div",Z,[a("div",x,[a("div",ee,[a("h5",te,n(e.$t("Products Details"))+":",1),h(S(H),{onSubmit:T,"validation-schema":S(C),"initial-values":t},{default:M(()=>[a("div",se,[a("table",ae,[a("thead",null,[a("tr",null,[a("th",ne,n(e.$t("Product")),1),a("th",oe,n(e.$t("UPC")),1),a("th",ie,n(e.$t("SKU")),1),a("th",le,n(e.$t("Sale Price")),1),a("th",re,n(e.$t("Total Qty.")),1),r.stock_transfer.status==2||r.stock_transfer.status==3?(i(),l("th",ce,n(e.$t("Accepted Qty.")),1)):c("",!0),r.stock_transfer.status<2?(i(),l("th",de,n(e.$t("Enter Accept Qty.")),1)):c("",!0),r.stock_transfer.status==2||r.stock_transfer.status==3?(i(),l("th",ue,n(e.$t("Rejected Qty.")),1)):c("",!0),r.stock_transfer.status<2?(i(),l("th",_e,n(e.$t("Enter Reject Qty.")),1)):c("",!0),a("th",me,n(e.$t("Reject Reason")),1),a("th",pe,n(e.$t("Accepted Status")),1),a("th",ye,n(e.$t("Accepted At")),1)])]),a("tbody",null,[t.stock_transfer_products.length>0?(i(!0),l(K,{key:0},G(t.stock_transfer_products,(s,p)=>(i(),l("tr",{key:p},[a("td",null,[a("strong",null,n(s.product_name),1)]),a("td",null,n(s.upc),1),a("td",null,n(s.sku),1),a("td",null,n(s.sale_price),1),a("td",null,n(s.quantity),1),s.pending_quantity>0?(i(),l("td",he,[h(u,{type:"number",name:"stock_transfer_products["+p+"].accept_quantity",modelValue:s.accept_quantity,"onUpdate:modelValue":m=>s.accept_quantity=m,min:"0",class:b("pt-3"),max:s.pending_quantity,islabel:!1,onChange:j},null,8,["name","modelValue","onUpdate:modelValue","max"])])):(i(),l("td",ge,[h(u,{type:"text",name:"stock_transfer_products["+p+"].accept_quantity",modelValue:s.accepted_quantity,"onUpdate:modelValue":m=>s.accepted_quantity=m,class:b("pt-3"),max:s.accepted_quantity,islabel:!1,disabled:!0},null,8,["name","modelValue","onUpdate:modelValue","max"])])),s.pending_quantity>0?(i(),l("td",be,[h(u,{type:"number",name:"stock_transfer_products["+p+"].reject_quantity",modelValue:s.reject_quantity,"onUpdate:modelValue":m=>s.reject_quantity=m,min:"0",class:b("pt-3"),max:s.pending_quantity,islabel:!1,onChange:j},null,8,["name","modelValue","onUpdate:modelValue","max"])])):(i(),l("td",fe,n(s.rejected_quantity),1)),a("td",ke,[h(f,{name:"stock_transfer_products["+p+"].rejected_reason",modelValue:s.rejected_reason,"onUpdate:modelValue":m=>s.rejected_reason=m,options:Q.value,class:b("pt-3"),islabel:!1,disabled:s.reject_quantity<=0},null,8,["name","modelValue","onUpdate:modelValue","options","disabled"]),s.rejected_reason==4?W((i(),l("input",{key:0,type:"text",name:"stock_transfer_products["+p+"].other_reason","onUpdate:modelValue":m=>s.other_reason=m,class:"form-control form-control-solid mt-2",placeholder:"Enter Reason",title:s.other_reason},null,8,qe)),[[L,s.other_reason]]):c("",!0)]),a("td",null,[s.status==0?(i(),l("span",ve,n(e.$t("Pending")),1)):(i(),l("span",je,n(e.$t("Accepted")),1))]),a("td",null,n(s.accepted_at!=null?s.accepted_at:"-"),1)]))),128)):(i(),l("tr",$e,[a("td",we,n(e.$t("No Product Available")),1)]))])])]),t.server_messages.messages!=""?(i(),l("div",Ve,[h(k,{server_messages:t.server_messages},null,8,["server_messages"])])):c("",!0),t.stock_transfer_products!=null?(i(),l("div",Se,[g.value.length>0&&r.stock_transfer.status!=2&&r.stock_transfer.status!=4?(i(),l("button",{key:0,type:"submit",class:"btn btn-primary",onClick:o[0]||(o[0]=s=>w("Selected")),disabled:t.is_submitting},[t.is_submitting?(i(),V(F,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):c("",!0),t.is_submitting?(i(),l("span",Ue,n(e.$t("Saving...")),1)):(i(),l("span",Fe,n(e.$t("Accept Selected")),1))],8,Ne)):c("",!0),g.value.length<1&&r.stock_transfer.status!=2&&r.stock_transfer.status!=4?(i(),l("button",{key:1,type:"submit",class:"btn btn-primary ms-2",onClick:o[1]||(o[1]=s=>w("All")),disabled:t.is_disabled},[t.is_submitting?(i(),V(F,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):c("",!0),t.is_submitting?(i(),l("span",Ce,n(e.$t("Saving...")),1)):(i(),l("span",Qe,n(e.$t("Submit")),1))],8,Ae)):c("",!0)])):c("",!0)]),_:1},8,["validation-schema","initial-values"])])])])])}}};export{Le as default};
