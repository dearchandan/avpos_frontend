import B from"./ServerMessage.I5ol-gtz.js";import{_ as O}from"./VTextInput.VtSvZjuc.js";import{u as U,e as D,r as m,o as E,v as L,g as o,h as l,i as e,t as s,k as w,w as M,Q as S,K as b,l as r,F as A,p as k,x,y as R,M as C,j as z}from"./index.7OFNPsHl.js";import{F as J}from"./vee-validate.esm.N3uz7Rsk.js";import"./index.esm.cd1bITNA.js";/* empty css                                                   */import{C as P}from"./ClipLoader.1qNfpKDH.js";import"./VTooltip.n3SV8A0p.js";/* empty css                                                   */const j={class:"row"},K={class:"col-md-12"},G={class:"card"},H={class:"row"},W={class:"col-md-12 mb-3"},X={class:"col-12"},Y={class:"table table-condensed"},Z={key:0,width:"5%"},tt={width:"10%"},et={width:"10%",class:"text-end"},st={key:1,width:"10%",class:"text-end"},at={width:"10%",class:"text-end"},nt={width:"10%",class:"text-end"},ot={width:"10%",class:"text-end"},lt={width:"10%",class:"text-end"},ct={width:"10%",class:"text-end"},it={width:"10%",class:"text-center"},rt={key:0},dt=["value","id"],ut={class:"text-end"},_t={key:1,class:"text-end"},pt=["id"],ht={class:"text-end"},mt={class:"text-end"},gt={class:"text-end"},yt={class:"text-end"},vt={class:"text-end"},bt={class:"text-center"},ft={key:0,class:"badge badge-primary"},kt={key:1,class:"badge badge-info"},$t={key:2,class:"badge badge-success"},qt={key:1},wt={colspan:"8"},St={class:"col-12"},At={class:"row"},xt={class:"table table-condensed"},Ct={key:0,class:"col-6"},Pt={class:"col-3 text-end mt-3"},Vt={class:"table table-condensed"},Ft={class:"p-0"},Tt={class:"p-0"},It={key:0,class:"col-12 py-3"},Nt={class:"col-12 mt-2 text-end"},Qt=["disabled"],Bt={key:1,class:"pt-0"},Ot={key:2,class:"pt-0"},Ut=["disabled"],Dt={key:1,class:"pt-0"},Et={key:2,class:"pt-0"},Xt={__name:"PurchaseOrderProduct",props:["purchase_order"],setup(V){const{t:F}=U(),a=D({...{server_messages:{type:"",messages:""}}}),c=V;m(!1);const d=m([]),u=m([]),y=m(!1),$=m("all"),f=m(!1);E(()=>{I()});function T(t,i){t.accept_quantity=t.accept_quantity.toString().replace(/-/g,"");var p=document.getElementById("accept_quantity_error"+i);if(t.accept_quantity>t.pending_quantity)p.classList.remove("d-none"),f.value=!0;else{p.classList.add("d-none"),f.value=!1,a.server_messages.messages="",a.is_disabled=!0;var g=0;_.forEach(d.value,n=>{n.accept_quantity>0&&(g=g+1)}),g>0?a.is_disabled=!1:a.is_disabled=!0}}function q(t){f.value==!1?(t=="selected"&&($.value="selected"),a.server_messages.messages="",Q()):(a.server_messages.type="error",a.server_messages.messages=F("Please check the items Accept Quantity. It must be less than or equal to Pending quantity!"))}function I(){_.forEach(c.purchase_order.purchase_order_products,t=>{let i=parseFloat(t.product_quantity)-parseFloat(t.accepted_quantity),p={type:t.type,po_product_slack:t.slack,product_name:t.product_name,quantity:t.product_quantity,pending_quantity:i,accept_quantity:i.toFixed(2),sale_price:t.product_price_without_tax,amount:t.subtotal_after_product_quantity,tax:t.tax!=null?t.tax.name:"-",tax_amount:t.product_tax,total_amount:t.product_amount,status:t.acceptance_status,accepted_at:t.accepted_at_label};d.value.push(p)})}const N=()=>{if(u.value=[],y.value)for(let t=0;t<d.value.length;t++)u.value.push(d.value[t].po_product_slack)};L(()=>u.value,()=>{y.value=u.value.length===d.value.length});async function Q(){a.is_submitting=!0;var t=new FormData;t.append("purchase_order_slack",c.purchase_order.slack),t.append("all_selected_products",JSON.stringify(u.value)),t.append("purchase_order_products",JSON.stringify(d.value)),t.append("mode",$.value),await axios.post("/api/purchase_order/product/accept",t).then(i=>{if(a.is_submitting=!1,i.data.status_code==200)toast.success(i.data.msg),setTimeout(()=>{window.location.reload()},2e3);else{try{a.server_messages.type="error",a.server_messages.messages=JSON.parse(i.data.msg)}catch{a.server_messages.type="error",a.server_messages.messages=i.data.msg}a.is_submitting=!1}}).catch(i=>{a.server_messages.type="error",a.server_messages.messages=i,a.is_submitting=!1,console.log(i)})}return(t,i)=>{const p=O,g=B;return o(),l("div",j,[e("div",K,[e("div",G,[e("div",H,[e("div",W,[e("h5",null,s(t.$t("Products/Services")),1)]),w(z(J),null,{default:M(()=>[e("div",X,[e("table",Y,[e("thead",null,[e("tr",null,[c.purchase_order.approval_status==1&&c.purchase_order.delivery_status!=2?(o(),l("th",Z,[b(e("input",{type:"checkbox",class:"form-check-input me-1","onUpdate:modelValue":i[0]||(i[0]=n=>y.value=n),onChange:N},null,544),[[S,y.value]])])):r("",!0),e("th",tt,s(t.$t("Product/Service")),1),e("th",et,s(t.$t("Quantity")),1),c.purchase_order.approval_status==1&&c.purchase_order.delivery_status!=2?(o(),l("th",st,s(t.$t("Accept Quantity")),1)):r("",!0),e("th",at,s(t.$t("Unit Price")),1),e("th",nt,s(t.$t("Amount")),1),e("th",ot,s(t.$t("Tax %")),1),e("th",lt,s(t.$t("Tax Amount")),1),e("th",ct,s(t.$t("Total")),1),e("th",it,s(t.$t("Accepted Status")),1)])]),e("tbody",null,[d.value.length>0?(o(!0),l(A,{key:0},x(d.value,(n,h)=>(o(),l("tr",{key:h},[c.purchase_order.approval_status==1&&c.purchase_order.delivery_status!=2?(o(),l("td",rt,[n.status!=2?b((o(),l("input",{key:0,type:"checkbox",class:"form-check-input me-1",value:n.po_product_slack,"onUpdate:modelValue":i[1]||(i[1]=v=>u.value=v),id:h},null,8,dt)),[[S,u.value]]):r("",!0)])):r("",!0),e("td",null,[e("strong",null,s(n.product_name),1)]),e("td",ut,s(n.quantity),1),c.purchase_order.approval_status==1&&c.purchase_order.delivery_status!=2?(o(),l("td",_t,[n.status!=2?(o(),k(p,{key:0,type:"number",name:"accept_quantity["+h+"]",modelValue:n.accept_quantity,"onUpdate:modelValue":v=>n.accept_quantity=v,max:n.accept_quantity,min:0,step:.01,onInput:v=>T(n,h)},null,8,["name","modelValue","onUpdate:modelValue","max","onInput"])):r("",!0),e("div",{id:"accept_quantity_error"+h,class:"error d-none"},s(t.$t("Accept Quantity must be less than or equal to Balance Quantity of "+n.pending_quantity)),9,pt)])):r("",!0),e("td",ht,s(n.sale_price),1),e("td",mt,s(n.amount),1),e("td",gt,s(n.tax),1),e("td",yt,s(n.tax_amount),1),e("td",vt,s(n.total_amount),1),e("td",bt,[n.status==0?(o(),l("span",ft,s(t.$t("Pending")),1)):r("",!0),n.status==1?(o(),l("span",kt,s(t.$t("Partial Accepted")),1)):r("",!0),n.status==2?(o(),l("span",$t,s(t.$t("Accepted")),1)):r("",!0)])]))),128)):(o(),l("tr",qt,[e("td",wt,s(t.$t("No Product Available")),1)]))])])]),e("div",St,[e("div",At,[e("div",{class:R(c.purchase_order.purchase_order_charges.length>0?"col-3":"col-9")},[b(e("h6",{class:"mt-3"},s(t.$t("Other Charges")),513),[[C,c.purchase_order.purchase_order_charges.length>0]]),e("table",xt,[(o(!0),l(A,null,x(c.purchase_order.purchase_order_charges,(n,h)=>(o(),l("tr",{key:h},[e("td",null,s(n.title),1),e("td",null,s(n.charges),1)]))),128))])],2),c.purchase_order.purchase_order_charges.length>0?(o(),l("div",Ct)):r("",!0),e("div",Pt,[e("table",Vt,[e("tr",null,[e("td",null,s(t.$t("Sub Total ")),1),e("td",null,s(c.purchase_order.grand_subtotal_after_product_quantity)+" SAR",1)]),e("tr",null,[e("td",null,s(t.$t("Taxes")),1),e("td",null,s(c.purchase_order.grand_product_tax)+" SAR",1)]),b(e("tr",null,[e("td",null,s(t.$t("Other Charges")),1),e("td",null,s(c.purchase_order.grand_product_other_changes)+" SAR",1)],512),[[C,c.purchase_order.grand_product_other_changes>0]]),e("tr",null,[e("td",null,[e("h5",Ft,s(t.$t("Total")),1)]),e("td",null,[e("h5",Tt,s(c.purchase_order.grand_product_amount)+" SAR",1)])])])])])]),a.server_messages.messages!=""?(o(),l("div",It,[w(g,{server_messages:a.server_messages},null,8,["server_messages"])])):r("",!0),e("div",Nt,[u.value.length>0?(o(),l("button",{key:0,type:"button",class:"btn btn-primary",disabled:a.is_submitting||a.is_disabled,onClick:i[2]||(i[2]=n=>q("selected"))},[a.is_submitting?(o(),k(P,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):r("",!0),a.is_submitting?(o(),l("span",Bt,s(t.$t("Saving...")),1)):(o(),l("span",Ot,s(t.$t("Accept Selected")),1))],8,Qt)):r("",!0),c.purchase_order.approval_status==1&&c.purchase_order.delivery_status!=2?(o(),l("button",{key:1,type:"button",class:"btn btn-primary ms-2",disabled:a.is_submitting||a.is_disabled,onClick:i[3]||(i[3]=n=>q("all"))},[a.is_submitting?(o(),k(P,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):r("",!0),a.is_submitting?(o(),l("span",Dt,s(t.$t("Saving...")),1)):(o(),l("span",Et,s(t.$t("Accept All")),1))],8,Ut)):r("",!0)])]),_:1})])])])])}}};export{Xt as default};
