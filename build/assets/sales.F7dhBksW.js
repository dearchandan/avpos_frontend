import{u as me,a as pe,b as he,d as P,e as M,r as u,o as ge,v as L,g as n,p as x,w as R,I as fe,f as be,k as h,i as e,t as a,A as F,B as Z,j as m,n as K,K as z,M as ye,h as i,l as p,N as ve,F as Ce,x as ke,O as we,q as $e,_ as Oe}from"./index.7OFNPsHl.js";import{_ as De}from"./DefaultLayout.nvkZ4UhM.js";import{_ as Me}from"./PaginateLimit.Xv-qfeqj.js";import{_ as Ve}from"./ListingSkeleton.iExoV4hO.js";import{_ as Se}from"./VMultiSelect.XXz7TsgF.js";import{_ as Ae}from"./SalesMenu.shs1JWgg.js";import{b as Ee,c as He,s as U,j as Re}from"./vue-datepicker.sD5zgpde.js";import{u as Te}from"./global.wK1y07-b.js";import{s as J,e as W}from"./index.PeC7PMAQ.js";import"./ClipLoader.1qNfpKDH.js";/* empty css                                                   */import"./vee-validate.esm.N3uz7Rsk.js";const Ne={class:"content"},qe={class:"page-heading"},Ie={class:"row align-items-center justify-content-between mb-3"},je={class:"col-auto"},Be={class:"mb-0"},Pe={class:"row align-items-center justify-content-between g-3"},Le={class:"col col-lg-auto order-2 order-md-1"},xe={class:"row g-3 align-items-end"},Fe={class:"col col-md-auto"},Ze={class:"form-field"},Ke=["onClick","onKeyup"],ze={class:"col-auto col-md-auto"},Ue={class:"btn btn-sm btn-light-primary font-weight-normal",type:"button","data-bs-toggle":"collapse","data-bs-target":"#subFilter","aria-expanded":"false","aria-controls":"collapseExample"},Je=e("svg",{width:"13",height:"14",viewBox:"0 0 13 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M0.464286 2.33333H7.03022C7.23775 3.136 7.95879 3.73333 8.82143 3.73333C9.68407 3.73333 10.4051 3.136 10.6126 2.33333H12.5357C12.792 2.33333 13 2.12427 13 1.86667C13 1.60907 12.792 1.4 12.5357 1.4H10.6126C10.4051 0.597333 9.68407 0 8.82143 0C7.95879 0 7.23775 0.597333 7.03022 1.4H0.464286C0.208 1.4 0 1.60907 0 1.86667C0 2.12427 0.208 2.33333 0.464286 2.33333ZM8.82143 0.933333C9.33354 0.933333 9.75 1.35193 9.75 1.86667C9.75 2.3814 9.33354 2.8 8.82143 2.8C8.30932 2.8 7.89286 2.3814 7.89286 1.86667C7.89286 1.35193 8.30932 0.933333 8.82143 0.933333ZM12.5357 11.6667H10.6126C10.4051 10.864 9.68407 10.2667 8.82143 10.2667C7.95879 10.2667 7.23775 10.864 7.03022 11.6667H0.464286C0.208 11.6667 0 11.8757 0 12.1333C0 12.3909 0.208 12.6 0.464286 12.6H7.03022C7.23775 13.4027 7.95879 14 8.82143 14C9.68407 14 10.4051 13.4027 10.6126 12.6H12.5357C12.792 12.6 13 12.3909 13 12.1333C13 11.8757 12.792 11.6667 12.5357 11.6667ZM8.82143 13.0667C8.30932 13.0667 7.89286 12.6481 7.89286 12.1333C7.89286 11.6186 8.30932 11.2 8.82143 11.2C9.33354 11.2 9.75 11.6186 9.75 12.1333C9.75 12.6481 9.33354 13.0667 8.82143 13.0667ZM12.5357 6.53333H5.5055C5.29797 5.73067 4.57693 5.13333 3.71429 5.13333C2.85164 5.13333 2.13061 5.73067 1.92307 6.53333H0.464286C0.208 6.53333 0 6.7424 0 7C0 7.2576 0.208 7.46667 0.464286 7.46667H1.92307C2.13061 8.26933 2.85164 8.86667 3.71429 8.86667C4.57693 8.86667 5.29797 8.26933 5.5055 7.46667H12.5357C12.792 7.46667 13 7.2576 13 7C13 6.7424 12.792 6.53333 12.5357 6.53333ZM3.71429 7.93333C3.20218 7.93333 2.78571 7.51473 2.78571 7C2.78571 6.48527 3.20218 6.06667 3.71429 6.06667C4.22639 6.06667 4.64286 6.48527 4.64286 7C4.64286 7.51473 4.22639 7.93333 3.71429 7.93333Z",fill:"currentColor"})],-1),We={class:"col-auto col-md-auto"},Ge={class:"col-12 col-md-4 col-lg-3 order-1 order-md-2"},Qe={class:"form-field mb-0"},Xe={class:"field-icon"},Ye=["placeholder"],et={class:"icon"},tt={class:"collapse",id:"subFilter"},st={class:"sub-filter"},at={class:"row align-items-center g-3"},ot={class:"col-6 col-md-auto"},nt={class:"col-6 col-md-auto"},lt={class:"col-6 col-md-auto d-md-block"},it={key:0},ct={key:1,class:"table-responsive"},rt={class:"table table-list-data table-hover"},dt={class:"bg-light"},_t={scope:"col",width:"10%"},ut={scope:"col",width:"10%"},mt={scope:"col",width:"5%"},pt={scope:"col",width:"10%"},ht={scope:"col",width:"5%"},gt={scope:"col",width:"5%",class:"text-end"},ft={scope:"col",width:"8%",class:"text-end"},bt={scope:"col",width:"20%",class:"text-end"},yt=["onClick"],vt=["onClick"],Ct=["onClick"],kt=["onClick"],wt=["onClick"],$t={key:0},Ot={key:1},Dt=["onClick"],Mt={key:0,class:"badge badge-primary"},Vt={key:1,class:"badge badge-success"},St={key:2,class:"badge badge-warning"},At={key:3,class:"badge badge-danger"},Et={key:4,class:"badge badge-danger"},Ht={key:5,class:"badge badge-secondary"},Rt={key:6,class:"badge badge-info"},Tt={key:7,class:"badge badge-danger"},Nt=e("s",null,"Cancelled",-1),qt=[Nt],It=["onClick"],jt={class:"text-end"},Bt=["onClick","disabled"],Pt=["href"],Lt={key:1},xt={class:"text-center py-3",colspan:"10"},Ft={class:"data-footer"},Zt={class:"row align-items-center justify-content-between"},Kt={class:"col-auto"},zt={class:"col-auto"},ls={__name:"sales",setup(Ut){const G=$e(()=>Oe(()=>import("./ServerMessage.I5ol-gtz.js"),__vite__mapDeps([0,1,2]))),{t:g}=me(),{isAuthorized:V,getRoundedValue:Q}=fe(),{order_types:X,sale_types:Y}=Te(),S=pe(),T=he(),ee=P(()=>T.user.currency.symbol),te=P(()=>T.user.branch_id),c=M({type:"",messages:""}),se={is_listing:!1,search_query:u(""),filter_count:0},ae=g("Search by order or reference number"),r=M({...se});ge(()=>{de(),oe(),S.query.order_filters!=""&&S.query.order_filters!=null?Object.assign(d,JSON.parse(S.query.order_filters)):f(),_e()}),L(()=>r.search_query,_.debounce(()=>{f()},500));const A=u(!1),N=M({terminal_id:u(""),business_dates:u([new Date,new Date]),order_type:u(""),sale_type:u("")}),d=M({...N}),q=u([]);async function oe(){await axios.post("/api/branch/terminals",{id:te.value}).then(t=>{if(t.data.status_code==200)q.value=t.data.data;else try{c.type="error",c.messages=JSON.parse(t.data.msg)}catch{c.type="error",c.messages=t.data.msg}}).catch(t=>{c.type="error",c.messages=t,console.log(t)})}const ne=u([{label:"Today",value:[new Date,new Date]},{label:"This Week",value:[Ee(new Date),He(new Date)]},{label:"This Month",value:[J(new Date),W(new Date)]},{label:"Last Month",value:[J(U(new Date,1)),W(U(new Date,1))]}]);L(d,()=>{r.filter_count=0,_.forEach(d,(t,o)=>{t!=""&&t!=null&&o!="business_dates"&&(r.filter_count=r.filter_count+1),r.filter_count>0&&(A.value=!0)}),f()},{deep:!0});const E=u([]),H=u([]);async function f(t=1){r.is_listing=!0,await axios.get("/api/v2/orders",{params:{page:t,paginate_limit:I.value,search_query:r.search_query,filters:d}}).then(o=>{E.value=o.data.data.data,H.value=o.data.data.pagination,r.is_listing=!1}).catch(o=>{c.type="error",c.messages=o,r.is_listing=!1,console.log(o)})}const I=u();async function le(t){I.value=t,await f()}function ie(){Object.assign(d,N),A.value=!1,r.filter_count=0,document.getElementsByClassName("multiselect-clear")[0].click(),document.getElementsByClassName("multiselect-clear")[1].click(),document.getElementsByClassName("multiselect-clear")[2].click(),f()}function ce(t){router.push({name:"View Order",params:{slack:t},query:{order_filters:JSON.stringify(d)}})}const re=u({write:!1,delete:!1});function de(){re.value={write:V("A_CLOSE_ORDER")||V("A_HOLD_ORDER"),delete:V("A_DELETE_ORDER")}}function b(t,o){t.target.closest("td:nth-child(10)")||ce(o)}const j=u("");async function _e(){const t=await axios.get("/api/v2/zatca/merchant");(t.data.status_code==200||t.data.status_code==201)&&(j.value=t.data.data)}const $=u(!1);async function ue(t){var o,O,k,v,D;$.value=!0;try{const C=await axios.post("/api/v2/zatca/signSimpliedInvoice",{slack:t});$.value=!1;const y=C.data;y.status_code===200&&((o=y.data)!=null&&o.res)?(toast.success("Invoice signed successfully!"),f()):(c.type="error",(O=y.data)!=null&&O.errors?c.messages=Object.values(y.data.errors).flat().join(", "):c.messages=((k=y.data)==null?void 0:k.message)||"An unknown error occurred.")}catch(C){$.value=!1,c.type="error",c.messages=((D=(v=C.response)==null?void 0:v.data)==null?void 0:D.message)||"Something went wrong.",console.error(C)}}return(t,o)=>{const O=Ae,k=be("Icon"),v=Se,D=Ve,C=Me,y=De;return n(),x(y,null,{subheader:R(()=>[h(O)]),default:R(()=>[e("div",Ne,[e("div",qe,[e("div",Ie,[e("div",je,[e("h2",Be,a(t.$t("Orders")),1)])]),e("div",Pe,[e("div",Le,[e("div",xe,[e("div",Fe,[e("div",Ze,[e("label",null,a(t.$t("Date Range")),1),h(m(Re),{range:"",format:"dd-MM-yyyy",modelValue:d.business_dates,"onUpdate:modelValue":o[0]||(o[0]=s=>d.business_dates=s),"enable-time-picker":!1,"input-class-name":"form-control form-control-sm form-control-solid",class:"dp-custom-sm","max-range":"90","multi-calendars":"","preset-dates":ne.value},{"preset-date-range-button":R(({label:s,value:w,presetDate:l})=>[e("span",{role:"button",tabindex:0,onClick:B=>l(w),onKeyup:[F(Z(B=>l(w),["prevent"]),["enter"]),F(Z(B=>l(w),["prevent"]),["space"])]},a(s),41,Ke)]),_:1},8,["modelValue","preset-dates"])])]),e("div",ze,[e("button",Ue,[Je,K(" "+a(t.$t("Filters"))+" ",1),z(e("span",{class:"badge",id:"filter_count_badge"},a(r.filter_count),513),[[ye,r.filter_count>0]])])]),e("div",We,[A.value?(n(),i("button",{key:0,class:"btn btn-sm btn-light-danger",onClick:ie},a(t.$t("Clear")),1)):p("",!0)])])]),e("div",Ge,[e("div",Qe,[e("div",Xe,[z(e("input",{type:"search",class:"form-control form-control-sm form-control-solid",placeholder:m(ae),"onUpdate:modelValue":o[1]||(o[1]=s=>r.search_query=s)},null,8,Ye),[[ve,r.search_query]]),e("div",et,[h(k,{icon:"fa6-solid:magnifying-glass"})])])])])]),e("div",tt,[e("div",st,[e("div",at,[e("div",ot,[h(v,{label:m(g)("Terminal"),modelValue:d.terminal_id,"onUpdate:modelValue":o[2]||(o[2]=s=>d.terminal_id=s),name:"terminals",placeholder:m(g)("All"),text:"terminal_name",value:"id",mode:"single",options:q.value,no_class:!1,height_sm:!0},null,8,["label","modelValue","placeholder","options"])]),e("div",nt,[h(v,{label:m(g)("Order Type"),modelValue:d.order_type,"onUpdate:modelValue":o[3]||(o[3]=s=>d.order_type=s),name:"order_type",placeholder:m(g)("All"),text:"value",value:"key",mode:"single",options:m(X),no_class:!1,height_sm:!0},null,8,["label","modelValue","placeholder","options"])]),e("div",lt,[h(v,{modelValue:d.sale_type,"onUpdate:modelValue":o[4]||(o[4]=s=>d.sale_type=s),name:"sale_types",text:"value",value:"key",mode:"single",options:m(Y),no_class:!1,height_sm:!0,placeholder:m(g)("All"),label:m(g)("Sale Type")},null,8,["modelValue","options","placeholder","label"])])])])])]),r.is_listing?(n(),i("div",it,[h(D)])):(n(),i("div",ct,[c.messages!=""?(n(),x(m(G),{key:0,server_messages:c},null,8,["server_messages"])):p("",!0),e("table",rt,[e("thead",dt,[e("tr",null,[e("th",_t,a(t.$t("Business Date")),1),e("th",ut,a(t.$t("Terminal")),1),e("th",mt,a(t.$t("Order No.")),1),e("th",pt,a(t.$t("Payment Method")),1),e("th",ht,a(t.$t("Order Type")),1),e("th",gt,a(t.$t("Status")),1),e("th",ft,a(t.$t("Amount")),1),e("th",bt,a(t.$t("Action")),1)])]),e("tbody",null,[E.value!=""?(n(!0),i(Ce,{key:0},ke(E.value,(s,w)=>(n(),i("tr",{role:"button",key:w},[e("td",{onClick:l=>b(l,s.slack)},a(s.business_date_label),9,yt),e("td",{onClick:l=>b(l,s.slack)},a(s.terminal_name),9,vt),e("td",{onClick:l=>b(l,s.slack)},"# "+a(s.order_number),9,Ct),e("td",{onClick:l=>b(l,s.slack)},a(s.payment_method_name),9,kt),e("td",{onClick:l=>b(l,s.slack)},[s.order_type==1?(n(),i("span",$t,a(t.$t("Take Away")),1)):p("",!0),s.order_type==2?(n(),i("span",Ot,a(t.$t("Dine In")),1)):p("",!0)],8,wt),e("td",{class:"text-end",onClick:l=>b(l,s.slack)},[s.order_status==0?(n(),i("span",Mt,a(t.$t("Open")),1)):p("",!0),s.order_status==1?(n(),i("span",Vt,a(t.$t("Closed")),1)):p("",!0),s.order_status==2?(n(),i("span",St,a(t.$t("In Kitchen")),1)):p("",!0),s.order_status==3?(n(),i("span",At,a(t.$t("On Hold")),1)):p("",!0),s.order_status==4?(n(),i("span",Et,a(t.$t("Hold & In Kitchen")),1)):p("",!0),s.order_status==5?(n(),i("span",Ht,"Returned")):p("",!0),s.order_status==6?(n(),i("span",Rt,"Partial Returned")):p("",!0),s.order_status==7?(n(),i("span",Tt,qt)):p("",!0)],8,Dt),e("td",{class:"fw-bold text-end text-primary",onClick:l=>b(l,s.slack)},a(m(Q)(s.total))+" "+a(ee.value),9,It),e("td",jt,[j.value&&!s.zatcaResponse?(n(),i("button",{key:0,onClick:l=>ue(s.slack),disabled:$.value,target:"_blank",type:"button",class:"btn btn-xs btn-warning ms-2"}," E-Sign ",8,Bt)):p("",!0),e("a",{href:s.receipt_link,target:"_blank",type:"button",class:"btn btn-sm btn-primary ms-2"},[K(" Print "),h(k,{icon:"ph:printer-light",class:"fs-3"})],8,Pt)])]))),128)):(n(),i("tr",Lt,[e("td",xt,a(t.$t("No Data Found")),1)]))])])])),e("div",Ft,[e("div",Zt,[e("div",Kt,[h(C,{onPaginate_limit_update:le,pagination:H.value},null,8,["pagination"])]),e("div",zt,[h(m(we),{data:H.value,limit:5,onPaginationChangePage:f},null,8,["data"])])])])])]),_:1})}}};export{ls as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ServerMessage.I5ol-gtz.js","assets/index.7OFNPsHl.js","assets/index.1t-AB2n6.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
