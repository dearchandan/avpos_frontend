import{_ as de}from"./DefaultLayout.nvkZ4UhM.js";import{_ as re}from"./PaginateLimit.Xv-qfeqj.js";import{_ as ce}from"./ActionButtonGroup.ogbCWQxi.js";import{_ as ue}from"./ListingSkeleton.iExoV4hO.js";import{_ as _e}from"./VSelect.UFegTIpk.js";import{_ as pe}from"./SalesMenu.shs1JWgg.js";import{u as me,b as ve,r as c,e as O,o as he,v as U,g as n,p as j,w as M,I as ge,f as B,k as v,i as e,t as o,h as i,n as F,l as p,j as y,K as k,M as fe,N as be,L as V,F as L,x as q,O as ye}from"./index.7OFNPsHl.js";import{j as I}from"./vue-datepicker.sD5zgpde.js";import"./ClipLoader.1qNfpKDH.js";/* empty css                                                   */import"./vee-validate.esm.N3uz7Rsk.js";/* empty css                                                                */const ke={class:"content"},Ce={class:"page-heading"},we={class:"row align-items-center justify-content-between mb-3"},$e={class:"col-auto"},Pe={class:"mb-0"},Se={key:0,class:"col-auto"},De={class:"row align-items-end justify-content-between g-3"},Oe={class:"col col-lg-auto order-2 order-md-1"},Me={class:"row align-items-end g-3"},Ve={class:"col col-md-auto"},Ae={class:"form-field"},Ne={class:"col-auto col-md-auto"},He={class:"btn btn-sm btn-light-primary font-weight-normal",type:"button","data-bs-toggle":"collapse","data-bs-target":"#subFilter","aria-expanded":"false","aria-controls":"collapseExample"},Ee=e("svg",{width:"13",height:"14",viewBox:"0 0 13 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M0.464286 2.33333H7.03022C7.23775 3.136 7.95879 3.73333 8.82143 3.73333C9.68407 3.73333 10.4051 3.136 10.6126 2.33333H12.5357C12.792 2.33333 13 2.12427 13 1.86667C13 1.60907 12.792 1.4 12.5357 1.4H10.6126C10.4051 0.597333 9.68407 0 8.82143 0C7.95879 0 7.23775 0.597333 7.03022 1.4H0.464286C0.208 1.4 0 1.60907 0 1.86667C0 2.12427 0.208 2.33333 0.464286 2.33333ZM8.82143 0.933333C9.33354 0.933333 9.75 1.35193 9.75 1.86667C9.75 2.3814 9.33354 2.8 8.82143 2.8C8.30932 2.8 7.89286 2.3814 7.89286 1.86667C7.89286 1.35193 8.30932 0.933333 8.82143 0.933333ZM12.5357 11.6667H10.6126C10.4051 10.864 9.68407 10.2667 8.82143 10.2667C7.95879 10.2667 7.23775 10.864 7.03022 11.6667H0.464286C0.208 11.6667 0 11.8757 0 12.1333C0 12.3909 0.208 12.6 0.464286 12.6H7.03022C7.23775 13.4027 7.95879 14 8.82143 14C9.68407 14 10.4051 13.4027 10.6126 12.6H12.5357C12.792 12.6 13 12.3909 13 12.1333C13 11.8757 12.792 11.6667 12.5357 11.6667ZM8.82143 13.0667C8.30932 13.0667 7.89286 12.6481 7.89286 12.1333C7.89286 11.6186 8.30932 11.2 8.82143 11.2C9.33354 11.2 9.75 11.6186 9.75 12.1333C9.75 12.6481 9.33354 13.0667 8.82143 13.0667ZM12.5357 6.53333H5.5055C5.29797 5.73067 4.57693 5.13333 3.71429 5.13333C2.85164 5.13333 2.13061 5.73067 1.92307 6.53333H0.464286C0.208 6.53333 0 6.7424 0 7C0 7.2576 0.208 7.46667 0.464286 7.46667H1.92307C2.13061 8.26933 2.85164 8.86667 3.71429 8.86667C4.57693 8.86667 5.29797 8.26933 5.5055 7.46667H12.5357C12.792 7.46667 13 7.2576 13 7C13 6.7424 12.792 6.53333 12.5357 6.53333ZM3.71429 7.93333C3.20218 7.93333 2.78571 7.51473 2.78571 7C2.78571 6.48527 3.20218 6.06667 3.71429 6.06667C4.22639 6.06667 4.64286 6.48527 4.64286 7C4.64286 7.51473 4.22639 7.93333 3.71429 7.93333Z",fill:"currentColor"})],-1),Re={class:"col-auto col-md-auto"},Ue={class:"col-12 col-md-4 col-lg-3 order-1 order-md-2"},je={class:"form-field mb-0"},Be={class:"field-icon"},Fe=["placeholder"],Le={class:"icon"},qe={class:"collapse",id:"subFilter"},Ie={class:"sub-filter"},Te={class:"row align-items-end g-3"},Ze={class:"col-6 col-md-auto"},Je={class:"form-field"},Ge={class:"col-6 col-md-auto"},ze={class:"col-6 col-md-auto d-md-block"},Ke={value:""},We={value:"0"},Ye={value:"1"},Qe={value:"2"},Xe={value:"3"},xe={class:"col-6 col-md-auto d-md-block"},et={value:""},tt={value:"0"},st={value:"1"},ot={value:"2"},at={key:0},lt={key:1,class:"table-responsive"},nt={class:"table table-list-data table-hover"},it={class:"bg-light"},dt={scope:"col",width:"10%"},rt={scope:"col",width:"10%"},ct={scope:"col",width:"15%"},ut={scope:"col",width:"10%"},_t={scope:"col",width:"10%"},pt={scope:"col",width:"10%",class:"text-end"},mt={scope:"col",width:"10%",class:"text-center"},vt={scope:"col",width:"10%",class:"text-center"},ht={scope:"col",class:"text-end",width:"5%"},gt={key:0,scope:"col",class:"text-end",width:"10%"},ft=["onClick"],bt=["onClick"],yt=["onClick"],kt=["onClick"],Ct=["onClick"],wt=["onClick"],$t={key:0,class:"text-center"},Pt={class:"form-field mb-0"},St=["onUpdate:modelValue","id","onChange"],Dt=["value"],Ot={key:1,class:"text-end"},Mt={key:0,class:"badge badge-primary"},Vt={key:1,class:"badge badge-success"},At={key:2,class:"badge badge-danger"},Nt={key:3,class:"badge badge-warning"},Ht={class:"text-center"},Et={key:0,class:"badge badge-primary"},Rt={key:1,class:"badge badge-warning"},Ut={key:2,class:"badge badge-success"},jt=["href"],Bt={key:2,class:"text-end"},Ft={key:1},Lt={key:1},qt={class:"text-center py-3",colspan:"10"},It={class:"data-footer"},Tt={class:"row align-items-center justify-content-between"},Zt={class:"col-auto"},Jt={class:"col-auto"},ls={__name:"purchase_orders",setup(Gt){const{t:C}=me(),{isAuthorized:A}=ge(),T=ve(),Z={server_messages:{type:"",messages:""},is_listing:!1,search_query:c(""),filter_count:0},J=C("Search by PO No., PO Ref. No., Amount..."),N=c({supplier:"Supplier",select_supplier:"Select Supplier"}),l=O({...Z});he(()=>{ee(),h(),z()}),U(()=>l.search_query,_.debounce(()=>{h()},500));const w=c([]),$=c([]),G=c([{key:"0",value:"Draft"},{key:"1",value:"Approved"},{key:"2",value:"Reject"},{key:"3",value:"Cancel"}]);async function h(t=1){l.is_listing=!0,await axios.get("/api/v2/purchase_orders",{params:{page:t,paginate_limit:E.value,search_query:l.search_query,filter:r}}).then(a=>{w.value=a.data.data,$.value=a.data.pagination,l.is_listing=!1}).catch(a=>{l.server_messages.type="error",l.server_messages.messages=a,l.is_listing=!1,console.log(a)})}const H=c([]);async function z(){let t=await axios.get("api/v2/suppliers/all");t=t.data.data,_.forEach(t,a=>{let d={key:a.slack,value:a==null?void 0:a.name};H.value.push(d)})}const E=c();async function K(t){E.value=t,await h()}async function W(t,a){var d=new FormData;d.append("slack",a),d.append("approval_status",t.target.value),await axios.post("/api/purchase_order/update_status",d).then(m=>{if(m.data.status_code==200)toast.success(m.data.msg);else try{l.server_messages.type="error",l.server_messages.messages=JSON.parse(m.data.msg)}catch{l.server_messages.type="error",l.server_messages.messages=m.data.msg}}).catch(m=>{l.server_messages.type="error",l.server_messages.messages=m,console.log(m)})}const Y=c(!1),P=O({po_dates:c(),po_due_dates:c(),supplier:c(""),approval_status:c(""),delivery_status:c("")}),r=O({...P});U(()=>r.supplier,t=>{b()});const S=c(!1);async function b(){l.filter_count=0,JSON.stringify(r)!=JSON.stringify(P)&&(S.value=!0),_.forEach(r,(t,a)=>{t!=""&&t!=null&&a!="po_dates"&&(l.filter_count=l.filter_count+1)}),Y.value=!1,await h()}function Q(){Object.assign(r,P),S.value=!1,l.filter_count=0,h()}function f(t){router.push("/purchase_order/"+t)}function X(t){router.push("/purchase_order/edit/"+t)}async function x(t){var a=!1;await Swal.fire({title:C("Do you want to delete this purchase order?"),showCancelButton:!0,confirmButtonText:C("Yes, Delete"),confirmButtonColor:"#d33",cancelButtonText:C("Cancel")}).then(d=>{d.isConfirmed&&(a=!0)}),a&&await axios.post("/api/purchase_order/delete",{slack:t}).then(d=>{if(d.data.status_code==200)toast.success(d.data.msg),h();else try{l.server_messages.type="error",l.server_messages.messages=JSON.parse(d.data.msg)}catch{l.server_messages.type="error",l.server_messages.messages=d.data.msg}}).catch(d=>{l.server_messages.type="error",l.server_messages.messages=d,console.log(d)})}const g=c({write:!1,delete:!1});function ee(){g.value={write:A("A_WRITE_PURCHASE_ORDER"),delete:A("A_DELETE_PURCHASE_ORDER")}}return(t,a)=>{const d=pe,m=B("router-link"),D=B("Icon"),te=_e,se=ue,oe=ce,ae=re,le=de;return n(),j(le,null,{subheader:M(()=>[v(d)]),default:M(()=>[e("div",ke,[e("div",Ce,[e("div",we,[e("div",$e,[e("h2",Pe,o(t.$t("Purchases")),1)]),g.value.write?(n(),i("div",Se,[v(m,{class:"btn btn-sm btn-light-primary2",to:"/purchase_order/add"},{default:M(()=>[F("+ "+o(t.$t("New Purchase Order")),1)]),_:1})])):p("",!0)]),e("div",De,[e("div",Oe,[e("div",Me,[e("div",Ve,[e("div",Ae,[e("label",null,o(t.$t("PO Date")),1),v(y(I),{range:"",modelValue:r.po_dates,"onUpdate:modelValue":[a[0]||(a[0]=s=>r.po_dates=s),a[1]||(a[1]=s=>b())],format:"dd-MM-yyyy","enable-time-picker":!1,"input-class-name":"form-control form-control-solid form-control-sm"},null,8,["modelValue"])])]),e("div",Ne,[e("button",He,[Ee,F(" "+o(t.$t("Filters"))+" ",1),k(e("span",{class:"badge",id:"filter_count_badge"},o(l.filter_count),513),[[fe,l.filter_count>0]])])]),e("div",Re,[S.value?(n(),i("button",{key:0,class:"btn btn-sm btn-light-danger",onClick:Q},o(t.$t("Clear")),1)):p("",!0)])])]),e("div",Ue,[e("div",je,[e("div",Be,[k(e("input",{type:"search",class:"form-control form-control-sm form-control-solid",placeholder:y(J),"onUpdate:modelValue":a[2]||(a[2]=s=>l.search_query=s)},null,8,Fe),[[be,l.search_query]]),e("div",Le,[v(D,{icon:"fa6-solid:magnifying-glass"})])])])])]),e("div",qe,[e("div",Ie,[e("div",Te,[e("div",Ze,[e("div",Je,[e("label",null,o(t.$t("Invoice Due Date")),1),v(y(I),{range:"",modelValue:r.po_due_dates,"onUpdate:modelValue":[a[3]||(a[3]=s=>r.po_due_dates=s),a[4]||(a[4]=s=>b())],format:"dd-MM-yyyy","enable-time-picker":!1,"input-class-name":"form-control form-control-solid form-control-sm"},null,8,["modelValue"])])]),e("div",Ge,[v(te,{name:"supplier",label:N.value.supplier,modelValue:r.supplier,"onUpdate:modelValue":a[5]||(a[5]=s=>r.supplier=s),placeholder:N.value.select_supplier,options:H.value,height_sm:!0},null,8,["label","modelValue","placeholder","options"])]),e("div",ze,[e("label",null,o(t.$t("Approval Status")),1),k(e("select",{class:"form-select form-select-solid form-select-sm","onUpdate:modelValue":a[6]||(a[6]=s=>r.approval_status=s),onChange:b},[e("option",Ke,o(t.$t("All")),1),e("option",We,o(t.$t("Draft")),1),e("option",Ye,o(t.$t("Approved")),1),e("option",Qe,o(t.$t("Reject")),1),e("option",Xe,o(t.$t("Cancel")),1)],544),[[V,r.approval_status]])]),e("div",xe,[e("label",null,o(t.$t("Deliver Status")),1),k(e("select",{class:"form-select form-select-sm form-select-solid","onUpdate:modelValue":a[7]||(a[7]=s=>r.delivery_status=s),onChange:b},[e("option",et,o(t.$t("All")),1),e("option",tt,o(t.$t("Undelivered")),1),e("option",st,o(t.$t("Partial Delivered")),1),e("option",ot,o(t.$t("Delivered/Closed")),1)],544),[[V,r.delivery_status]])])])])])]),l.is_listing?(n(),i("div",at,[v(se)])):(n(),i("div",lt,[e("table",nt,[e("thead",it,[e("tr",null,[e("th",dt,o(t.$t("PO Number")),1),e("th",rt,o(t.$t("Ref. Number")),1),e("th",ct,o(t.$t("Supplier")),1),e("th",ut,o(t.$t("PO Date")),1),e("th",_t,o(t.$t("PO Due Date")),1),e("th",pt,o(t.$t("Amount")),1),e("th",mt,o(t.$t("Approval Status")),1),e("th",vt,o(t.$t("Delivery Status")),1),e("th",ht,o(t.$t("Print")),1),g.value.write&&g.value.delete?(n(),i("th",gt,o(t.$t("Action")),1)):p("",!0)])]),e("tbody",null,[w.value.length>0?(n(!0),i(L,{key:0},q(w.value,(s,ne)=>{var R;return n(),i("tr",{key:ne},[e("td",{purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o(s.po_number),9,ft),e("td",{purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o(s.reference_no),9,bt),e("td",{purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o((R=s.supplier)==null?void 0:R.name),9,yt),e("td",{purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o(s.po_date_label),9,kt),e("td",{purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o(s.po_due_date_label),9,Ct),e("td",{class:"text-end",purchase_order:"button","data-bs-toggle":"modal","data-bs-target":"#viewPurchaseOrderModal",onClick:u=>f(s.slack)},o(s.grand_product_amount),9,wt),s.reporting_user_id>0&&s.reporting_user&&s.reporting_user.slack==y(T).user.slack&&s.delivery_status==0||s.reporting_user_id==""&&s.delivery_status==0?(n(),i("td",$t,[e("div",Pt,[k(e("select",{class:"form-control form-control-solid","onUpdate:modelValue":u=>s.approval_status=u,name:"approval_status",id:s.slack,onChange:u=>W(u,s.slack)},[(n(!0),i(L,null,q(G.value,(u,ie)=>(n(),i("option",{value:u.key,key:ie},o(u.value),9,Dt))),128))],40,St),[[V,s.approval_status]])])])):(n(),i("td",Ot,[s.approval_status==0?(n(),i("span",Mt,o(t.$t("Draft")),1)):p("",!0),s.approval_status==1?(n(),i("span",Vt,o(t.$t("Approved")),1)):p("",!0),s.approval_status==2?(n(),i("span",At,o(t.$t("Rejected")),1)):p("",!0),s.approval_status==3?(n(),i("span",Nt,o(t.$t("Cancelled")),1)):p("",!0)])),e("td",Ht,[s.delivery_status==0?(n(),i("span",Et,o(t.$t("Undelivered")),1)):p("",!0),s.delivery_status==1?(n(),i("span",Rt,o(t.$t("Partial Delivered")),1)):p("",!0),s.delivery_status==2?(n(),i("span",Ut,o(t.$t("Close/Delivered")),1)):p("",!0)]),e("td",null,[s.receipt_link!=null?(n(),i("a",{key:0,href:s.receipt_link,target:"_blank",type:"button",class:"mx-2"},[v(D,{icon:"ph:printer-light",class:"fs-3 text-info"})],8,jt)):p("",!0)]),g.value.write&&g.value.delete?(n(),i("td",Bt,[s.approval_status==0?(n(),j(oe,{key:0,permissions:g.value,onDelete:x,onEdit:X,slack:s.slack},null,8,["permissions","slack"])):(n(),i("div",Ft,"--"))])):p("",!0)])}),128)):(n(),i("tr",Lt,[e("td",qt,o(t.$t("No Data Found")),1)]))])])])),e("div",It,[e("div",Tt,[e("div",Zt,[v(ae,{onPaginate_limit_update:K,pagination:$.value},null,8,["pagination"])]),e("div",Jt,[v(y(ye),{data:$.value,limit:5,onPaginationChangePage:h},null,8,["data"])])])])])]),_:1})}}};export{ls as default};
