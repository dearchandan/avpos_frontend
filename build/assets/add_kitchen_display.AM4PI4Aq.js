import{_ as J}from"./EditFormSmallSkeleton.Mi_n2i-s.js";import O from"./ServerMessage.Re9KOdbP.js";import{bS as Q,u as R,a as G,r as k,e as H,o as P,g as c,p as S,w as g,f as K,i as t,l as h,k as w,t as u,j as m,h as d,m as N,K as D,Q as C,F,x as U}from"./index.li3fCRRM.js";import{D as W}from"./DefaultLayout.saUWsTkY.js";import{F as X}from"./vee-validate.esm.reM-LHjC.js";import{c as Y,a as Z}from"./index.esm.e6McCFlz.js";import{_ as q}from"./VTextInput.pcaNaUkX.js";import{C as ee}from"./ClipLoader.gDBpDd3b.js";/* empty css                                                                */import"./VTooltip.pHzwBjkF.js";/* empty css                                                   */const se={class:"header-nav-wrap"},te={class:"row align-items-center"},ae={class:"col-auto"},ie={class:"header-back-link"},ne={class:"col-auto"},le={key:0,class:"fw-bold"},ce={key:1,class:"fw-bold"},oe={key:0,class:"content"},re={class:"row card-strash"},de={key:0,class:"py-3"},ue={class:"col-md-12"},_e={class:"row"},me={class:"col-md-12"},ve={class:"card"},he={class:"row"},pe={class:"col-md-3"},ke={class:"col-md-3"},fe={class:"col-md-3 pt-md-2"},ge={class:"form-field pt-md-2"},be={class:"form-check form-switch pt-md-4"},ye={class:"form-check-label",for:"status"},Se={class:"col-md-12"},we={class:"form-field"},De={class:"row"},Ce={class:"pt-2"},Ve={class:"chekbox-group-list"},xe={class:"form-check"},$e={class:"form-check-label mb-0"},Ke=["value","id","onClick","checked"],Ne={class:"form-check"},Fe={class:"form-check-label mb-0"},Ue=["value","id","onClick"],qe={class:"text-end"},Ae=["disabled"],Be={key:1,class:"pt-0"},Ee={key:2,class:"pt-0"},Xe={__name:"add_kitchen_display",setup(Ie){const A=Q(),{t:v}=R(),o=G().params.slack,V=k({name:v("KDS Name"),activation_code:v("Activation Code")}),s=H({...{server_messages:{type:"",messages:""},is_submitting:!1,name:"",activation_code:"",status:!0,kds_slack:""}}),B=Y({name:Z().required(v("name is required",{name:v("KDS Name")})).min(3,v("name must be at least n characters",{name:v("CDS Name"),number:3}))}),b=k([]),a=k([]),E=k([]);P(()=>{I(),o!=""&&o!=null&&M()});const x=k(!1);async function I(){let e=o!=""&&o!=null?"api/kitchen_display/add/"+o:"api/kitchen_display/add",n=await axios.get(e);s.activation_code=n.data.data.activation_code,b.value=n.data.data.access_categories,x.value=!0}function $(e){if(e.event.target.checked==!0)if(e.type>0){a.value.push(e.current);for(var n=0,i=0;i<e.siblings.length;i++)a.value.includes(e.siblings[i])&&n++;e.siblings.length==n&&a.value.push(e.parent),typeof e.children<"u"&&(a.value=a.value.concat(e.children))}else a.value.push(e.current),a.value=a.value.concat(e.children);else if(e.type>0){a.value=this.array_remove(a.value,e.current);for(var n=0,i=0;i<e.siblings.length;i++)a.value.includes(e.siblings[i])&&n++;if(a.value=this.array_remove(a.value,e.parent),typeof this.categories[e.parent]<"u"){for(var p=0,f=this.categories[e.parent].childs,i=0;i<f.length;i++)a.value.includes(f[i])&&p++;p==0&&(a.value=this.array_remove(a.value,e.parent))}}else{a.value=this.array_remove(a.value,e.current);for(var i=0;i<e.children.length;i++)a.value=this.array_remove(a.value,e.children[i])}}async function L(){s.is_submitting=!0;var e=new FormData;e.append("name",s.name),e.append("activation_code",s.activation_code),e.append("status",s.status),e.append("categories",a.value),e.append("kds_slack",s.kds_slack);var n=s.kds_slack!=""&&s.kds_slack!=null?"/api/kitchen_display/update":"/api/kitchen_display/save";await axios.post(n,e).then(i=>{if(i.data.status_code==200)toast.success(i.data.msg),s.is_submitting=!1,A.refreshTerminals(),router.push("/kitchen_displays");else{try{s.server_messages.type="error",s.server_messages.messages=JSON.parse(i.data.msg)}catch{s.server_messages.type="error",s.server_messages.messages=i.data.msg}s.is_submitting=!1}}).catch(i=>{s.server_messages.type="error",s.server_messages.messages=i,s.is_submitting=!1,console.log(i)})}async function M(){await axios.get("/api/kitchen_display",{params:{slack:o}}).then(e=>{E.value=e.data.data.kitchen_display,e.data.data.kitchen_display&&(s.kds_slack=e.data.data.kitchen_display.slack,s.name=e.data.data.kitchen_display.name,s.activation_code=e.data.data.kitchen_display.activation_code,e.data.data.kitchen_display.categories&&_.forEach(e.data.data.kitchen_display.categories,n=>{a.value.push(n.category.id)}))}).catch(e=>{s.server_messages.type="error",s.server_messages.messages=e,console.log(e)})}return(e,n)=>{const i=K("Icon"),p=K("router-link"),f=O,T=J;return c(),S(W,null,{subheader:g(()=>[t("div",se,[t("div",te,[t("div",ae,[t("div",ie,[h(p,{class:"text-primary",to:"/kitchen_displays"},{default:g(()=>[h(i,{icon:"fa6-solid:chevron-left"}),w(" "+u(e.$t("KDSs")),1)]),_:1})])]),t("div",ne,[m(o)==""||m(o)==null?(c(),d("h5",le,u(e.$t("Add KDS")),1)):(c(),d("h5",ce,u(e.$t("Edit KDS")),1))])])])]),default:g(()=>[m(o)==""||m(o)==null||m(o)!=""&&x.value?(c(),d("div",oe,[h(m(X),{"validation-schema":m(B),onSubmit:L,enctype:"multipart/form-data","initial-values":s},{default:g(()=>[t("div",re,[s.server_messages.messages!=""?(c(),d("div",de,[h(f,{server_messages:s.server_messages},null,8,["server_messages"])])):N("",!0),t("div",ue,[t("div",_e,[t("div",me,[t("div",ve,[t("div",he,[t("div",pe,[h(q,{type:"text",name:"name",modelValue:s.name,"onUpdate:modelValue":n[0]||(n[0]=l=>s.name=l),label:V.value.name,required:!0},null,8,["modelValue","label"])]),t("div",ke,[h(q,{type:"text",name:"activation_code",modelValue:s.activation_code,"onUpdate:modelValue":n[1]||(n[1]=l=>s.activation_code=l),label:V.value.activation_code,required:!0,"aria-disabled":!0,readonly:!0},null,8,["modelValue","label"])]),t("div",fe,[t("div",ge,[t("div",be,[D(t("input",{class:"form-check-input me-2",type:"checkbox",role:"switch",id:"status",checked:"","onUpdate:modelValue":n[2]||(n[2]=l=>s.status=l)},null,512),[[C,s.status]]),t("label",ye,u(e.$t("Active")),1)])])]),t("div",Se,[t("div",we,[t("label",null,u(e.$t("Category Selection")),1),t("div",De,[(c(!0),d(F,null,U(b.value,(l,j)=>(c(),d("div",{class:"col-auto",key:j},[t("div",Ce,[t("ul",Ve,[t("li",null,[t("div",xe,[t("label",$e,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=r=>a.value=r),value:l.category_key,id:l.category_key,onClick:r=>$({type:l.type,current:l.category_key,parent:"",grand_parent:"",children:l.childs,siblings:l.siblings,event:r}),checked:a.value.includes(l.id)},null,8,Ke),[[C,a.value]]),w(" "+u(l.name),1)])]),t("ul",null,[(c(!0),d(F,null,U(l.sub_category,(r,z)=>(c(),d("li",{key:z},[t("div",Ne,[t("label",Fe,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=y=>a.value=y),value:r.category_key,id:r.category_key,onClick:y=>$({type:r.type,current:r.category_key,parent:l.category_key,grand_parent:"",children:r.childs,siblings:r.siblings,event:y})},null,8,Ue),[[C,a.value]]),w(" "+u(r.name),1)])])]))),128))])])])])]))),128))])])])])])])])])]),t("div",qe,[t("button",{type:"submit",class:"btn btn-primary",disabled:s.is_submitting||b.value.length<=0},[s.is_submitting?(c(),S(ee,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):N("",!0),s.is_submitting?(c(),d("span",Be,u(e.$t("Saving...")),1)):(c(),d("span",Ee,u(e.$t("Save")),1))],8,Ae)])]),_:1},8,["validation-schema","initial-values"])])):(c(),S(T,{key:1}))]),_:1})}}};export{Xe as default};
