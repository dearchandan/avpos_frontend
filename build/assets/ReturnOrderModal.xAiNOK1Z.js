import{_ as P}from"./VMultiSelect.aFZl8ywf.js";import{z as Q,u as z,b as A,d as G,e as J,r as y,P as T,v as S,g as n,h as l,i as a,k as m,w as j,Q as R,K as g,t as i,n as M,j as v,F as K,L as W,l as b,y as H,x as X,p as Y,I as Z,C as ee,D as te}from"./index.GdMxdeuf.js";import{F as ae}from"./vee-validate.esm.9aElOHQY.js";import{c as O,h as se,a as f}from"./index.esm.0vhAmrVd.js";import{_ as U}from"./VTextInput.ZgtOiOMJ.js";import{B as oe}from"./BeatLoader.czpWuXPY.js";import{u as re}from"./global.8gHgB6cY.js";import{C as ne}from"./ClipLoader.UcGuNCxH.js";import"./VTooltip.Ewb958d6.js";/* empty css                                                   *//* empty css                                                   */const C=p=>(ee("data-v-c03b3353"),p=p(),te(),p),le={class:"modal hide",id:"returnOrderModal",tabindex:"-1","aria-labelledby":"Add Category","aria-modal":"true",role:"dialog","data-bs-backdrop":"static","data-bs-keyboard":"false"},ie={class:"modal-dialog modal-xl modal-dialog-centered"},de={class:"modal-content"},ue={class:"modal-body"},ce={key:0},_e={key:1},me={class:"row"},pe={class:"col-6"},he={class:"form-field"},ve={class:"form-check form-switch"},be={class:"form-check-label"},ye={class:"col-6"},ge={class:"text-end"},fe={class:"table-responsive mt-3"},ke={class:"table table-hover table-bordered mb-3 table-responsive-data"},Ve={class:"bg-light"},qe={class:"text-center",width:"5%"},we={width:"5%"},Se={width:"30%"},$e={width:"10%"},Re={width:"5%"},Me={class:"text-center"},Oe=["onUpdate:modelValue"],Ue={class:"text-center"},Ce=["onUpdate:modelValue"],Ne=C(()=>a("option",{value:"1"},"Return To Stock",-1)),Fe=C(()=>a("option",{value:"0"},"Wastage",-1)),xe=[Ne,Fe],Ee={key:1},Be={key:0},Ie={key:1,class:"text-danger"},De={class:"row pt-3"},Le={class:"col-md-4"},Pe={class:"row"},Qe={class:"col-6"},ze={key:0,class:"col-md-7"},Ae={class:"col-2 text-end pt-4"},Ge=["disabled"],Je={key:1,class:"pt-0"},Te={key:2,class:"pt-0"},je={__name:"ReturnOrderModal",props:["order"],setup(p){const{t:u}=z(),{getRoundedValue:N}=Z(),F=A(),x=G(()=>F.user.currency.symbol),c=J({type:"",messages:""}),k=y({other_reason:u("Other Reason"),other_reason_placeholder:u("Enter returned reason...")}),{order_returned_reasons:E}=re();function B(){$("#returnOrderModal").modal("hide")}const V=p,q=T(V,"order"),e=y({is_checked_returning_entire_order:!1,is_listing:!1,is_submitting:!1,items:[],reason:"",other_reason:"",payment_method_id:""}),I=O({items:se(O({quantity:f().test({name:"max",exclusive:!1,params:{},test:function(s,t){var o=$('[name="'+t.path+'"]').attr("max");return isNaN(parseFloat(s))||s==""?t.createError({path:`${t.path}`,message:u("must be a positive number or 0",{name:u("Quantity")})}):s<=parseFloat(o)?!0:t.createError({path:`${t.path}`,message:u("must be less than or equal to n",{name:u("Quantity"),number:o})})}})})),reason:f().required(u("name is required",{name:u("Reason")})),payment_method:f().required(u("name is required",{name:u("Payment Method")}))});S(()=>V.order,s=>{s&&s.products&&(console.log(s.products),e.value.items=s.products.map(t=>{if(t.is_refundable)return{is_stockable:t.is_stockable,stock_status:1,is_refundable:t.is_refundable,product_name:t.product_name,product_name_ar:t.product_name_ar,note:t.note,product_amount:t.product_amount,order_product_slack:t.slack,is_returning:!1,product_quantity:t.product_quantity,available_quantity:t.product_quantity-t.returned_quantity,returning_quantity:0,returning_amount:0}}),e.value.items=e.value.items.filter(t=>t&&t.available_quantity>0))});const w=y([]);D();async function D(){let s=await axios.get("api/payment_methods/all");w.value=s.data.data}S(()=>e.value.is_checked_returning_entire_order,s=>{s?e.value.items=_.forEach(e.value.items,t=>{t.returning_quantity=t.available_quantity,t.is_returning=!0}):e.value.items=_.forEach(e.value.items,t=>{t.returning_quantity=0,t.is_returning=!1})});async function L(){e.value.is_submitting=!0;let s=_.filter(e.value.items,o=>o.is_returning),t=new FormData;t.append("order_slack",q.value.slack),t.append("items",JSON.stringify(s)),t.append("reason",e.value.reason=="Other"?e.value.other_reason:e.value.reason),t.append("payment_method_id",e.value.payment_method_id),await axios.post("/api/return_order/save",t).then(o=>{if(o.data.status_code==200)toast.success(o.data.msg),e.value.is_submitting=!1,$("#returnOrderModal").modal("hide"),location.reload();else{try{c.type="error",c.messages=JSON.parse(o.data.msg)}catch{c.type="error",c.messages=o.data.msg}e.value.is_submitting=!1}}).catch(o=>{c.type="error",c.messages=o,console.log(o)})}return(s,t)=>{const o=P;return n(),l("div",le,[a("div",ie,[a("div",de,[a("div",{class:"modal-header"},[a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:B,id:"close_btn"})]),a("div",ue,[e.value.is_listing?(n(),l("div",ce,[m(oe,{color:"gray",size:"15px",class:"pt-2 pe-2"})])):(n(),l("div",_e,[m(v(ae),{"validation-schema":v(I),onSubmit:L,"initial-values":e.value,enctype:"multipart/form-data"},{default:j(()=>[a("div",me,[a("div",pe,[a("div",he,[a("div",ve,[a("label",be,[g(a("input",{type:"checkbox",class:"form-check-input me-2",role:"switch",name:"is_checked_returning_entire_order",id:"is_checked_returning_entire_order","unchecked-value":!1,"onUpdate:modelValue":t[0]||(t[0]=d=>e.value.is_checked_returning_entire_order=d)},null,512),[[R,e.value.is_checked_returning_entire_order]]),M(" "+i(s.$t("Return Entire Order")),1)])])])]),a("div",ye,[a("p",ge," Order Amount: "+i(v(N)(q.value.total))+" "+i(x.value),1)])]),a("div",fe,[a("table",ke,[a("thead",Ve,[a("tr",null,[a("th",qe,i(s.$t("Return")),1),a("th",we,i(s.$t("Stock Status")),1),a("th",Se,i(s.$t("Product")),1),a("th",$e,i(s.$t("Qty Left")),1),a("th",Re,i(s.$t("Qty to Return")),1)])]),a("tbody",null,[(n(!0),l(K,null,X(e.value.items,(d,r)=>(n(),l("tr",null,[a("td",Me,[g(a("input",{type:"checkbox","onUpdate:modelValue":h=>d.is_returning=h},null,8,Oe),[[R,d.is_returning]])]),a("td",Ue,[e.value.items[r].is_stockable?g((n(),l("select",{key:0,"onUpdate:modelValue":h=>e.value.items[r].stock_status=h},xe,8,Ce)),[[W,e.value.items[r].stock_status]]):(n(),l("span",Ee,"Unstockable"))]),a("td",null,[M(i(e.value.items[r].product_name)+" ",1),e.value.items[r].product_name_ar!=""?(n(),l("span",Be,i(e.value.items[r].product_name_ar),1)):b("",!0),e.value.items[r].note!=""?(n(),l("span",Ie," Note: "+i(e.value.items[r].note),1)):b("",!0)]),a("td",null,i(e.value.items[r].available_quantity),1),a("td",null,[m(U,{type:"number",name:"items["+r+"].quantity",modelValue:e.value.items[r].returning_quantity,"onUpdate:modelValue":h=>e.value.items[r].returning_quantity=h,max:e.value.items[r].available_quantity,min:"0",islabel:!1,class:H("mt-0")},null,8,["name","modelValue","onUpdate:modelValue","max"])])]))),256))])])]),a("div",De,[a("div",Le,[a("div",Pe,[m(o,{name:"payment_method",mode:"single",text:"name",value:"id",label:"Payment Method",modelValue:e.value.payment_method_id,"onUpdate:modelValue":t[1]||(t[1]=d=>e.value.payment_method_id=d),options:w.value,required:""},null,8,["modelValue","options"])])]),a("div",Qe,[m(o,{name:"reason",mode:"single",label:"Returned Reason",modelValue:e.value.reason,"onUpdate:modelValue":t[2]||(t[2]=d=>e.value.reason=d),options:v(E),required:""},null,8,["modelValue","options"])]),e.value.reason=="Other"?(n(),l("div",ze,[m(U,{type:"text",name:"other_reason",modelValue:e.value.other_reason,"onUpdate:modelValue":t[3]||(t[3]=d=>e.value.other_reason=d),label:k.value.other_reason,placeholder:k.value.other_reason_placeholder},null,8,["modelValue","label","placeholder"])])):b("",!0),a("div",Ae,[a("button",{type:"submit",class:"btn btn-primary w-100",disabled:e.value.is_submitting},[e.value.is_submitting?(n(),Y(ne,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):b("",!0),e.value.is_submitting?(n(),l("span",Je," Submitting... ")):(n(),l("span",Te," Submit "))],8,Ge)])])]),_:1},8,["validation-schema","initial-values"])]))])])])])}}},rt=Q(je,[["__scopeId","data-v-c03b3353"]]);export{rt as default};
