import{u as Z,b as ee,d as V,e as Y,r as p,g as r,p as A,w as f,f as C,i as e,l as u,k as F,t as a,j as s,m as P,A as S,B as T,h as m,F as te,x as se,O as oe,I as ae,bX as b,q as ne,_ as le}from"./index.sP6fhsqN.js";import{D as ie}from"./DefaultLayout.K5Bh9Jz_.js";import{_ as ce}from"./PaginateLimit.T5jDCI_N.js";import{_ as de}from"./ListingSkeleton.0g9v9IYA.js";import{_ as re}from"./VMultiSelect.pXBL2AV1.js";import{u as _e}from"./global.AEIEVpKW.js";import{s as E,a as ue,e as pe,j as me}from"./vue-datepicker.S8gODTVm.js";import{s as O,e as I}from"./index.KqBHsonE.js";import"./ClipLoader._89zL49D.js";/* empty css                                                   */import"./vee-validate.esm.2kXgdFia.js";const he={class:"header-nav-wrap"},ve={class:"row align-items-center"},ge={class:"col-auto"},ye={class:"header-back-link"},fe={class:"col-auto"},be={class:"fw-bold"},ke={class:"content"},De={class:"card"},we={class:"row field-m-0 align-items-end g-3"},$e={class:"col-md-4 col-lg-3"},xe={class:"form-field"},Me={for:"",class:"form-label"},Ve=e("span",{class:"text-danger"},"*",-1),Ye=["onClick","onKeyup"],Ae={class:"col-md-4 col-lg-3"},Ce={class:"col-md-4 col-lg-3"},Fe={class:"col-auto text-end"},Pe={class:"row align-items-center"},Se={class:"col-auto"},Te=["disabled"],Ee={class:"col-auto"},Oe=["disabled"],Ie={class:"card"},Le={class:""},Ne={key:0},Be={key:1,class:"table-responsive"},Re={class:"table table-list-data table-hover"},je={class:"bg-light"},Ke={scope:"col"},Ue={scope:"col"},Ge={scope:"col"},qe={scope:"col"},ze={scope:"col"},Je={scope:"col"},Xe={scope:"col"},He={scope:"col",class:"text-end"},Qe={scope:"col",class:"text-end"},We={class:"text-end"},Ze={class:"text-end"},et={key:1},tt={class:"text-center py-3",colspan:"13"},st={key:0},ot=e("th",{colspan:"7"},null,-1),at={class:"text-end"},nt={class:"text-end"},lt={class:"data-footer"},it={class:"row align-items-center justify-content-between"},ct={class:"col-auto"},dt={class:"col-auto"},wt={__name:"discount_code_report",setup(rt){const{t:v}=Z(),{isAuthorized:_t,getRoundedValue:g}=ae();_e();const L=ee();V(()=>L.user.currency.symbol);const N=Y({server_messages:{type:"",messages:""},is_submitting:!1,is_listing:!1,dates:p([new Date,new Date]),selected_type:p(),selected_inventory_type:p(),is_exporting:!1}),t=Y({...N}),B=v("Select Type"),R=v("All Types"),j=v("Select Inventory Type"),K=v("All Inventory Type"),U=p([{label:"Today",value:[new Date,new Date]},{label:"This month",value:[O(new Date),I(new Date)]},{label:"Last month",value:[O(E(new Date,1)),I(E(new Date,1))]},{label:"This year",value:[ue(new Date),pe(new Date)]}]),G=[{key:"1",value:"Percentage"},{key:"2",value:"Flat"}],q=[{key:"1",value:"All Products"},{key:"2",value:"Specific Category/Product"}],$=p();async function z(o){$.value=o,await D()}const i=p([]),k=p([]);async function D(o=1){t.is_listing=!0,t.dates[0]=b(t.dates[0]).format("YYYY-MM-DD"),t.dates[1]=b(t.dates[1]).format("YYYY-MM-DD"),await axios.get("/api/discount_code_report",{params:{page:o,paginate_limit:$.value,filter:t}}).then(n=>{i.value=n.data.data.data,console.log("report_data =",i.value),_.forEach(i.value,(c,d)=>{i.value[d].total_discount=parseFloat(c.total_order_discount)+parseFloat(c.total_order_item_disc)+parseFloat(c.total_invoice_item_disc),i.value[d].total_count=c.total_order_count+c.total_order_item_count+c.total_invoice_item_count}),k.value=n.data.pagination,t.is_listing=!1}).catch(n=>{t.server_messages.type="error",t.server_messages.messages=n,t.is_listing=!1,console.log(n)})}const y=V(()=>i.value.length?{total_count:i.value.reduce(function(n,c){return parseFloat(n)+parseFloat(c.total_count)},0).toFixed(2),total_discount:i.value.reduce(function(n,d){var d=d.total_discount!=null?d.total_discount:0;return parseFloat(n)+parseFloat(d)},0).toFixed(2)}:null);async function J(){t.is_exporting=!0,t.dates[0]=b(t.dates[0]).format("YYYY-MM-DD"),t.dates[1]=b(t.dates[1]).format("YYYY-MM-DD"),await axios.get("/api/discount_code_report/export_excel",{params:{filter:t}}).then(o=>{if(o.data.status_code==200){t.is_exporting=!1;const n=document.createElement("a");n.target="_blank",n.href=o.data.data.file,document.body.appendChild(n),n.click()}else{try{t.server_messages.type="error",t.server_messages.messages=JSON.parse(o.data.msg)}catch{t.server_messages.type="error",t.server_messages.messages=o.data.msg}t.is_exporting=!1}}).catch(o=>{t.server_messages.type="error",t.server_messages.messages=o,t.is_exporting=!1,console.log(o)})}const X=ne(()=>le(()=>import("./ServerMessage.EFQMOwoZ.js"),__vite__mapDeps([0,1,2])));return(o,n)=>{const c=C("Icon"),d=C("router-link"),x=re,H=de,Q=ce,W=ie;return r(),A(W,null,{subheader:f(()=>[e("div",he,[e("div",ve,[e("div",ge,[e("div",ye,[u(d,{class:"text-primary",to:"/reports"},{default:f(()=>[u(c,{icon:"fa6-solid:chevron-left"}),F(" "+a(o.$t("Reports")),1)]),_:1})])]),e("div",fe,[e("h5",be,a(o.$t("Discount Code Report")),1)])])])]),default:f(()=>[e("div",ke,[s(t).server_messages.messages!=""?(r(),A(s(X),{key:0,class:"py-3",server_messages:s(t).server_messages},null,8,["server_messages"])):P("",!0),e("div",De,[e("div",we,[e("div",$e,[e("div",xe,[e("label",Me,[F(a(o.$t("Select Dates"))+" ",1),Ve]),u(s(me),{range:"","preset-dates":s(U),modelValue:s(t).dates,"onUpdate:modelValue":n[0]||(n[0]=l=>s(t).dates=l),format:"dd-MM-yyyy","enable-time-picker":!1,"input-class-name":"form-control form-control-solid"},{"preset-date-range-button":f(({label:l,value:h,presetDate:w})=>[e("span",{role:"button",tabindex:0,onClick:M=>w(h),onKeyup:[S(T(M=>w(h),["prevent"]),["enter"]),S(T(M=>w(h),["prevent"]),["space"])]},a(l),41,Ye)]),_:1},8,["preset-dates","modelValue"])])]),e("div",Ae,[u(x,{name:"order_types",label:s(B),placeholder:s(R),text:"value",value:"key",options:G,modelValue:s(t).selected_type,"onUpdate:modelValue":n[1]||(n[1]=l=>s(t).selected_type=l),mode:"single"},null,8,["label","placeholder","modelValue"])]),e("div",Ce,[u(x,{name:"sale_types",label:s(j),placeholder:s(K),text:"value",value:"key",options:q,modelValue:s(t).selected_inventory_type,"onUpdate:modelValue":n[2]||(n[2]=l=>s(t).selected_inventory_type=l),mode:"single"},null,8,["label","placeholder","modelValue"])]),e("div",Fe,[e("div",Pe,[e("div",Se,[e("button",{class:"btn btn-primary",onClick:D,disabled:s(t).dates==null},a(o.$t("View")),9,Te)]),e("div",Ee,[e("button",{class:"btn btn-success",onClick:n[3]||(n[3]=l=>J()),disabled:s(t).dates==null},a(o.$t("Export Excel")),9,Oe)])])])])]),e("div",Ie,[e("div",Le,[s(t).is_listing?(r(),m("div",Ne,[u(H)])):(r(),m("div",Be,[e("table",Re,[e("thead",je,[e("tr",null,[e("th",Ke,a(o.$t("Discount")),1),e("th",Ue,a(o.$t("Type")),1),e("th",Ge,a(o.$t("Value")),1),e("th",qe,a(o.$t("Applies to")),1),e("th",ze,a(o.$t("Min. Order Amt.")),1),e("th",Je,a(o.$t("Max. Discount Amt.")),1),e("th",Xe,a(o.$t("Created At")),1),e("th",He,a(o.$t("Count of use")),1),e("th",Qe,a(o.$t("Amount")),1)])]),e("tbody",null,[s(i)!=""?(r(!0),m(te,{key:0},se(s(i),(l,h)=>(r(),m("tr",{key:h},[e("td",null,a(l.name),1),e("td",null,a(l.type==1?"Percentage":"Flat"),1),e("td",null,a(l.value),1),e("td",null,a(l.inventory_type==1?"All Products":"Specific CAtegory/Product"),1),e("td",null,a(s(g)(l.minimum_order_amount)),1),e("td",null,a(s(g)(l.maximum_discount_amount)),1),e("td",null,a(l.created_date),1),e("td",We,a(l.total_count),1),e("td",Ze,a(s(g)(l.total_discount)),1)]))),128)):(r(),m("tr",et,[e("td",tt,a(o.$t("No Data Found")),1)]))]),s(y)!=""&&s(y)!=null?(r(),m("tfoot",st,[e("tr",null,[ot,e("th",at,a(s(y).total_count),1),e("th",nt,a(s(g)(s(y).total_discount)),1)])])):P("",!0)])])),e("div",lt,[e("div",it,[e("div",ct,[u(Q,{onPaginate_limit_update:z,pagination:s(k)},null,8,["pagination"])]),e("div",dt,[u(s(oe),{data:s(k),limit:5,onPaginationChangePage:D},null,8,["data"])])])])])])])]),_:1})}}};export{wt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ServerMessage.EFQMOwoZ.js","assets/index.sP6fhsqN.js","assets/index.KTHCd6a8.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
