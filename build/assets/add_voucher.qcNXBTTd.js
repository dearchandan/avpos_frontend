import{_ as B}from"./EditFormSkeleton.MxB2Xqx6.js";import{_ as D}from"./VMultiSelect.3zUL7lik.js";import W from"./ServerMessage.qNo4NwTp.js";import{_ as F}from"./DefaultLayout.EMHfdzn0.js";import{F as I}from"./vee-validate.esm.0La7AMjT.js";import{c as O,a as g,g as T,d as P}from"./index.esm.wERziE-M.js";import{_ as h}from"./VTextInput.o2P1IcEE.js";import{u as J,a as j,r as p,e as z,o as L,g as m,p as y,w as b,f as q,i as o,k as l,n as R,t as v,j as i,h as c,l as S}from"./index.ri7Y_V5F.js";import{C as G}from"./ClipLoader.4-rIzqtH.js";/* empty css                                                                */import"./VTooltip.a7qKl6DY.js";/* empty css                                                   */const H={class:"header-nav-wrap"},K={class:"row align-items-center"},Q={class:"col-auto"},X={class:"header-back-link"},Y={class:"col-auto"},Z={key:0,class:"fw-bold"},ee={key:1,class:"fw-bold"},ae={key:0,class:"content"},te={class:"row card-strash"},se={key:0,class:"py-3"},oe={class:"col-md-12"},re={class:"row"},ne={class:"col-md-12"},le={class:"card"},ue={class:"row"},de={class:"col-md-2"},me={class:"col-md-2"},ie={class:"col-md-2"},ce={class:"col-md-2"},_e={class:"col-md-2"},he={class:"col-md-2"},ve={class:"col-md-12"},pe={class:"text-end"},be=["disabled"],ge={key:1,class:"pt-0"},ye={key:2,class:"pt-0"},De={__name:"add_voucher",setup(fe){const{t}=J(),u=j().params.slack,d=p({voucher_number:t("Voucher Number"),voucher_date:t("Voucher Date"),balance_amount:t("Balance Amount"),withdrawal_amount:t("Withdrawal Amount"),note:t("Note"),closing_voucher_user:t("Closing Voucher User"),select_voucher_user:t("Select User"),payment_mode:t("Payment Mode"),select_payment_mode:t("Select Payment Mode")}),e=z({...{server_messages:{type:"",messages:""},is_submitting:!1,voucher_number:"",voucher_date:"",balance_amount:"",withdrawal_amount:"",closing_voucher_user_id:"",payment_mode:"",note:""}});let x=O({voucher_number:g().required(t("name is required",{name:t("Voucher Number")})),voucher_date:T().required(t("name is required",{name:t("Voucher Date")})),closing_voucher_user_id:g().required(t("name is required",{name:t("Voucher User")})),payment_mode:g().required(t("name is required",{name:t("Payment Mode")})),withdrawal_amount:P().required(t("name is required",{name:t("Withdrawal Amount")})).typeError(t("must be a number",{name:t("Withdrawal Amount")})).min(1,t("Withdrawal Amount must be more than 1")).test({test:function(a,s){var r=$('[name="withdrawal_amount"]').attr("max");return a<=parseInt(r)?!0:s.createError({path:`${s.path}`,message:t("must be less than or equal to n",{name:t("Withdrawal Amount"),number:r})})}})});L(()=>{C(),u!=""&&u!=null&&N()});const U=p([{id:"Cash",name:"Cash"},{id:"Online Transfer",name:"Online Transfer"}]),f=p([]);async function C(){await axios.get("/api/voucher/add",{params:{type:1}}).then(a=>{if(a.data.status_code==200)u==null&&(e.voucher_number=a.data.data.voucher_number,e.voucher_date=a.data.data.date,e.balance_amount=a.data.data.balance_amount),_.forEach(a.data.data.voucher_users,s=>{if(s.status==1){let r={id:s.id,name:s.name};f.value.push(r)}});else try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(a.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=a.data.msg}}).catch(a=>{e.server_messages.type="error",e.server_messages.messages=a,console.log(a)})}const w=p(!1);async function N(){let a=await axios.get("/api/voucher",{params:{slack:u,type:1}});a.data.data&&(a.data.data.status>0&&router.push("/vouchers"),e.voucher_slack=a.data.data.slack,e.voucher_number=a.data.data.voucher_number,e.voucher_date=a.data.data.voucher_date,e.balance_amount=a.data.data.balance_amount,e.withdrawal_amount=a.data.data.withdrawal_amount,e.closing_voucher_user_id=a.data.data.closing_voucher_user_id,e.payment_mode=a.data.data.payment_mode,e.note=a.data.data.note),w.value=!0}async function A(){e.is_submitting=!0;var a=new FormData;a.append("voucher_number",e.voucher_number),a.append("voucher_date",e.voucher_date),a.append("balance_amount",e.balance_amount),a.append("withdrawal_amount",e.withdrawal_amount),a.append("closing_voucher_user_id",e.closing_voucher_user_id),a.append("payment_mode",e.payment_mode),a.append("note",e.note),a.append("slack",e.voucher_slack),a.append("type",1);var s=e.voucher_slack!=""&&e.voucher_slack!=null?"/api/voucher/update":"/api/voucher/save";await axios.post(s,a,{headers:{"Content-Type":"multipart/form-data"}}).then(r=>{if(r.data.status_code==200)toast.success(r.data.msg),e.is_submitting=!1,router.push("/vouchers");else{try{e.server_messages.type="error",e.server_messages.messages=JSON.parse(r.data.msg)}catch{e.server_messages.type="error",e.server_messages.messages=r.data.msg}e.is_submitting=!1}}).catch(r=>{e.server_messages.type="error",e.server_messages.messages=r,e.is_submitting=!1,console.log(r)})}return(a,s)=>{const r=q("Icon"),V=q("router-link"),E=W,k=D,M=B;return m(),y(F,null,{subheader:b(()=>[o("div",H,[o("div",K,[o("div",Q,[o("div",X,[l(V,{class:"text-primary",to:"/vouchers"},{default:b(()=>[l(r,{icon:"fa6-solid:chevron-left"}),R(" "+v(a.$t("Vouchers")),1)]),_:1})])]),o("div",Y,[i(u)==null||i(u)==""?(m(),c("h5",Z,v(a.$t("Add Voucher")),1)):(m(),c("h5",ee,v(a.$t("Edit Voucher")),1))])])])]),default:b(()=>[i(u)==""||i(u)==null||i(u)!=""&&w.value?(m(),c("div",ae,[l(i(I),{"validation-schema":i(x),onSubmit:A,enctype:"multipart/form-data","initial-values":e},{default:b(()=>[o("div",te,[e.server_messages.messages!=""?(m(),c("div",se,[l(E,{server_messages:e.server_messages},null,8,["server_messages"])])):S("",!0),o("div",oe,[o("div",re,[o("div",ne,[o("div",le,[o("div",ue,[o("div",de,[l(h,{type:"text",name:"voucher_number",modelValue:e.voucher_number,"onUpdate:modelValue":s[0]||(s[0]=n=>e.voucher_number=n),label:d.value.voucher_number,disabled:!0,required:!0},null,8,["modelValue","label"])]),o("div",me,[l(h,{type:"date",name:"voucher_date",modelValue:e.voucher_date,"onUpdate:modelValue":s[1]||(s[1]=n=>e.voucher_date=n),label:d.value.voucher_date,required:!0},null,8,["modelValue","label"])]),o("div",ie,[l(h,{type:"number",name:"balance_amount",modelValue:e.balance_amount,"onUpdate:modelValue":s[2]||(s[2]=n=>e.balance_amount=n),label:d.value.balance_amount,disabled:!0,required:!0},null,8,["modelValue","label"])]),o("div",ce,[l(h,{type:"number",name:"withdrawal_amount",modelValue:e.withdrawal_amount,"onUpdate:modelValue":s[3]||(s[3]=n=>e.withdrawal_amount=n),label:d.value.withdrawal_amount,max:e.balance_amount,required:!0},null,8,["modelValue","label","max"])]),o("div",_e,[l(k,{label:d.value.closing_voucher_user,name:"closing_voucher_user_id",text:"name",value:"id",options:f.value,mode:"single",modelValue:e.closing_voucher_user_id,"onUpdate:modelValue":s[4]||(s[4]=n=>e.closing_voucher_user_id=n),placeholder:d.value.select_voucher_user,required:!0},null,8,["label","options","modelValue","placeholder"])]),o("div",he,[l(k,{label:d.value.payment_mode,name:"payment_mode",text:"name",value:"id",options:U.value,mode:"single",modelValue:e.payment_mode,"onUpdate:modelValue":s[5]||(s[5]=n=>e.payment_mode=n),placeholder:d.value.select_payment_mode,required:!0},null,8,["label","options","modelValue","placeholder"])]),o("div",ve,[l(h,{type:"text",name:"note",modelValue:e.note,"onUpdate:modelValue":s[6]||(s[6]=n=>e.note=n),label:d.value.note},null,8,["modelValue","label"])])])])])])])]),o("div",pe,[o("button",{type:"submit",class:"btn btn-primary",disabled:e.is_submitting},[e.is_submitting?(m(),y(G,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):S("",!0),e.is_submitting?(m(),c("span",ge,v(a.$t("Saving...")),1)):(m(),c("span",ye,v(a.$t("Save")),1))],8,be)])]),_:1},8,["validation-schema","initial-values"])])):(m(),y(M,{key:1}))]),_:1})}}};export{De as default};
