import{b as X,u as Y,r as y,e as C,s as Z,o as ee,g as l,h as r,i as t,t as c,K as P,R as F,k as U,l as v,j as k,m as d,w as te,F as se,y as w,p as O,N as ae,x as oe,q as le,_ as ne}from"./index.sP6fhsqN.js";import re from"./ServerMessage.EFQMOwoZ.js";import{_ as ce}from"./VTextInput.EPCajChY.js";import{_ as ie}from"./VSelect.twStq9pE.js";import{F as de}from"./vee-validate.esm.2kXgdFia.js";import{c as R,h as ue,b as _e}from"./index.esm.DHYHwGJ4.js";/* empty css                                                   */import{C as me}from"./ClipLoader._89zL49D.js";import"./VTooltip.kcvohVRA.js";/* empty css                                                                *//* empty css                                                   */const pe={class:"row"},he={class:"col-md-12"},ye={class:"card"},ve={class:"section-title text-muted"},fe={key:0,class:"row"},ke={class:"form-field"},ge={class:"d-flex align-items-center flex-wrap"},be={class:"me-3 mt-3"},Ve={class:"mt-3"},we={key:0,class:"col-12"},qe={class:"row"},Se={class:"col-md-3"},$e={class:"col-md-3"},xe={class:"form-field"},Ce={class:"label"},Pe={key:1,class:"col-12"},Ue={class:"row"},je={class:"col-md-3"},Ne={class:"row"},Ae={class:"col-12 py-3"},Fe={class:"table-responsive"},Oe={class:"table table-condensed"},Re={width:"40%"},Te={width:"5%"},De={width:"5%"},Ee={width:"10%"},Qe={width:"10%"},ze=t("span",{class:"text-danger"},"*",-1),Ie={key:0,width:"10%"},Me={key:1,width:"10%"},Be={key:2,width:"10%"},Je={key:3,width:"10%",class:"text-center"},Le={key:0},He={key:1},Ke={key:2,class:"text-center"},We={key:1},Ge=["onUpdate:modelValue","title"],Xe={key:3,class:"text-center"},Ye=["onClick"],Ze=t("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","aria-hidden":"true",role:"img",width:"0.88em",height:"1em",viewBox:"0 0 448 512",class:"iconify iconify--fa6-regular"},[t("path",{fill:"currentColor",d:"m170.5 51.6l-19 28.4h145l-19-28.4c-1.5-2.2-4-3.6-6.7-3.6h-93.7c-2.7 0-5.2 1.3-6.7 3.6zm147-26.6l36.7 55H424c13.3 0 24 10.7 24 24s-10.7 24-24 24h-8v304c0 44.2-35.8 80-80 80H112c-44.2 0-80-35.8-80-80V128h-8c-13.3 0-24-10.7-24-24s10.7-24 24-24h69.8l36.7-55.1C140.9 9.4 158.4 0 177.1 0h93.7c18.7 0 36.2 9.4 46.6 24.9zM80 128v304c0 17.7 14.3 32 32 32h224c17.7 0 32-14.3 32-32V128zm80 64v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16m80 0v208c0 8.8-7.2 16-16 16s-16-7.2-16-16V192c0-8.8 7.2-16 16-16s16 7.2 16 16"})],-1),et=[Ze],tt={key:1},st={colspan:"6"},at={key:0,class:"col-12 py-3"},ot={key:1,class:"col-12 mt-2 text-end"},lt=["disabled"],nt={key:1,class:"pt-0"},rt={key:2,class:"pt-0"},gt={__name:"FromStockTransfer",props:["stock_transfer"],setup(T){const D=X(),{t:u}=Y(),j=y({search_placeholder:u("Search and Add Product"),add_service:u("Add Service")}),E=le(()=>ne(()=>import("./ProductSearch.b6duo47F.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),a=C({...{server_messages:{type:"",messages:""},search_type:1,stock_transfer_products:[]}}),Q=R({stock_transfer_products:ue(R({quantity:_e().typeError(u("must be a number",{name:u("Quantity")})).required(u("name is required",{name:u("Quantity")})).positive(u("must be greater than zero",{name:u("Quantity")})).test({name:"max",exclusive:!1,params:{},test:function(e,s){var i=$('[name="'+s.path+'"]').attr("max");return e<=parseFloat(i)?!0:s.createError({path:`${s.path}`,message:u("must be less than or equal to n",{name:u("Quantity"),number:i})})}})})).required()}),n=T;y(!1);const z=Z(Multiselect),q=y(""),f=y([]);ee(()=>{M(),x()});const I=y([{key:1,value:"Wastage/Damaged"},{key:2,value:"Undelivered"},{key:3,value:"No Reason"},{key:4,value:"Other"}]);function M(){_.forEach(n.stock_transfer.stock_transfer_products,e=>{f.value.push(e.product.slack);let s={product_slack:e.product.slack,product_name:e.product.name,sku:e.sku,upc:e.product.upc,sale_price:e.sale_price,max_quantity:e.product.this_branch_inventory.quantity,quantity:e.quantity,accepted_quantity:e.accepted_quantity,rejected_quantity:e.rejected_quantity,rejected_reason:e.rejected_reason,other_reason:e.other_reason};a.stock_transfer_products.push(s)})}async function N(e){a.search_type=e.target.value,x(),b()}const S=y([]);async function x(){S.value=[];let e=await axios.get("api/categories/all");e=e.data.data,_.forEach(e,s=>{let i={key:s.slack,value:s.code+" - "+s.name};S.value.push(i)})}const h=y([]),A=y([]);async function b(){h.value=[];let e=await axios.get("api/products/all",{params:{category:a.category,only_available:1,is_stocable_products:1,not_recipe:1,branch_slack:D.user.login_branch.slack}});h.value=e.data.data,B(),A.value=JSON.parse(JSON.stringify(e.data.data))}function B(){a.stock_transfer_products.map(function(e,s){let i=h.value.findIndex(g=>g.slack===e.product_slack);i>-1&&h.value.splice(i,1)})}const m=y();function J(e){e!=""&&e!=null&&e!=null?(q.value=e,L(e),b()):q.value=""}function L(e){if(h.value.findIndex(function(s,i){s.slack==e&&(m.value=s)}),m.value!=null&&m.value!=null&&m.value!=""){f.value.push(m.value.slack);let s=C({product_slack:m.value.slack,product_name:m.value.name,sku:m.value.sku,upc:m.value.upc,sale_price:m.value.sale_price,max_quantity:m.value.quantity,quantity:""});a.stock_transfer_products.push(s),h.value.splice(h.value.findIndex(i=>i.slack===q.value),1)}}function H(e){f.value.push(e.slack);let s=C({product_slack:e.slack,product_name:e.name,sku:e.sku,upc:e.upc,sale_price:e.sale_price,max_quantity:e.quantity,quantity:""});a.stock_transfer_products.push(s)}function K(e){a.stock_transfer_products.splice(a.stock_transfer_products.indexOf(e),1),f.value.splice(f.value.indexOf(e.product_slack),1);let s=_.find(A.value,i=>i.slack==e.product_slack);s!=="undefined"&&h.value.push(s),x(),b()}async function W(){a.is_submitting=!0;var e=new FormData;e.append("stock_transfer_slack",n.stock_transfer.slack),e.append("products",JSON.stringify(a.stock_transfer_products)),await axios.post("/api/stock_transfer/product/update",e).then(s=>{if(s.data.status_code==200)toast.success(s.data.msg),setTimeout(()=>{router.push("/stock_transfers")},2e3);else{try{a.server_messages.type="error",a.server_messages.messages=JSON.parse(s.data.msg)}catch{a.server_messages.type="error",a.server_messages.messages=s.data.msg}a.is_submitting=!1}}).catch(s=>{a.server_messages.type="error",a.server_messages.messages=s,a.is_submitting=!1,console.log(s)})}return(e,s)=>{const i=ie,g=ce,G=re;return l(),r("div",pe,[t("div",he,[t("div",ye,[t("h5",ve,c(e.$t("Products Details"))+":",1),n.stock_transfer.status<2?(l(),r("div",fe,[t("div",ke,[t("div",ge,[t("label",be,[P(t("input",{class:"form-check-input me-1",type:"radio",name:"search_type",checked:"","onUpdate:modelValue":s[0]||(s[0]=o=>a.search_type=o),value:1,onClick:N},null,512),[[F,a.search_type]]),U(c(e.$t("Search by Category")),1)]),t("label",Ve,[P(t("input",{class:"form-check-input me-1",type:"radio",name:"search_type","onUpdate:modelValue":s[1]||(s[1]=o=>a.search_type=o),value:2,onClick:N},null,512),[[F,a.search_type]]),U(c(e.$t("Search by Product Name")),1)])])]),a.search_type==1?(l(),r("div",we,[t("div",qe,[t("div",Se,[v(i,{name:"categories",label:k(u)("Category"),modelValue:a.category,"onUpdate:modelValue":s[2]||(s[2]=o=>a.category=o),placeholder:"--"+k(u)("Select Category")+"--",options:S.value,onChange:b},null,8,["label","modelValue","placeholder","options"])]),t("div",$e,[t("div",xe,[t("label",Ce,c(e.$t("Products")),1),v(k(z),{options:h.value,label:"name",valueProp:"slack",mode:"single",searchable:!0,class:"form-control form-control-solid",onChange:s[3]||(s[3]=o=>J(o))},null,8,["options"])])])])])):d("",!0),a.search_type==2?(l(),r("div",Pe,[t("div",Ue,[t("div",je,[v(k(E),{onSelectProduct:H,placeholder:j.value.search_placeholder,selected_products:f.value,button_placeholder:j.value.add_service,is_stocable_products:1,not_recipe:1,only_available:1},null,8,["placeholder","selected_products","button_placeholder"])])])])):d("",!0)])):d("",!0),t("div",Ne,[v(k(de),{onSubmit:W,"validation-schema":k(Q),"initial-values":a},{default:te(()=>[t("div",Ae,[t("div",Fe,[t("table",Oe,[t("thead",null,[t("tr",null,[t("th",Re,c(e.$t("Product")),1),t("th",Te,c(e.$t("UPC")),1),t("th",De,c(e.$t("SKU")),1),t("th",Ee,c(e.$t("Sale Price")),1),t("th",Qe,[U(c(e.$t("Quantity")),1),ze]),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("th",Ie,c(e.$t("Accepted Quantity")),1)):d("",!0),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("th",Me,c(e.$t("Rejected Quantity")),1)):d("",!0),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("th",Be,c(e.$t("Rejected Reason")),1)):d("",!0),n.stock_transfer.status<2?(l(),r("th",Je,c(e.$t("Remove")),1)):d("",!0)])]),t("tbody",null,[a.stock_transfer_products.length>0?(l(!0),r(se,{key:0},oe(a.stock_transfer_products,(o,V)=>(l(),r("tr",{key:V},[t("td",null,[t("strong",null,c(o.product_name),1)]),t("td",null,c(o.upc),1),t("td",null,[v(g,{type:"text",name:"sku",modelValue:o.sku,"onUpdate:modelValue":p=>o.sku=p,disabled:n.stock_transfer.status>1,islabel:!1,class:w("mt-0")},null,8,["modelValue","onUpdate:modelValue","disabled"])]),t("td",null,[v(g,{type:"number",name:"stock_transfer_products["+V+"].sale_price",modelValue:o.sale_price,"onUpdate:modelValue":p=>o.sale_price=p,disabled:n.stock_transfer.status>1,islabel:!1,class:w("mt-0")},null,8,["name","modelValue","onUpdate:modelValue","disabled"])]),t("td",null,[v(g,{type:"number",name:"stock_transfer_products["+V+"].quantity",modelValue:o.quantity,"onUpdate:modelValue":p=>o.quantity=p,max:o.max_quantity,min:"0",disabled:n.stock_transfer.status>1,islabel:!1,class:w("mt-0")},null,8,["name","modelValue","onUpdate:modelValue","max","disabled"])]),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("td",Le,c(o.accepted_quantity),1)):d("",!0),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("td",He,c(o.rejected_quantity),1)):d("",!0),n.stock_transfer.status==2||n.stock_transfer.status==3?(l(),r("td",Ke,[o.rejected_quantity>0?(l(),O(i,{key:0,name:"stock_transfer_products["+V+"].rejected_reason",modelValue:o.rejected_reason,"onUpdate:modelValue":p=>o.rejected_reason=p,options:I.value,islabel:!1,disabled:!0},null,8,["name","modelValue","onUpdate:modelValue","options"])):(l(),r("span",We," -- ")),o.rejected_reason==4?P((l(),r("input",{key:2,type:"text",class:w(["mt-2","form-control form-control-solid"]),"onUpdate:modelValue":p=>o.other_reason=p,title:o.other_reason,disabled:!0},null,8,Ge)),[[ae,o.other_reason]]):d("",!0)])):d("",!0),n.stock_transfer.status<2?(l(),r("td",Xe,[t("a",{role:"button",class:"btn btn-icon btn-xs btn-light-danger",onClick:p=>K(o)},et,8,Ye)])):d("",!0)]))),128)):(l(),r("tr",tt,[t("td",st,c(e.$t("No Product Available")),1)]))])])])]),a.server_messages.messages!=""?(l(),r("div",at,[v(G,{server_messages:a.server_messages},null,8,["server_messages"])])):d("",!0),n.stock_transfer.status<2?(l(),r("div",ot,[t("button",{type:"submit",class:"btn btn-primary",disabled:a.is_submitting},[a.is_submitting?(l(),O(me,{key:0,color:"white",size:"20px",class:"pt-2 pe-2"})):d("",!0),a.is_submitting?(l(),r("span",nt,c(e.$t("Saving...")),1)):(l(),r("span",rt,c(e.$t("Save")),1))],8,lt)])):d("",!0)]),_:1},8,["validation-schema","initial-values"])])])])])}}};export{gt as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ProductSearch.b6duo47F.js","assets/index.sP6fhsqN.js","assets/index.KTHCd6a8.css","assets/vee-validate.esm.2kXgdFia.js","assets/index.esm.DHYHwGJ4.js","assets/BeatLoader.GLQikMEo.js","assets/BeatLoader.5j6ku4bW.css","assets/ClipLoader.7xz7y6gZ.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
